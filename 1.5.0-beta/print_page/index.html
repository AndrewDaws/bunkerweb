
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Make your web services secure by default.">
      
      
      
        <link rel="canonical" href="https://docs.bunkerweb.io/1.5.0-beta/print_page/">
      
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.8">
    
    
      
        <title>Print Site - BunkerWeb</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ded33207.min.css">
      
      

    
    
<script
  async
  defer
  data-domain="docs.bunkerweb.io"
  src="https://data.bunkerity.com/js/script.js"
></script>

    
      
    
    
      <link rel="stylesheet" href="../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../assets/extra.css">
    
    <script>__md_scope=new URL("/1.5.0-beta",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
  📢 Looking for tailored support, consulting or development for BunkerWeb ?
  Contact us at <a href="mailto:contact@bunkerity.com" style="color: #3f6ec6; text-decoration: underline">contact@bunkerity.com</a> for enterprise offers !

          </div>
          
        </aside>
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the documentation of the latest version.
  <a href="..//1.5.0-beta">
    <strong>Click here to view latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="BunkerWeb" class="md-header__button md-logo" aria-label="BunkerWeb" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BunkerWeb
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Print Site
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/bunkerity/bunkerweb" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Introduction
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../migrating/" class="md-tabs__link">
      Migrating from 1.4.X
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../concepts/" class="md-tabs__link">
      Concepts
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../integrations/" class="md-tabs__link">
      Integrations
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../quickstart-guide/" class="md-tabs__link">
      Quickstart guide
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../security-tuning/" class="md-tabs__link">
      Security tuning
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../settings/" class="md-tabs__link">
      Settings
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../web-ui/" class="md-tabs__link">
      Web UI
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../troubleshooting/" class="md-tabs__link">
      Troubleshooting
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../plugins/" class="md-tabs__link">
      Plugins
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../about/" class="md-tabs__link">
      About
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="BunkerWeb" class="md-nav__button md-logo" aria-label="BunkerWeb" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    BunkerWeb
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bunkerity/bunkerweb" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../migrating/" class="md-nav__link">
        Migrating from 1.4.X
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../integrations/" class="md-nav__link">
        Integrations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../quickstart-guide/" class="md-nav__link">
        Quickstart guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../security-tuning/" class="md-nav__link">
        Security tuning
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../web-ui/" class="md-nav__link">
        Web UI
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../plugins/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="index"><h1 id="index-introduction">Introduction</h1>
<h2 id="index-overview">Overview</h2>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/intro-overview.svg" width="800" />
  </p>
<figcaption>Make your web services secure by default !</figcaption>
</figure>
<p>BunkerWeb is a next-generation and open-source Web Application Firewall (WAF).</p>
<p>Being a full-featured web server (based on <a href="https://nginx.org/">NGINX</a> under the hood), it will protect your web services to make them "secure by default". BunkerWeb integrates seamlessly into your existing environments (<a href="#integrations-linux">Linux</a>, <a href="#integrations-docker">Docker</a>, <a href="#integrations-swarm">Swarm</a>, <a href="#integrations-kubernetes">Kubernetes</a>, …) and is fully configurable (don't panic, there is an <a href="#web-ui">awesome web UI</a> if you don't like the CLI) to meet your own use-cases . In other words, cybersecurity is no more a hassle.</p>
<p>BunkerWeb contains primary <a href="#security-tuning">security features</a> as part of the core but can be easily extended with additional ones thanks to a <a href="#plugins">plugin system</a>).</p>
<h2 id="index-why-bunkerweb">Why BunkerWeb ?</h2>
<ul>
<li><strong>Easy integration into existing environments</strong> : support for Linux, Docker, Swarm, Kubernetes, Ansible, Vagrant, ...</li>
<li><strong>Highly customizable</strong> : enable, disable and configure features easily to meet your use case</li>
<li><strong>Secure by default</strong> : offers out-of-the-box and hassle-free minimal security for your web services</li>
<li><strong>Awesome web UI</strong> : keep control of everything more efficiently without the need of the CLI</li>
<li><strong>Plugin system</strong> : extend BunkerWeb to meet your own use-cases</li>
<li><strong>Free as in "freedom"</strong> : licensed under the free <a href="https://www.gnu.org/licenses/agpl-3.0.en.html">AGPLv3 license</a></li>
</ul>
<h2 id="index-security-features">Security features</h2>
<p>A non-exhaustive list of security features :</p>
<ul>
<li><strong>HTTPS</strong> support with transparent <strong>Let's Encrypt</strong> automation</li>
<li><strong>State-of-the-art web security</strong> : HTTP security headers, prevent leaks, TLS hardening, ...</li>
<li>Integrated <strong>ModSecurity WAF</strong> with the <strong>OWASP Core Rule Set</strong></li>
<li><strong>Automatic ban</strong> of strange behaviors based on HTTP status code</li>
<li>Apply <strong>connections and requests limit</strong> for clients</li>
<li><strong>Block bots</strong> by asking them to solve a <strong>challenge</strong> (e.g. : cookie, javascript, captcha, hCaptcha or reCAPTCHA)</li>
<li><strong>Block known bad IPs</strong> with external blacklists and DNSBL</li>
<li>And much more ...</li>
</ul>
<p>Learn more about the core security features in the <a href="#security-tuning">security tuning</a> section of the documentation.</p>
<h2 id="index-demo">Demo</h2>
<p align="center">
    <iframe style="display: block;" width="560" height="315" src="https://www.youtube-nocookie.com/embed/ZhYV-QELzA4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</p>

<p>A demo website protected with BunkerWeb is available at <a href="https://demo.bunkerweb.io">demo.bunkerweb.io</a>. Feel free to visit it and perform some security tests.</p></section><section class="print-page" id="migrating"><h1 id="migrating-migrating-from-14x">Migrating from 1.4.X</h1>
<div class="admonition warning">
<p class="admonition-title">Read this if you were a 1.4.X user</p>
<p>A lot of things changed since the 1.4.X releases. Container-based integrations stacks contain more services but, trust us, fundamental principles of BunkerWeb are still there. You will find ready to use boilerplates for various integrations in the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/misc/integrations">misc/integrations</a> folder of the repository.</p>
</div>
<h2 id="migrating-scheduler">Scheduler</h2>
<p>Back to the 1.4.X releases, jobs (like Let's Encrypt certificate generation/renewal or blacklists download) <strong>were executed in the same container as BunkerWeb</strong>. For the purpose of <a href="https://en.wikipedia.org/wiki/Separation_of_concerns">separation of concerns</a>, we decided to create a <strong>separate service</strong> which is now responsible for managing jobs.</p>
<p>Called <strong>Scheduler</strong>, this service also generates the final configuration used by BunkerWeb and acts as an intermediary between autoconf and BunkerWeb. In other words, the scheduler is the <strong>brain of the BunkerWeb 1.5.X stack</strong>.</p>
<p>You will find more information about the scheduler <a href="#concepts-scheduler">here</a>.</p>
<h2 id="migrating-database">Database</h2>
<p>BunkerWeb configuration is <strong>no more stored in a plain file</strong> (located at <code>/etc/nginx/variables.env</code> if you didn't know it). That's it, we now support a <strong>fully-featured database as a backend</strong> to store settings, cache, custom configs, ... 🥳</p>
<p>Using a real database offers many advantages :</p>
<ul>
<li>Backup of the current configuration</li>
<li>Usage with multiple services (scheduler, web UI, ...)</li>
<li>Upgrade to a new BunkerWeb version</li>
</ul>
<p>Please note that we actually support, <strong>SQLite</strong>, <strong>MySQL</strong>, <strong>MariaDB</strong> and <strong>PostgreSQL</strong> as backends.</p>
<p>You will find more information about the database <a href="#concepts-database">here</a>.</p>
<h2 id="migrating-redis">Redis</h2>
<p>When BunkerWeb 1.4.X was used in cluster mode (Swarm or Kubernetes integrations), <strong>data were not shared among the nodes</strong>. For example, if an attacker was banned via the "bad behavior" feature on a specific node, <strong>he could still connect to the other nodes</strong>.</p>
<p>Security is not the only reason to have a shared data store for clustered integrations, <strong>caching</strong> is also another one. We can now <strong>store results</strong> of time-consuming operations like (reverse) dns lookups so they are <strong>available for other nodes</strong>.</p>
<p>We actually support <strong>Redis</strong> as a backend for the shared data store.</p>
<p>See the list of <a href="#settings-redis">redis settings</a> and the corresponding documentation of your integration for more information.</p>
<h2 id="migrating-default-values-and-new-settings">Default values and new settings</h2>
<p>The default value of some settings have changed and we have added many other settings, we recommend you read the <a href="#security-tuning">security tuning</a> and <a href="#settings">settings</a> sections of the documentation.</p></section><section class="print-page" id="concepts"><h1 id="concepts-concepts">Concepts</h1>
<figure>
<p><img align="center" alt="Overwiew" src="../assets/img/concepts.svg" /></p>
</figure>
<h2 id="concepts-integrations">Integrations</h2>
<p>The first concept is the integration of BunkerWeb into the target environment. We prefer to use the word "integration" instead of "installation" because one of the goals of BunkerWeb is to integrate seamlessly into existing environments.</p>
<p>The following integrations are officially supported :</p>
<ul>
<li><a href="#integrations-docker">Docker</a></li>
<li><a href="#integrations-docker-autoconf">Docker autoconf</a></li>
<li><a href="#integrations-swarm">Swarm</a></li>
<li><a href="#integrations-kubernetes">Kubernetes</a></li>
<li><a href="#integrations-linux">Linux</a></li>
<li><a href="#integrations-ansible">Ansible</a></li>
<li><a href="#integrations-vagrant">Vagrant</a></li>
</ul>
<p>If you think that a new integration should be supported, do not hesitate to open a <a href="https://github.com/bunkerity/bunkerweb/issues">new issue</a> on the GitHub repository.</p>
<div class="admonition info">
<p class="admonition-title">Going further</p>
<p>The technical details of all BunkerWeb integrations are available in the <a href="#integrations">integrations section</a> of the documentation.</p>
</div>
<h2 id="concepts-settings">Settings</h2>
<p>Once BunkerWeb is integrated into your environment, you will need to configure it to serve and protect your web applications.</p>
<p>The configuration of BunkerWeb is done by using what we call the "settings" or "variables". Each setting is identified by a name such as <code>AUTO_LETS_ENCRYPT</code> or <code>USE_ANTIBOT</code>. You can assign values to the settings to configure BunkerWeb.</p>
<p>Here is a dummy example of a BunkerWeb configuration :</p>
<div class="highlight"><pre><span></span><code>SERVER_NAME=www.example.com
AUTO_LETS_ENCRYPT=yes
USE_ANTIBOT=captcha
REFERRER_POLICY=no-referrer
USE_MODSECURITY=no
USE_GZIP=yes
USE_BROTLI=no
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Going further</p>
<p>The complete list of available settings with descriptions and possible values is available in the <a href="#settings">settings section</a> of the documentation.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Settings generator tool</p>
<p>To help you tune BunkerWeb, we offer an easy-to-use settings generator tool available at <a href="https://config.bunkerweb.io">config.bunkerweb.io</a>.</p>
</div>
<h2 id="concepts-multisite-mode">Multisite mode</h2>
<p>The multisite mode is a crucial concept to understand when using BunkerWeb. Because the goal is to protect web applications, our solution is intrinsically linked to the concept of "virtual host" or "vhost" (more info <a href="https://en.wikipedia.org/wiki/Virtual_hosting">here</a>) which makes it possible to serve multiple web applications from a single (or a cluster of) instance.</p>
<p>By default, the multisite mode of BunkerWeb is disabled which means that only one web application will be served and all the settings will be applied to it. The typical use case is having a single application to protect : you don't have to worry about the multisite and the default behavior should be the right one for you.</p>
<p>When multisite mode is enabled, BunkerWeb serves and protects multiple web applications. Each web application is identified by a unique server name and have its own set of settings. The typical use case is having multiple applications to protect and you want to use a single (or a cluster depending of the integration) instance of BunkerWeb.</p>
<p>The multisite mode is controlled by the <code>MULTISITE</code> setting which can be set to <code>yes</code> (enabled) or <code>no</code> (disabled, which is the default).</p>
<p>Each setting has a context that defines "where" it can be applied. If the context is global then the setting can't be set per server (or "per site", "per app") but only to the whole configuration. Otherwise, if the context is multisite, the setting can be set globally and per server. Defining a multisite setting to a specific server is done by adding the server name as a prefix of the setting name like <code>app1.example.com_AUTO_LETS_ENCRYPT</code> or <code>app2.example.com_USE_ANTIBOT</code> for example. When a multisite setting is defined globally (without any server prefix), all the servers will inherit that setting (but can still be overridden if we set the same setting with the server name prefix).</p>
<p>Here is a dummy example of a multisite BunkerWeb configuration :</p>
<div class="highlight"><pre><span></span><code>MULTISITE=yes
SERVER_NAME=app1.example.com app2.example.com app3.example.com
AUTO_LETS_ENCRYPT=yes
USE_GZIP=yes
USE_BROTLI=yes
app1.example.com_USE_ANTIBOT=javascript
app1.example.com_USE_MODSECURITY=no
app2.example.com_USE_ANTIBOT=cookie
app2.example.com_WHITELIST_COUNTRY=FR
app3.example.com_USE_BAD_BEHAVIOR=no
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Going further</p>
<p>You will find concrete examples of multisite mode in the <a href="#quickstart-guide">quickstart guide</a> of the documentation and the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/examples">examples</a> directory of the repository.</p>
</div>
<h2 id="concepts-custom-configurations">Custom configurations</h2>
<p>Because meeting all the use cases only using the settings is not an option (even with <a href="#plugins">external plugins</a>), you can use custom configurations to solve your specific challenges.</p>
<p>Under the hood, BunkerWeb uses the notorious NGINX web server, that's why you can leverage its configuration system for your specific needs. Custom NGINX configurations can be included in different <a href="https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/#contexts">contexts</a> like HTTP or server (all servers and/or specific server block).</p>
<p>Another core component of BunkerWeb is the ModSecurity Web Application Firewall : you can also use custom configurations to fix some false positives or add custom rules for example.</p>
<div class="admonition info">
<p class="admonition-title">Going further</p>
<p>You will find concrete examples of custom configurations in the <a href="#quickstart-guide">quickstart guide</a> of the documentation and the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/examples">examples</a> directory of the repository.</p>
</div>
<h2 id="concepts-database">Database</h2>
<p>State of the current configuration of BunkerWeb is stored in a backend database which contains the following data :</p>
<ul>
<li>Settings defined for all the services</li>
<li>Custom configurations </li>
<li>BunkerWeb instances</li>
<li>Metadata about jobs execution</li>
<li>Cached files</li>
</ul>
<p>Under the hood, when you edit a setting or add a new configuration, everything is stored in the database. We actually support SQLite, MariaDB, MySQL and PostgreSQL as backends.</p>
<p>Database configuration is done by using the <code>DATABASE_URI</code> setting which respects the following formats :</p>
<ul>
<li>SQLite : <code>sqlite:///var/lib/bunkerweb/db.sqlite3</code></li>
<li>MariaDB : <code>mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</code></li>
<li>MySQL : <code>mysql+pymysql://bunkerweb:changeme@bw-db:3306/db</code></li>
<li>PostgreSQL : <code>postgresql://bunkerweb:changeme@bw-db:5432/db</code></li>
</ul>
<h2 id="concepts-scheduler">Scheduler</h2>
<p>To make things automagically work together, a dedicated service called the scheduler is in charge of :</p>
<ul>
<li>Storing the settings and custom configurations inside the database</li>
<li>Executing various tasks (called jobs)</li>
<li>Generating a configuration which is understood by BunkerWeb</li>
<li>Being the intermediary for other services (like web UI or autoconf)</li>
</ul>
<p>In other words, the scheduler is the brain of BunkerWeb.</p>
<p>When using container-based integrations, the scheduler is executed in its own container. Whereas, for linux-based integrations scheduler is self-contained in the <code>bunkerweb</code> service.</p></section><section class="print-page" id="integrations"><h1 id="integrations-integrations">Integrations</h1>
<h2 id="integrations-docker">Docker</h2>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/integration-docker.svg" />
  </p>
<figcaption>Docker integration</figcaption>
</figure>
<p>Using BunkerWeb as a <a href="https://www.docker.com/">Docker</a> container is a quick and easy way to test and use it as long as you are familiar with the Docker technology.</p>
<p>We provide ready-to-use prebuilt images for x64, x86 armv8 and armv7 architectures on <a href="https://hub.docker.com/r/bunkerity/bunkerweb">Docker Hub</a> :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>bunkerity/bunkerweb:1.5.0-beta
</code></pre></div>
<p>Alternatively, you can build the Docker image directly from the <a href="https://github.com/bunkerity/bunkerweb">source</a> (and get a coffee ☕ because it may take a long time depending on your hardware) :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb.git<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">cd</span><span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-bunkerweb<span class="w"> </span>-f<span class="w"> </span>src/bunkerweb/Dockerfile<span class="w"> </span>.
</code></pre></div>
<p>Docker integration key concepts are :</p>
<ul>
<li><strong>Environment variables</strong> to configure BunkerWeb</li>
<li><strong>Scheduler</strong> container to store configuration and execute jobs</li>
<li><strong>Networks</strong> to expose ports for clients and connect to upstream web services</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>Please note that we assume you are using SQLite as database backend (which is the default for the <code>DATABASE_URI</code> setting). Other backends for this integration are still possible if you want to : see docker-compose files in the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/misc/integrations">misc/integrations folder</a> folder of the repostiory for more information.</p>
</div>
<h3 id="integrations-environment-variables">Environment variables</h3>
<p>Settings are passed to BunkerWeb using Docker environment variables :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mybunker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MY_SETTING=value</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ANOTHER_SETTING=another value</span>
<span class="nn">...</span>
</code></pre></div>
<p>Please note that the <code>bunkerweb.INSTANCE</code> is mandatory to make sure the scheduler can detect BunkerWeb instance(s).</p>
<div class="admonition info">
<p class="admonition-title">Full list</p>
<p>For the complete list of environment variables, see the <a href="#settings">settings section</a> of the documentation.</p>
</div>
<h3 id="integrations-scheduler">Scheduler</h3>
<p>The <a href="#concepts-scheduler">scheduler</a> is executed in its own container which is also available on Docker Hub :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>bunkerity/bunkerweb-scheduler:1.5.0-beta
</code></pre></div>
<p>Alternatively, you can build the Docker image directly from the <a href="https://github.com/bunkerity/bunkerweb">source</a> (less coffee ☕ needed than BunkerWeb image) :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb.git<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">cd</span><span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-scheduler<span class="w"> </span>-f<span class="w"> </span>src/scheduler/Dockerfile<span class="w"> </span>.
</code></pre></div>
<p>A volume is needed to store the SQLite database that will be used by the scheduler :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mybunker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/data</span>
<span class="nn">...</span>
<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Using local folder for persistent data</p>
<p>The scheduler runs as an <strong>unprivileged user with UID 101 and GID 101</strong> inside the container. The reason behind this is security : in case a vulnerability is exploited, the attacker won't have full root (UID/GID 0) privileges.
But there is a downside : if you use a <strong>local folder for the persistent data</strong>, you will need to <strong>set the correct permissions</strong> so the unprivileged user can write data to it. Something like that should do the trick :
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chown<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div></p>
<p>Alternatively, if the folder already exists :
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div></p>
<p>If you are using <a href="https://docs.docker.com/engine/security/rootless">Docker in rootless mode</a> or <a href="https://podman.io/">podman</a>, UIDs and GIDs in the container will be mapped to different ones in the host. You will first need to check your initial subuid and subgid :
<div class="highlight"><pre><span></span><code>grep<span class="w"> </span>^<span class="k">$(</span>whoami<span class="k">)</span>:<span class="w"> </span>/etc/subuid<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
grep<span class="w"> </span>^<span class="k">$(</span>whoami<span class="k">)</span>:<span class="w"> </span>/etc/subgid
</code></pre></div></p>
<p>For example, if you have a value of <strong>100000</strong>, the mapped UID/GID will be <strong>100100</strong> (100000 + 100) :
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>chgrp<span class="w"> </span><span class="m">100100</span><span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div></p>
<p>Or if the folder already exists :
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>chgrp<span class="w"> </span>-R<span class="w"> </span><span class="m">100100</span><span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div></p>
</div>
<p>When using Docker-based integrations, the scheduler will need to access the Docker API to get things working which is defined using the <code>DOCKER_HOST</code> environment variable.</p>
<div class="admonition warning">
<p class="admonition-title">Docker API access and security</p>
<p>Since Docker doesn't support fine-grained authorizations, accessing the API poses a security risk. An attacker with access to the API can easily gain root privileges on the host machine (more info <a href="https://blog.quarkslab.com/why-is-exposing-the-docker-socket-a-really-bad-idea.html">here</a>).</p>
<p>We strongly recommend not to mount the socket file usually located at <code>/var/run/docker.sock</code> directly in the container. An alternative, which is described here, is to use a "proxy" container like <a href="https://github.com/Tecnativa/docker-socket-proxy">tecnativa/docker-socket-proxy</a> that will allow only the necessary API calls.</p>
</div>
<p>You will need to create the Docker API proxy container, mount the socket and set the <code>DOCKER_HOST</code> environment variable to use the Docker API proxy :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">env</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINERS=1</span>
<span class="nn">...</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Docker socket in rootless mode</p>
<p>If you are using <a href="https://docs.docker.com/engine/security/rootless">Docker in rootless mode</a>, you will need to replace the mount of the docker socket with the following value : <code>$XDG_RUNTIME_DIR/docker.sock:/var/run/docker.sock:ro</code>.</p>
</div>
<h3 id="integrations-networks">Networks</h3>
<p>By default, BunkerWeb container is listening (inside the container) on <strong>8080/tcp</strong> for <strong>HTTP</strong> and <strong>8443/tcp</strong> for <strong>HTTPS</strong>.</p>
<div class="admonition warning">
<p class="admonition-title">Privileged ports in rootless mode or when using podman</p>
<p>If you are using <a href="https://docs.docker.com/engine/security/rootless">Docker in rootless mode</a> and want to redirect privileged ports (&lt; 1024) like 80 and 443 to BunkerWeb, please refer to the prerequisites <a href="https://docs.docker.com/engine/security/rootless/#exposing-privileged-ports">here</a>.</p>
<p>If you are using <a href="https://podman.io/">podman</a> you can lower the minimum number for unprivileged ports :
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>sysctl<span class="w"> </span>net.ipv4.ip_unprivileged_port_start<span class="o">=</span><span class="m">1</span>
</code></pre></div></p>
</div>
<p>The typical BunkerWeb stack when using the Docker integration contains the following containers :</p>
<ul>
<li>BunkerWeb</li>
<li>Scheduler</li>
<li>Docker socket proxy</li>
<li>Your services</li>
</ul>
<p>For defense in depth purposes, we strongly recommend to create at least three different Docker networks :</p>
<ul>
<li><code>bw-services</code> : for BunkerWeb and your web services</li>
<li><code>bw-universe</code> : for BunkerWeb and scheduler</li>
<li><code>bw-docker</code> : for scheduler and the Docker API proxy</li>
</ul>
<p>The scheduler needs to contact the API of BunkerWeb and for obvious security reason BunkerWeb needs to check if the caller is authorized to make API calls. The <code>API_WHITELIST_IP</code> setting lets you choose allowed IP addresses and subnets : usage of a static subnet for the <code>bw-universe</code> is strongly advised :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mybunker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="nn">...</span>
<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
</code></pre></div>
<h2 id="integrations-docker-autoconf">Docker autoconf</h2>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/integration-autoconf.svg" />
  </p>
<figcaption>Docker autoconf integration</figcaption>
</figure>
<div class="admonition info">
<p class="admonition-title">Docker integration</p>
<p>The Docker autoconf integration is an "evolution" of the Docker one. Please read the <a href="#integrations-docker">Docker integration section</a> first if needed.</p>
</div>
<p>The downside of using environment variables is that the container needs to be recreated each time there is an update which is not very convenient. To counter that issue, you can use another image called <strong>autoconf</strong> which will listen for Docker events and automatically reconfigure BunkerWeb in real-time without recreating the container.</p>
<p>Instead of defining environment variables for the BunkerWeb container, you simply add <strong>labels</strong> to your web applications containers and the <strong>autoconf</strong> will "automagically" take care of the rest.</p>
<div class="admonition info">
<p class="admonition-title">Multisite mode</p>
<p>The Docker autoconf integration implies the use of <strong>multisite mode</strong>. Please refer to the <a href="#concepts-multisite-mode">multisite section</a> of the documentation for more information.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>Please note that we assume you are using MariaDB as database backend (which is defined using the <code>DATABASE_URI</code> setting). Other backends for this integration are still possible if you want to : see docker-compose files in the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/misc/integrations">misc/integrations folder</a> folder of the repostiory for more information.</p>
</div>
<p>Another container, named <code>bw-autoconf</code> for example, containing the autoconf service must be added to the stack. Since two services will generate the configuration for BunkerWeb, a "real" database backend (in other words, not SQLite) also needs to be added :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP=127.0.0.0/8 10.20.30.0/24</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINERS=1</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:10.10</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_RANDOM_ROOT_PASSWORD=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE=db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_USER=bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD=changeme</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Using Docker in rootless mode</p>
<p>If you are using <a href="https://docs.docker.com/engine/security/rootless">Docker in rootless mode</a>, you will need to replace the mount of the docker socket with the following value : <code>$XDG_RUNTIME_DIR/docker.sock:/var/run/docker.sock:ro</code>.</p>
</div>
<p>Once the stack is set up, you will be able to create the web application container and add the settings as labels using the "bunkerweb." prefix in order to automatically set up BunkerWeb :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mywebapp:4.2</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">networks</span><span class="p p-Indicator">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">          </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">    </span><span class="w w-Error">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.MY_SETTING_1=value1&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.MY_SETTING_2=value2&quot;</span>
<span class="nn">...</span>
<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="nn">...</span>
</code></pre></div>
<h2 id="integrations-swarm">Swarm</h2>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/integration-swarm.svg" />
  </p>
<figcaption>Docker Swarm integration</figcaption>
</figure>
<div class="admonition info">
<p class="admonition-title">Docker autoconf</p>
<p>The Docker autoconf integration is similar to the Docker autoconf one (but with services instead of containers). Please read the <a href="#integrations-docker-autoconf">Docker autoconf integration section</a> first if needed.</p>
</div>
<p>To automatically configure BunkerWeb instances, a special service called <strong>autoconf</strong>, will be scheduled on a manager node. That service will listen for Docker Swarm events like service creation or deletion and automatically configure the <strong>BunkerWeb instances</strong> in real-time without downtime. It also monitors other Swarm objects like <a href="https://docs.docker.com/engine/swarm/configs/">configs</a> for custom configurations.</p>
<p>Like the <a href="#integrations-docker-autoconf">Docker autoconf integration</a>, configuration for web services is defined by using labels starting with the special <strong>bunkerweb.</strong> prefix.</p>
<p>The recommended setup is to schedule the <strong>BunkerWeb service</strong> as a <strong>global service</strong> on all nodes and the <strong>autoconf, scheduler and Docker API proxy services</strong> as <strong>single replicated services</strong>. Please note that the <strong>Docker API proxy service</strong> needs to be scheduled on a manager node unless you configure it to use a remote API (which is not covered in the documentation).</p>
<p>Since we have multiple instances of BunkerWeb running, a shared data store implemented as a <a href="https://redis.io/">Redis</a> service must be created : the instances will use it to cache and share data. You will find more information about the Redis settings <a href="#settings-redis">here</a></p>
<p>Using a shared folder or a specific driver for the database volume is left as an exercise for the reader (and depends on your own use-case).</p>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>Please note that we assume you are using MariaDB as database backend (which is defined using the <code>DATABASE_URI</code> setting). Other backends for this integration are still possible if you want to : see docker-compose files in the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/misc/integrations">misc/integrations folder</a> folder of the repostiory for more information. Clustered database backends setup are out-of-the-scope of this documentation.</p>
</div>
<p>Here is the stack boilerplate that you can deploy using <code>docker stack deploy</code> :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME=</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SWARM_MODE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REDIS=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_HOST=bw-redis</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP=127.0.0.0/8 10.20.30.0/24</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">global</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE&quot;</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:1.5.0-beta</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SWARM_MODE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONFIGS=1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINERS=1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVICES=1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SWARM=1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TASKS=1</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">manager&quot;</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SWARM_MODE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:10.10</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_RANDOM_ROOT_PASSWORD=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE=db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_USER=bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD=changeme</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>

<span class="w">  </span><span class="nt">bw-redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>Please note that the <code>SWARM_MODE=yes</code> environment variable is mandatory when using the Swarm integration.</p>
<p>Once the BunkerWeb Swarm stack is set up and running (see autoconf and scheduler logs for more information), you will be able to deploy web applications in the cluster and use labels to dynamically configure BunkerWeb :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mywebapp:4.2</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.MY_SETTING_1=value1&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.MY_SETTING_2=value2&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
<h2 id="integrations-kubernetes">Kubernetes</h2>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/integration-kubernetes.svg" />
  </p>
<figcaption>Kubernetes integration</figcaption>
</figure>
<p>The autoconf acts as an <a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/">Ingress controller</a> and will configure the BunkerWeb instances according to the <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress resources</a>. It also monitors other Kubernetes objects like <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMap</a> for custom configurations.</p>
<p>The recommended setup is to define <strong>BunkerWeb</strong> as a <strong><a href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/">DaemonSet</a></strong> which will create a pod on all nodes and the <strong>autoconf and scheduler</strong> as <strong>single replicated <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a></strong>.</p>
<p>Since we have multiple instances of BunkerWeb running, a shared data store implemented as a <a href="https://redis.io/">Redis</a> service must be created : the instances will use it to cache and share data. You will find more information about the Redis settings <a href="#settings-redis">here</a></p>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>Please note that we assume you are using MariaDB as database backend (which is defined using the <code>DATABASE_URI</code> setting). Other backends for this integration are still possible if you want to : see yaml files in the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/misc/integrations">misc/integrations folder</a> folder of the repostiory for more information. Clustered database backends setup are out-of-the-scope of this documentation.</p>
</div>
<p>Please note that both scheduler and autoconf services needs to access the Kubernetes API. The recommended way of doing it is using <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC authorization</a>.</p>
<p>Another important thing is the <code>KUBERNETES_MODE=yes</code> environment variable which is mandatory when using the Kubernetes integration.</p>
<p>Here is the yaml boilerplate you can use as a base :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cr-bunkerweb</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;services&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pods&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;configmaps&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;networking.k8s.io&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;ingresses&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crb-bunkerweb</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">    </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cr-bunkerweb</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="c1"># mandatory annotation</span>
<span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bunkerweb.io/INSTANCE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">            </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">101</span>
<span class="w">            </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">101</span>
<span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span>
<span class="w">              </span><span class="nt">drop</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">              </span><span class="nt">hostPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">              </span><span class="nt">hostPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="c1"># replace with your DNS resolvers</span>
<span class="w">            </span><span class="c1"># e.g. : kube-dns.kube-system.svc.cluster.local</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS_RESOLVERS</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;coredns.kube-system.svc.cluster.local&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_API</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="c1"># 10.0.0.0/8 is the cluster internal subnet</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.0.0.0/8&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REDIS</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_HOST</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;svc-bunkerweb-redis.default.svc.cluster.local&quot;</span>
<span class="w">          </span><span class="nt">livenessProbe</span><span class="p">:</span>
<span class="w">            </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">              </span><span class="nt">command</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/bunkerweb/helpers/healthcheck.sh</span>
<span class="w">            </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">            </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">            </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">          </span><span class="nt">readinessProbe</span><span class="p">:</span>
<span class="w">            </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">              </span><span class="nt">command</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/bunkerweb/helpers/healthcheck.sh</span>
<span class="w">            </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">            </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:1.5.0-beta</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DATABASE_URI&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@svc-bunkerweb-db:3306/db&quot;</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DATABASE_URI&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@svc-bunkerweb-db:3306/db&quot;</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:10.10</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_RANDOM_ROOT_PASSWORD</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MYSQL_DATABASE&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MYSQL_USER&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MYSQL_PASSWORD&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/var/lib/mysql&quot;</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-db</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-db</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pvc-bunkerweb</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb-db</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb-redis</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pvc-bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5Gi</span>
</code></pre></div>
<p>Once the BunkerWeb Kubernetes stack is set up and running (see autoconf logs for more information), you will be able to deploy web applications in the cluster and declare your Ingress resource. Please note that <a href="#settings">settings</a> need to be set as annotations for the Ingress resource with the special value <strong>bunkerweb.io</strong> for the domain part :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-ingress</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/MY_SETTING</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span>
<span class="w">    </span><span class="nt">bunkerweb.io/www.example.com_MY_SETTING</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-my-app</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<span class="nn">...</span>
</code></pre></div>
<h2 id="integrations-linux">Linux</h2>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/integration-linux.svg" />
  </p>
<figcaption>Linux integration</figcaption>
</figure>
<p>List of supported Linux distros :</p>
<ul>
<li>Debian 11 "Bullseye"</li>
<li>Ubuntu 22.04 "Jammy"</li>
<li>Fedora 37</li>
<li>RedHat Enterprise Linux (RHEL) 8.7</li>
</ul>
<p>Please note that you will need to <strong>install NGINX 1.24.0 before BunkerWeb</strong>. For all distros, except Fedora, using prebuilt packages from <a href="https://nginx.org/en/linux_packages.html">official NGINX repository</a> is mandatory. Compiling NGINX from source or using packages from different repositories won't work with the official prebuilt packages of BunkerWeb but you can build it from source.</p>
<p>Repositories of Linux packages for BunkerWeb are available on <a href="https://packagecloud.io/bunkerity/bunkerweb">PackageCloud</a>. They provide a bash script to add and trust the repository automatically (but you can also follow the <a href="https://packagecloud.io/bunkerity/bunkerweb/install">manual installation</a> instructions if you prefer).</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="integrations-__tabbed_1_1" name="integrations-__tabbed_1" type="radio" /><input id="integrations-__tabbed_1_2" name="integrations-__tabbed_1" type="radio" /><input id="integrations-__tabbed_1_3" name="integrations-__tabbed_1" type="radio" /><input id="integrations-__tabbed_1_4" name="integrations-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="integrations-__tabbed_1_1">Debian</label><label for="integrations-__tabbed_1_2">Ubuntu</label><label for="integrations-__tabbed_1_3">Fedora</label><label for="integrations-__tabbed_1_4">RedHat</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>The first step is to add NGINX official repository :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>curl<span class="w"> </span>gnupg2<span class="w"> </span>ca-certificates<span class="w"> </span>lsb-release<span class="w"> </span>debian-archive-keyring<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
curl<span class="w"> </span>https://nginx.org/keys/nginx_signing.key<span class="w"> </span><span class="p">|</span><span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/usr/share/keyrings/nginx-archive-keyring.gpg<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \</span>
<span class="s2">http://nginx.org/packages/debian `lsb_release -cs` nginx&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/nginx.list
</code></pre></div>
<p>You should now be able to install NGINX 1.24.0 :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">nginx</span><span class="o">=</span><span class="m">1</span>.24.0-1~<span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span>
</code></pre></div>
<p>And finally install BunkerWeb 1.5.0-beta :</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://packagecloud.io/install/repositories/bunkerity/bunkerweb/script.deb.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">bunkerweb</span><span class="o">=</span><span class="m">1</span>.5.0-beta
</code></pre></div>
<p>To prevent upgrading NGINX and/or BunkerWeb packages when executing <code>apt upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-mark<span class="w"> </span>hold<span class="w"> </span>nginx<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The first step is to add NGINX official repository :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>curl<span class="w"> </span>gnupg2<span class="w"> </span>ca-certificates<span class="w"> </span>lsb-release<span class="w"> </span>ubuntu-keyring<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
curl<span class="w"> </span>https://nginx.org/keys/nginx_signing.key<span class="w"> </span><span class="p">|</span><span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/usr/share/keyrings/nginx-archive-keyring.gpg<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \</span>
<span class="s2">http://nginx.org/packages/ubuntu `lsb_release -cs` nginx&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/nginx.list
</code></pre></div>
<p>You should now be able to install NGINX 1.24.0 :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">nginx</span><span class="o">=</span><span class="m">1</span>.24.0-1~jammy
</code></pre></div>
<p>And finally install BunkerWeb 1.5.0-beta :</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://packagecloud.io/install/repositories/bunkerity/bunkerweb/script.deb.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">bunkerweb</span><span class="o">=</span><span class="m">1</span>.5.0-beta
</code></pre></div>
<p>To prevent upgrading NGINX and/or BunkerWeb packages when executing <code>apt upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-mark<span class="w"> </span>hold<span class="w"> </span>nginx<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Fedora already provides NGINX 1.24.0 that we support :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nginx-1.24.0
</code></pre></div>
<p>And finally install BunkerWeb 1.5.0_beta :</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://packagecloud.io/install/repositories/bunkerity/bunkerweb/script.rpm.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
sed<span class="w"> </span><span class="s1">&#39;s/yum install -y pygpgme --disablerepo=&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;bunkerity_bunkerweb&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;/yum install -y python-gnupg/g&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
sed<span class="w"> </span><span class="s1">&#39;s/pypgpme_check=`rpm -qa | grep -qw pygpgme`/python-gnupg_check=`rpm -qa | grep -qw python-gnupg`/g&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>makecache<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bunkerweb-1.5.0-beta
</code></pre></div>
<p>To prevent upgrading NGINX and/or BunkerWeb packages when executing <code>dnf upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>nginx<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The first step is to add NGINX official repository. Create the following file at <code>/etc/yum.repos.d/nginx.repo</code> :</p>
<div class="highlight"><pre><span></span><code>[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true

[nginx-mainline]
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
</code></pre></div>
<p>You should now be able to install NGINX 1.24.0 :</p>
<p><div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>nginx-1.24.0
</code></pre></div>
And finally install BunkerWeb 1.5.0-beta :</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>epel-release<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
curl<span class="w"> </span>-s<span class="w"> </span>https://packagecloud.io/install/repositories/bunkerity/bunkerweb/script.rpm.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>check-update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bunkerweb-1.5.0_beta
</code></pre></div>
<p>To prevent upgrading NGINX and/or BunkerWeb packages when executing <code>dnf upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>nginx<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
</div>
</div>
<!---
=== "CentOS Stream"

    The first step is to add NGINX official repository. Create the following file at `/etc/yum.repos.d/nginx.repo` :
    <div class="highlight"><pre><span></span><code>[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
</code></pre></div>

    You should now be able to install NGINX 1.24.0 :
    <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>nginx-1.24.0
</code></pre></div>

    And finally install BunkerWeb 1.5.0-beta :
    <div class="highlight"><pre><span></span><code><span class="w">  </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>epel-release<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
curl<span class="w"> </span>-s<span class="w"> </span>https://packagecloud.io/install/repositories/bunkerity/bunkerweb/script.rpm.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>check-update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bunkerweb-1.5.0-beta
</code></pre></div>

    To prevent upgrading NGINX and/or BunkerWeb packages when executing `dnf upgrade`, you can use the following command :
    <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>nginx<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>bunkerweb
</code></pre></div>


=== "From source"

    The first step is to install NGINX 1.24.0 using the repository of your choice or by [compiling it from source](https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/#compiling-and-installing-from-source).

    The target installation folder of BunkerWeb is located at `/usr/share/bunkerweb`, let's create it :
    <div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>/usr/share/bunkerweb
</code></pre></div>

    You can now clone the BunkerWeb project to the `/tmp` folder :
    <div class="highlight"><pre><span></span><code>https://github.com/bunkerity/bunkerweb.git<span class="w"> </span>/tmp/bunkerweb
</code></pre></div>

    BunkerWeb needs some dependencies to be compiled and installed to `/usr/share/bunkerweb/deps`, the easiest way to do it is by executing the [install.sh helper script](https://github.com/bunkerity/bunkerweb/blobdeps/install.sh) (please note that you will need to install additional packages which is not covered in this procedure and depends on your own system) :
    <div class="highlight"><pre><span></span><code>mkdir /usr/share/bunkerweb/deps &amp;&amp; \
/tmp/bunkerweb/src/deps/install.sh
</code></pre></div>

    Additional Python dependencies needs to be installed into the `/usr/share/bunkerweb/deps/python` folder :
    <div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>/usr/share/bunkerweb/src/deps/python<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>--require-hashes<span class="w"> </span>--target<span class="w"> </span>/usr/share/bunkerweb/deps/python<span class="w"> </span>-r<span class="w"> </span>/tmp/bunkerweb/deps/requirements.txt<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>--target<span class="w"> </span>/usr/share/bunkerweb/deps/python<span class="w"> </span>-r<span class="w"> </span>/tmp/bunkerweb/src/ui/requirements.txt
</code></pre></div>

    Once dependencies are installed, you will be able to copy the BunkerWeb sources to the target `/usr/share/bunkerweb` folder :
    <div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span>src<span class="w"> </span><span class="k">in</span><span class="w"> </span>api<span class="w"> </span>cli<span class="w"> </span>confs<span class="w"> </span>core<span class="w"> </span>gen<span class="w"> </span>helpers<span class="w"> </span>job<span class="w"> </span>lua<span class="w"> </span>misc<span class="w"> </span>utils<span class="w"> </span>ui<span class="w"> </span>settings.json<span class="w"> </span>VERSION<span class="w"> </span>linux/variables.env<span class="w"> </span>linux/ui.env<span class="w"> </span>linux/scripts<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>cp<span class="w"> </span>-r<span class="w"> </span>/tmp/bunkerweb/<span class="si">${</span><span class="nv">src</span><span class="si">}</span><span class="w"> </span>/usr/share/bunkerweb
<span class="k">done</span>
cp<span class="w"> </span>/usr/share/bunkerweb/helpers/bwcli<span class="w"> </span>/usr/local/bin
</code></pre></div>

    Additional folders also need to be created :
    <div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/bunkerweb/<span class="o">{</span>configs,plugins<span class="o">}</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>/var/cache/bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>/var/tmp/bunkerweb
</code></pre></div>

    Permissions needs to be fixed :
    <div class="highlight"><pre><span></span><code>find<span class="w"> </span>/usr/share/bunkerweb<span class="w"> </span>-path<span class="w"> </span>/usr/share/bunkerweb/deps<span class="w"> </span>-prune<span class="w"> </span>-o<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0740</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/usr/share/bunkerweb<span class="w"> </span>-path<span class="w"> </span>/usr/share/bunkerweb/deps<span class="w"> </span>-prune<span class="w"> </span>-o<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/usr/share/bunkerweb/core/*/jobs/*<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span><span class="m">770</span><span class="w"> </span>/var/cache/bunkerweb<span class="w"> </span>/var/tmp/bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span><span class="m">750</span><span class="w"> </span>/usr/share/bunkerweb/gen/main.py<span class="w"> </span>/usr/share/bunkerweb/scheduler/main.py<span class="w"> </span>/usr/share/bunkerweb/cli/main.py<span class="w"> </span>/usr/share/bunkerweb/helpers/*.sh<span class="w"> </span>/usr/share/bunkerweb/scripts/*.sh<span class="w"> </span>/usr/bin/bwcli<span class="w"> </span>/usr/share/bunkerweb/ui/main.py<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chown<span class="w"> </span>-R<span class="w"> </span>root:nginx<span class="w"> </span>/usr/share/bunkerweb
</code></pre></div>

    Last but not least, you will need to set up systemd unit files :
    <div class="highlight"><pre><span></span><code>cp<span class="w"> </span>/tmp/bunkerweb/linux/*.service<span class="w"> </span>/etc/systemd/system<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
systemctl<span class="w"> </span>daemon-reload<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
systemctl<span class="w"> </span>stop<span class="w"> </span>nginx<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
systemctl<span class="w"> </span>disable<span class="w"> </span>nginx<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>bunkerweb-ui
</code></pre></div>
--->

<p>The configuration of BunkerWeb is done by editing the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>MY_SETTING_1=value1
MY_SETTING_2=value2
...
</code></pre></div>
<p>BunkerWeb is managed using systemctl :</p>
<ul>
<li>Check BunkerWeb status : <code>systemctl status bunkerweb</code></li>
<li>Start it if it's stopped : <code>systemctl start bunkerweb</code></li>
<li>Stop it if it's started : <code>systemctl stop bunkerweb</code></li>
<li>And restart : <code>systemctl restart bunkerweb</code></li>
</ul>
<h2 id="integrations-ansible">Ansible</h2>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/integration-ansible.svg" />
  </p>
<figcaption>Ansible integration</figcaption>
</figure>
<p>List of supported Linux distros :</p>
<ul>
<li>Debian 11 "Bullseye"</li>
<li>Ubuntu 22.04 "Jammy"</li>
<li>Fedora 37</li>
<li>CentOS Stream 8</li>
<li>RedHat Enterprise Linux (RHEL) 8.7</li>
</ul>
<p><a href="https://docs.ansible.com/ansible/latest/index.html">Ansible</a> is an IT automation tool. It can configure systems, deploy software, and orchestrate more advanced IT tasks such as continuous deployments or zero downtime rolling updates.</p>
<p>A specific BunkerWeb Ansible role is available on <a href="https://galaxy.ansible.com/bunkerity/bunkerweb">Ansible Galaxy</a>.</p>
<p>First of all, download the role from ansible-galaxy :
<div class="highlight"><pre><span></span><code>ansible-galaxy<span class="w"> </span>install<span class="w"> </span>bunkerity.bunkerweb
</code></pre></div></p>
<p>Next, create an inventory by adding the IP adress or FQDN of one or more remote systems, either in <code>/etc/ansible/hosts</code> or in your own playbook <code>inventory.yml</code> :
<div class="highlight"><pre><span></span><code><span class="k">[mybunkers]</span>
<span class="mf">192.0.2.50</span>
<span class="mf">192.0.2.51</span>
<span class="mf">192.0.2.52</span>
</code></pre></div></p>
<p>The next step we're going to set up is the SSH connection so Ansible can connect to the managed nodes. Add your public SSH keys to the <code>authorized_keys</code> file on each remote system and ensure you can successfully connect. </p>
<p>In order to use the role, we will create the playbook file named <code>playbook.yml</code> for example :
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity.bunkerweb</span>
</code></pre></div></p>
<p>Run the playbook :
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>playbook.yml
</code></pre></div></p>
<p>Configuration of BunkerWeb is done by using specific role variables :</p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th align="center">Type</th>
<th>Description</th>
<th>Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>bunkerweb_version</code></td>
<td align="center">string</td>
<td>Version of BunkerWeb to install.</td>
<td><code>1.5.0-beta</code></td>
</tr>
<tr>
<td align="center"><code>nginx_version</code></td>
<td align="center">string</td>
<td>Version of NGINX to install.</td>
<td><code>1.24.0</code></td>
</tr>
<tr>
<td align="center"><code>freeze_versions</code></td>
<td align="center">boolean</td>
<td>Prevent upgrade of BunkerWeb and NGINX when performing packages upgrades.</td>
<td><code>true</code></td>
</tr>
<tr>
<td align="center"><code>variables_env</code></td>
<td align="center">string</td>
<td>Path of the variables.env file to configure BunkerWeb.</td>
<td><code>files/variables.env</code></td>
</tr>
<tr>
<td align="center"><code>enable_ui</code></td>
<td align="center">boolean</td>
<td>Activate the web UI.</td>
<td><code>false</code></td>
</tr>
<tr>
<td align="center"><code>custom_ui</code></td>
<td align="center">string</td>
<td>Path of the ui.env file to configure the web UI.</td>
<td><code>files/ui.env</code></td>
</tr>
<tr>
<td align="center"><code>custom_configs_path</code></td>
<td align="center">Dictionary</td>
<td>Each entry is a path of the folder containing custom configurations. Keys are the type of custom configs : <code>http</code>, <code>server-http</code>, <code>modsec</code>, <code>modsec-crs</code> and <code>default-server-http</code></td>
<td>empty values</td>
</tr>
<tr>
<td align="center"><code>custom_www</code></td>
<td align="center">string</td>
<td>Path of the www directory to upload.</td>
<td>empty value</td>
</tr>
<tr>
<td align="center"><code>custom_plugins</code></td>
<td align="center">string</td>
<td>Path of the plugins directory to upload.</td>
<td>empty value</td>
</tr>
<tr>
<td align="center"><code>custom_www_owner</code></td>
<td align="center">string</td>
<td>Default owner for www files and folders.</td>
<td><code>nginx</code></td>
</tr>
<tr>
<td align="center"><code>custom_www_group</code></td>
<td align="center">string</td>
<td>Default group for www files and folders.</td>
<td><code>nginx</code></td>
</tr>
</tbody>
</table>
<h2 id="integrations-vagrant">Vagrant</h2>
<!-- TODO
<figure markdown>
  ![Overview](assets/img/integration-vagrant.svg){ align=center }
  <figcaption>BunkerWeb integration with Vagrant</figcaption>
</figure>
-->
<p>List of supported providers :</p>
<ul>
<li>vmware_desktop </li>
<li>virtualbox </li>
<li>libvirt</li>
</ul>
<p><strong><em>Note on Supported Base Images</em></strong>  </p>
<p>Please be aware that the provided Vagrant boxes are based <strong>exclusively on Ubuntu 22.04 "Jammy"</strong>. While BunkerWeb supports other Linux distributions, the Vagrant setup currently only supports Ubuntu 22.04 as the base operating system. This ensures a consistent and reliable environment for users who want to deploy BunkerWeb using Vagrant.</p>
<p>Similar to other BunkerWeb integrations, the Vagrant setup uses <strong>NGINX version 1.24.0</strong>. This specific version is required to ensure compatibility and smooth functioning with BunkerWeb. Additionally, the Vagrant box includes <strong>PHP</strong> pre-installed, providing a ready-to-use environment for hosting PHP-based applications alongside BunkerWeb.</p>
<p>By using the provided Vagrant box based on Ubuntu 22.04 "Jammy", you benefit from a well-configured and integrated setup, allowing you to focus on developing and securing your applications with BunkerWeb without worrying about the underlying infrastructure.</p>
<p>Here are the steps to install BunkerWeb using Vagrant on Ubuntu with the supported virtualization providers (VirtualBox, VMware, and libvirt):</p>
<ol>
<li>Make sure you have Vagrant and one of the supported virtualization providers (VirtualBox, VMware, or libvirt) installed on your system.</li>
<li>There are two ways to install the Vagrant box with BunkerWeb: either by using a provided Vagrantfile to configure your virtual machine or by creating a new box based on the existing BunkerWeb Vagrant box, offering you flexibility in how you set up your development environment.</li>
</ol>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="integrations-__tabbed_2_1" name="integrations-__tabbed_2" type="radio" /><input id="integrations-__tabbed_2_2" name="integrations-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="integrations-__tabbed_2_1">Vagrantfile</label><label for="integrations-__tabbed_2_2">New Vagrant Box</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Vagrant.configure<span class="o">(</span><span class="s2">&quot;2&quot;</span><span class="o">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">|</span>config<span class="p">|</span>
<span class="w">  </span>config.vm.box<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;bunkerity/bunkerweb&quot;</span>
end
</code></pre></div>
<p>Depending on the virtualization provider you choose, you may need to install additional plugins:</p>
<ul>
<li>For <strong>VMware</strong>, install the <code>vagrant-vmware-desktop</code> plugin. For more information, see the <a href="https://www.vagrantup.com/docs/providers">Vagrant documentation</a>.</li>
<li>For <strong>libvirt</strong>, install the <code>vagrant-libvirt plugin</code>. For more information, see the <a href="https://www.vagrantup.com/docs/providers">Vagrant documentation</a>.</li>
<li>For <strong>VirtualBox</strong>, install the <code>vagrant-vbguest</code> plugin. For more information, see the <a href="https://www.vagrantup.com/docs/providers">Vagrant documentation</a>.</li>
</ul>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>vagrant<span class="w"> </span>init<span class="w"> </span>bunkerity/bunkerweb
</code></pre></div>
<p>Depending on the virtualization provider you choose, you may need to install additional plugins:</p>
<ul>
<li>For <strong>VMware</strong>, install the <code>vagrant-vmware-desktop</code> plugin. For more information, see the <a href="https://www.vagrantup.com/docs/providers">Vagrant documentation</a>.</li>
<li>For <strong>libvirt</strong>, install the <code>vagrant-libvirt plugin</code>. For more information, see the <a href="https://www.vagrantup.com/docs/providers">Vagrant documentation</a>.</li>
<li>For <strong>VirtualBox</strong>, install the <code>vagrant-vbguest</code> plugin. For more information, see the <a href="https://www.vagrantup.com/docs/providers">Vagrant documentation</a>.</li>
</ul>
</div>
</div>
</div>
<p>After installing the necessary plugins for your chosen virtualization provider, run the following command to start the virtual machine and install BunkerWeb:</p>
<div class="highlight"><pre><span></span><code>vagrant<span class="w"> </span>up<span class="w"> </span>--provider<span class="o">=</span>virtualbox<span class="w"> </span><span class="c1"># or --provider=vmware_desktop or --provider=libvirt</span>
</code></pre></div>
<p>Finally, to access the virtual machine using SSH, execute the following command:</p>
<div class="highlight"><pre><span></span><code>vagrant<span class="w"> </span>ssh
</code></pre></div>
<p><strong>Example Vagrantfile</strong></p>
<p>Here is an example <code>Vagrantfile</code> for installing BunkerWeb on Ubuntu 22.04 "Jammy" using the different supported virtualization providers:</p>
<div class="highlight"><pre><span></span><code>Vagrant.configure<span class="o">(</span><span class="s2">&quot;2&quot;</span><span class="o">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">|</span>config<span class="p">|</span>
<span class="w">  </span><span class="c1"># Ubuntu 22.04 &quot;Jammy&quot;</span>
<span class="w">  </span>config.vm.box<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;bunkerity/bunkerweb&quot;</span>
<span class="w">  </span><span class="c1"># Uncomment the desired virtualization provider</span>
<span class="w">  </span><span class="c1"># For VirtualBox (default)</span>
<span class="w">  </span>config.vm.provider<span class="w"> </span><span class="s2">&quot;virtualbox&quot;</span>
<span class="w">  </span><span class="c1"># For VMware</span>
<span class="w">  </span><span class="c1"># config.vm.provider &quot;vmware_desktop&quot; # Windows</span>
<span class="w">  </span><span class="c1"># config.vm.provider &quot;vmware_workstation&quot; # Linux</span>
<span class="w">  </span><span class="c1"># For libvirt</span>
<span class="w">  </span><span class="c1"># config.vm.provider &quot;libvirt&quot;</span>
end
</code></pre></div></section><section class="print-page" id="quickstart-guide"><h1 id="quickstart-guide-quickstart-guide">Quickstart guide</h1>
<div class="admonition info">
<p class="admonition-title">Prerequisites</p>
<p>We assume that you're already familiar with the <a href="#concepts">core concepts</a> and you have followed the <a href="#integrations">integrations instructions</a> for your environment.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Going further<p>To demonstrate the use of BunkerWeb, we will deploy a dummy "Hello World" web application as an example. See the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/examples">examples folder</a> of the repository to get real-world examples.</p>
</p>
</div>
<h2 id="quickstart-guide-protect-http-applications">Protect HTTP applications</h2>
<p>Protecting existing web applications already accessible with the HTTP(S) protocol is the main goal of BunkerWeb : it will act as a classical <a href="https://en.wikipedia.org/wiki/Reverse_proxy">reverse proxy</a> with extra security features.</p>
<p>The following settings can be used :</p>
<ul>
<li><code>USE_REVERSE_PROXY</code> : enable/disable reverse proxy mode</li>
<li><code>REVERSE_PROXY_URL</code> : the public path prefix</li>
<li><code>REVERSE_PROXY_HOST</code> : (internal) address of the proxied web application</li>
</ul>
<p>You will find more settings about reverse proxy in the <a href="#settings-reverse-proxy">settings section</a> of the documentation.</p>
<h3 id="quickstart-guide-single-application">Single application</h3>
<div class="tabbed-set tabbed-alternate" data-tabs="1:7"><input checked="checked" id="quickstart-guide-__tabbed_1_1" name="quickstart-guide-__tabbed_1" type="radio" /><input id="quickstart-guide-__tabbed_1_2" name="quickstart-guide-__tabbed_1" type="radio" /><input id="quickstart-guide-__tabbed_1_3" name="quickstart-guide-__tabbed_1" type="radio" /><input id="quickstart-guide-__tabbed_1_4" name="quickstart-guide-__tabbed_1" type="radio" /><input id="quickstart-guide-__tabbed_1_5" name="quickstart-guide-__tabbed_1" type="radio" /><input id="quickstart-guide-__tabbed_1_6" name="quickstart-guide-__tabbed_1" type="radio" /><input id="quickstart-guide-__tabbed_1_7" name="quickstart-guide-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="quickstart-guide-__tabbed_1_1">Docker</label><label for="quickstart-guide-__tabbed_1_2">Docker autoconf</label><label for="quickstart-guide-__tabbed_1_3">Swarm</label><label for="quickstart-guide-__tabbed_1_4">Kubernetes</label><label for="quickstart-guide-__tabbed_1_5">Linux</label><label for="quickstart-guide-__tabbed_1_6">Ansible</label><label for="quickstart-guide-__tabbed_1_7">Vagrant</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>When using Docker integration, the easiest way of protecting an existing application is to add the web service in the <code>bw-services</code> network :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span>

<span class="nt">services</span><span class="p">:</span>

<span class="w">  </span><span class="nt">myapp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80:8080</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443:8443</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME=www.example.com</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP=127.0.0.0/8 10.20.30.0/24</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REVERSE_PROXY=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REVERSE_PROXY_URL=/</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REVERSE_PROXY_HOST=http://myapp</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/data</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINERS=1</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have the <a href="#integrations-docker-autoconf">Docker autoconf integration</a> stack running on your machine and connected to a network called <code>bw-services</code> so you can connect your existing application and configure BunkerWeb with labels :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=www.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://myapp&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have the <a href="#integrations-swarm">Swarm integration</a> stack running on your cluster and connected to a network called <code>bw-services</code> so you can connect your existing application and configure BunkerWeb with labels :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">          </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=www.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://myapp&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have the <a href="#integrations-kubernetes">Kubernetes integration</a> stack running on your cluster.</p>
<p>Let's assume that you have a typical Deployment with a Service to access the web application from within the cluster :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
<p>Here is the corresponding Ingress definition to serve and protect the web application :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/DUMMY_SETTING</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app</span>
<span class="w">              </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have the <a href="#integrations-linux">Linux integration</a> stack running on your machine.</p>
<p>The following command will run a basic HTTP server on the port 8000 and deliver the files in the current directory :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span>-b<span class="w"> </span><span class="m">127</span>.0.0.1
</code></pre></div>
<p>Configuration of BunkerWeb is done by editing the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=8.8.8.8 8.8.4.4
SERVER_NAME=www.example.com
USE_REVERSE_PROXY=yes
REVERSE_PROXY_URL=/
REVERSE_PROXY_HOST=http://127.0.0.1:8000
</code></pre></div>
<p>Let's check the status of BunkerWeb :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb
</code></pre></div>
<p>If it's already running, we can restart it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb
</code></pre></div>
<p>Otherwise, we will need to start it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have a service running and you want to use BunkerWeb as a reverse-proxy.</p>
<p>The following command will run a basic HTTP server on the port 8000 and deliver the files in the current directory :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span>-b<span class="w"> </span><span class="m">127</span>.0.0.1
</code></pre></div>
<p>Content of the <code>my_variables.env</code> configuration file :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=8.8.8.8 8.8.4.4
SERVER_NAME=www.example.com
USE_REVERSE_PROXY=yes
REVERSE_PROXY_URL=/
REVERSE_PROXY_HOST=http://127.0.0.1:8000
</code></pre></div>
<p>In your Ansible inventory, you can use the <code>variables_env</code> variable to set the path of configuration file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">[</span><span class="nv">mybunkers</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.42 variables_env=&quot;{{ playbook_dir }}/my_variables.env&quot;</span>
</code></pre></div>
<p>Or alternatively, in your playbook file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">variables_env</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/my_variables.env&quot;</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity.bunkerweb</span>
</code></pre></div>
<p>You can now run the playbook :</p>
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>playbook.yml
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have the <a href="#integrations-vagrant">Vagrant integration</a> stack running on your machine.</p>
<p>The following command will run a basic HTTP server on the port 8000 and deliver the files in the current directory :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span>-b<span class="w"> </span><span class="m">127</span>.0.0.1
</code></pre></div>
<p>Configuration of BunkerWeb is done by editing the <code>/etc/bunkerweb/variables.env</code> file.</p>
<p>Connect to your vagrant machine :</p>
<div class="highlight"><pre><span></span><code>vagrant<span class="w"> </span>ssh
</code></pre></div>
<p>And then you can edit the <code>variables.env</code> file in your host machine like this :</p>
<div class="highlight"><pre><span></span><code>SERVER_NAME=www.example.com
HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=8.8.8.8 8.8.4.4
USE_REVERSE_PROXY=yes
REVERSE_PROXY_URL=/
REVERSE_PROXY_HOST=http://127.0.0.1:8000
</code></pre></div>
<p>Let's check the status of BunkerWeb :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb
</code></pre></div>
<p>If it's already running we can restart it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb
</code></pre></div>
<p>Otherwise, we will need to start it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
</div>
</div>
<h3 id="quickstart-guide-multiple-applications">Multiple applications</h3>
<div class="admonition tip">
<p class="admonition-title">Testing</p>
<p>To perform quick tests when multisite mode is enabled (and if you don't have the proper DNS entries set up for the domains) you can use curl with the HTTP Host header of your choice :</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Host: app1.example.com&quot;</span><span class="w"> </span>http://ip-or-fqdn-of-server
</code></pre></div>
<p>If you are using HTTPS, you will need to play with SNI :</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Host: app1.example.com&quot;</span><span class="w"> </span>--resolve<span class="w"> </span>example.com:443:ip-of-server<span class="w"> </span>https://example.com
</code></pre></div>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="2:7"><input checked="checked" id="quickstart-guide-__tabbed_2_1" name="quickstart-guide-__tabbed_2" type="radio" /><input id="quickstart-guide-__tabbed_2_2" name="quickstart-guide-__tabbed_2" type="radio" /><input id="quickstart-guide-__tabbed_2_3" name="quickstart-guide-__tabbed_2" type="radio" /><input id="quickstart-guide-__tabbed_2_4" name="quickstart-guide-__tabbed_2" type="radio" /><input id="quickstart-guide-__tabbed_2_5" name="quickstart-guide-__tabbed_2" type="radio" /><input id="quickstart-guide-__tabbed_2_6" name="quickstart-guide-__tabbed_2" type="radio" /><input id="quickstart-guide-__tabbed_2_7" name="quickstart-guide-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="quickstart-guide-__tabbed_2_1">Docker</label><label for="quickstart-guide-__tabbed_2_2">Docker autoconf</label><label for="quickstart-guide-__tabbed_2_3">Swarm</label><label for="quickstart-guide-__tabbed_2_4">Kubernetes</label><label for="quickstart-guide-__tabbed_2_5">Linux</label><label for="quickstart-guide-__tabbed_2_6">Ansible</label><label for="quickstart-guide-__tabbed_2_7">Vagrant</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>When using Docker integration, the easiest way of protecting an existing application is to add the web service in the <code>bw-services network</code> :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">myapp3</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80:8080</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443:8443</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP=127.0.0.0/8 10.20.30.0/24</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME=app1.example.com app2.example.com app3.example.com</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REVERSE_PROXY=yes</span><span class="w"> </span><span class="c1"># Will be applied to all server config</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REVERSE_PROXY_URL=/</span><span class="w"> </span><span class="c1"># Will be applied to all server config</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1.example.com_REVERSE_PROXY_HOST=http://myapp1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2.example.com_REVERSE_PROXY_HOST=http://myapp2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app3.example.com_REVERSE_PROXY_HOST=http://myapp3</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/data</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINERS=1</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have the <a href="#integrations-docker-autoconf">Docker autoconf integration</a> stack running on your machine and connected to a network called <code>bw-services</code> so you can connect your existing application and configure BunkerWeb with labels :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp1</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://myapp1&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp1</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://myapp2&quot;</span>

<span class="w">  </span><span class="nt">myapp3</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp3</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app3.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://myapp3&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have the <a href="#integrations-swarm">Swarm integration</a> stack running on your cluster and connected to a network called <code>bw-services</code> so you can connect your existing application and configure BunkerWeb with labels :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">          </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp1</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://myapp1&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">          </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp2</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://myapp2&quot;</span>

<span class="w">  </span><span class="nt">myapp3</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">          </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp3</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app3.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://myapp3&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have the <a href="#integrations-kubernetes">Kubernetes integration</a> stack running on your cluster.</p>
<p>Let's assume that you have typical Deployments with a Service to access the web applications from within the cluster :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app1</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
<p>Here is the corresponding Ingress definition to serve and protect the web applications :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/DUMMY_SETTING</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span>
<span class="w">    </span><span class="nt">bunkerweb.io/app1.example.com_DUMMY_SETTING</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app1</span>
<span class="w">              </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app2</span>
<span class="w">              </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app3.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app3</span>
<span class="w">              </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have the <a href="#integrations-linux">Linux integration</a> stack running on your machine.</p>
<p>The following command will run a basic HTTP server on the port 8001 and deliver the files in the current directory (repeat it and change the port if you want to test BunkerWeb) :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span>-b<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="m">8001</span>
</code></pre></div>
<p>Configuration of BunkerWeb is done by editing the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=8.8.8.8 8.8.4.4
MULTISITE=yes
SERVER_NAME=app1.example.com app2.example.com app3.example.com
USE_REVERSE_PROXY=yes
REVERSE_PROXY_URL=/
app1.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:8001
app2.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:8002
app3.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:8003
</code></pre></div>
<p>Let's check the status of BunkerWeb :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb
</code></pre></div>
<p>If it's already running, we can restart it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb
</code></pre></div>
<p>Otherwise, we will need to start it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have a service running and you want to use BunkerWeb as a reverse-proxy.</p>
<p>The following command will run a basic HTTP server on the port 8001 and deliver the files in the current directory (repeat it and change the port if you want to test BunkerWeb) :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span>-b<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="m">8001</span>
</code></pre></div>
<p>Content of the <code>my_variables.env</code> configuration file :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=8.8.8.8 8.8.4.4
MULTISITE=yes
SERVER_NAME=app1.example.com app2.example.com app3.example.com
USE_REVERSE_PROXY=yes
REVERSE_PROXY_URL=/
app1.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:8001
app2.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:8002
app3.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:8003
</code></pre></div>
<p>In your Ansible inventory, you can use the <code>variables_env</code> variable to set the path of configuration file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">[</span><span class="nv">mybunkers</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.42 variables_env=&quot;{{ playbook_dir }}/my_variables.env&quot;</span>
</code></pre></div>
<p>Or alternatively, in your playbook file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">variables_env</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/my_variables.env&quot;</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity.bunkerweb</span>
</code></pre></div>
<p>You can now run the playbook :</p>
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>playbook.yml
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have the <a href="#integrations-vagrant">Vagrant integration</a> stack running on your machine.</p>
<p>First of all, connect to your vagrant machine :</p>
<div class="highlight"><pre><span></span><code>vagrant<span class="w"> </span>ssh
</code></pre></div>
<p>The following command will run a basic HTTP server on the port 8001 and deliver the files in the current directory (repeat it and change the port if you want to test BunkerWeb) :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span>-b<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="m">8001</span>
</code></pre></div>
<p>And then you can edit the <code>variables.env</code> file in your host machine like this :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=8.8.8.8 8.8.4.4
MULTISITE=yes
SERVER_NAME=app1.example.com app2.example.com app3.example.com
USE_REVERSE_PROXY=yes
REVERSE_PROXY_URL=/
app1.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:8001
app2.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:8002
app3.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:8003
</code></pre></div>
<p>Let's check the status of BunkerWeb :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb
</code></pre></div>
<p>If it's already running we can restart it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb
</code></pre></div>
<p>Otherwise, we will need to start it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
</div>
</div>
<h2 id="quickstart-guide-behind-load-balancer-or-reverse-proxy">Behind load balancer or reverse proxy</h2>
<p>When BunkerWeb is itself behind a load balancer or a reverse proxy, you need to configure it so it can get the real IP address of the clients. If you don't, the security features will block the IP address of the load balancer or reverse proxy instead of the client's one.</p>
<p>BunkerWeb actually supports two methods to retrieve the real IP address of the client :</p>
<ul>
<li>Using the <code>PROXY protocol</code></li>
<li>Using a HTTP header like <code>X-Forwarded-For</code></li>
</ul>
<p>The following settings can be used :</p>
<ul>
<li><code>USE_REAL_IP</code> : enable/disable real IP retrieval</li>
<li><code>USE_PROXY_PROTOCOL</code> : enable/disable PROXY protocol support</li>
<li><code>REAL_IP_FROM</code> : list of trusted IP/network address allowed to send us the "real IP"</li>
<li><code>REAL_IP_HEADER</code> : the HTTP header containing the real IP or special value <code>proxy_protocol</code> when using PROXY protocol</li>
</ul>
<p>You will find more settings about real IP in the <a href="#settings-real-ip">settings section</a> of the documentation.</p>
<h3 id="quickstart-guide-http-header">HTTP header</h3>
<p>We will assume the following regarding the load balancers or reverse proxies (you will need to update the settings depending on your configuration) :</p>
<ul>
<li>They use the <code>X-Forwarded-For</code> header to set the real IP</li>
<li>They have IPs in the <code>1.2.3.0/24</code> and <code>100.64.0.0/10</code> networks</li>
</ul>
<p>The following settings need to be set :</p>
<div class="highlight"><pre><span></span><code>USE_REAL_IP=yes
REAL_IP_FROM=1.2.3.0/24 100.64.0.0/16
REAL_IP_HEADER=X-Forwarded-For
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="3:7"><input checked="checked" id="quickstart-guide-__tabbed_3_1" name="quickstart-guide-__tabbed_3" type="radio" /><input id="quickstart-guide-__tabbed_3_2" name="quickstart-guide-__tabbed_3" type="radio" /><input id="quickstart-guide-__tabbed_3_3" name="quickstart-guide-__tabbed_3" type="radio" /><input id="quickstart-guide-__tabbed_3_4" name="quickstart-guide-__tabbed_3" type="radio" /><input id="quickstart-guide-__tabbed_3_5" name="quickstart-guide-__tabbed_3" type="radio" /><input id="quickstart-guide-__tabbed_3_6" name="quickstart-guide-__tabbed_3" type="radio" /><input id="quickstart-guide-__tabbed_3_7" name="quickstart-guide-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="quickstart-guide-__tabbed_3_1">Docker</label><label for="quickstart-guide-__tabbed_3_2">Docker autoconf</label><label for="quickstart-guide-__tabbed_3_3">Swarm</label><label for="quickstart-guide-__tabbed_3_4">Kubernetes</label><label for="quickstart-guide-__tabbed_3_5">Linux</label><label for="quickstart-guide-__tabbed_3_6">Ansible</label><label for="quickstart-guide-__tabbed_3_7">Vagrant</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>When starting the BunkerWeb container, you will need to add the settings :</p>
<div class="highlight"><pre><span></span><code><span class="nt">mybunker</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP=yes</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM=1.2.3.0/24 100.64.0.0/10</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER=X-Forwarded-For</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Before running the <a href="#integrations-docker-autoconf">Docker autoconf integration</a> stack, you will need to add the settings for the BunkerWeb container :</p>
<div class="highlight"><pre><span></span><code><span class="nt">mybunker</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP=yes</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM=1.2.3.0/24 100.64.0.0/10</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER=X-Forwarded-For</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Before running the <a href="#integrations-swarm">Swarm integration</a> stack, you will need to add the settings for the BunkerWeb service :</p>
<div class="highlight"><pre><span></span><code><span class="nt">mybunker</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP=yes</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM=1.2.3.0/24 100.64.0.0/10</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER=X-Forwarded-For</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the environment variables of the BunkerWeb containers (doing it using the ingress is not supported because you will get into trouble when using things like Let's Encrypt) :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
<span class="nn">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>...
USE_REAL_IP=yes
REAL_IP_FROM=1.2.3.0/24 100.64.0.0/16
REAL_IP_HEADER=X-Forwarded-For
...
</code></pre></div>
<p>Don't forget to restart the BunkerWeb service once it's done.</p>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to your <code>my_variables.env</code> configuration file :</p>
<div class="highlight"><pre><span></span><code>...
USE_REAL_IP=yes
REAL_IP_FROM=1.2.3.0/24 100.64.0.0/16
REAL_IP_HEADER=X-Forwarded-For
...
</code></pre></div>
<p>In your Ansible inventory, you can use the <code>variables_env</code> variable to set the path of configuration file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">[</span><span class="nv">mybunkers</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.0.42 variables_env=&quot;{{ playbook_dir }}/my_variables.env&quot;</span>
</code></pre></div>
<p>Or alternatively, in your playbook file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">become</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">variables_env</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/my_variables.env&quot;</span>
<span class="w">  </span><span class="w w-Error">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity.bunkerweb</span>
</code></pre></div>
<p>Run the playbook :</p>
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>playbook.yml
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>...
USE_REAL_IP=yes
REAL_IP_FROM=1.2.3.0/24 100.64.0.0/16
REAL_IP_HEADER=X-Forwarded-For
...
</code></pre></div>
<p>Don't forget to restart the BunkerWeb service once it's done.</p>
</div>
</div>
</div>
<h3 id="quickstart-guide-proxy-protocol">Proxy protocol</h3>
<p>We will assume the following regarding the load balancers or reverse proxies (you will need to update the settings depending on your configuration) :</p>
<ul>
<li>They use the <code>PROXY protocol</code> v1 or v2 to set the real IP</li>
<li>They have IPs in the <code>1.2.3.0/24</code> and <code>100.64.0.0/10</code> networks</li>
</ul>
<p>The following settings need to be set :</p>
<div class="highlight"><pre><span></span><code>USE_REAL_IP=yes
USE_PROXY_PROTOCOL=yes
REAL_IP_FROM=1.2.3.0/24 100.64.0.0/16
REAL_IP_HEADER=proxy_protocol
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="4:7"><input checked="checked" id="quickstart-guide-__tabbed_4_1" name="quickstart-guide-__tabbed_4" type="radio" /><input id="quickstart-guide-__tabbed_4_2" name="quickstart-guide-__tabbed_4" type="radio" /><input id="quickstart-guide-__tabbed_4_3" name="quickstart-guide-__tabbed_4" type="radio" /><input id="quickstart-guide-__tabbed_4_4" name="quickstart-guide-__tabbed_4" type="radio" /><input id="quickstart-guide-__tabbed_4_5" name="quickstart-guide-__tabbed_4" type="radio" /><input id="quickstart-guide-__tabbed_4_6" name="quickstart-guide-__tabbed_4" type="radio" /><input id="quickstart-guide-__tabbed_4_7" name="quickstart-guide-__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="quickstart-guide-__tabbed_4_1">Docker</label><label for="quickstart-guide-__tabbed_4_2">Docker autoconf</label><label for="quickstart-guide-__tabbed_4_3">Swarm</label><label for="quickstart-guide-__tabbed_4_4">Kubernetes</label><label for="quickstart-guide-__tabbed_4_5">Linux</label><label for="quickstart-guide-__tabbed_4_6">Ansible</label><label for="quickstart-guide-__tabbed_4_7">Vagrant</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>When starting the BunkerWeb container, you will need to add the settings :</p>
<div class="highlight"><pre><span></span><code><span class="nt">mybunker</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP=yes</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_PROXY_PROTOCOL=yes</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM=1.2.3.0/24 100.64.0.0/10</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER=proxy_protocol</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Before running the <a href="#integrations-docker-autoconf">Docker autoconf integration</a> stack, you will need to add the settings for the BunkerWeb container :</p>
<div class="highlight"><pre><span></span><code><span class="nt">mybunker</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP=yes</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_PROXY_PROTOCOL=yes</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM=1.2.3.0/24 100.64.0.0/10</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER=proxy_protocol</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Before running the <a href="#integrations-swarm">Swarm integration</a> stack, you will need to add the settings for the BunkerWeb service :</p>
<div class="highlight"><pre><span></span><code><span class="nt">mybunker</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP=yes</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_PROXY_PROTOCOL=yes</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM=1.2.3.0/24 100.64.0.0/10</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER=proxy_protocol</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the environment variables of the BunkerWeb containers (doing it using the ingress is not supported because you will get into trouble when using things like Let's Encrypt) :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_PROXY_PROTOCOL</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
<span class="nn">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>...
USE_REAL_IP=yes
USE_PROXY_PROTOCOL=yes
REAL_IP_FROM=1.2.3.0/24 100.64.0.0/16
REAL_IP_HEADER=proxy_protocol
...
</code></pre></div>
<p>Don't forget to restart the BunkerWeb service once it's done.</p>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to your <code>my_variables.env</code> configuration file :</p>
<div class="highlight"><pre><span></span><code>...
USE_REAL_IP=yes
USE_PROXY_PROTOCOL=yes
REAL_IP_FROM=1.2.3.0/24 100.64.0.0/16
REAL_IP_HEADER=proxy_protocol
...
</code></pre></div>
<p>In your Ansible inventory, you can use the <code>variables_env</code> variable to set the path of configuration file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">[</span><span class="nv">mybunkers</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.0.42 variables_env=&quot;{{ playbook_dir }}/my_variables.env&quot;</span>
</code></pre></div>
<p>Or alternatively, in your playbook file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">become</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">variables_env</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/my_variables.env&quot;</span>
<span class="w">  </span><span class="w w-Error">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity.bunkerweb</span>
</code></pre></div>
<p>Run the playbook :</p>
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>playbook.yml
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>...
USE_REAL_IP=yes
USE_PROXY_PROTOCOL=yes
REAL_IP_FROM=1.2.3.0/24 100.64.0.0/16
REAL_IP_HEADER=proxy_protocol
...
</code></pre></div>
<p>Don't forget to restart the BunkerWeb service once it's done.</p>
</div>
</div>
</div>
<h2 id="quickstart-guide-protect-udptcp-applications">Protect UDP/TCP applications</h2>
<div class="admonition warning">
<p class="admonition-title">Feature is in beta<p>This feature is not production-ready. Feel free to test it and report us any bug using <a href="#quickstart-guide">issues</a> in the GitHub repository.</p>
</p>
</div>
<p>BunkerWeb can also act as <strong>generic UDP/TCP reverse proxy</strong> : you can protect any network-based applications working at least on layer 4 of the OSI model. Behind the hood, it leverages the <a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html">stream module</a> of NGINX instead of using the "classical" http one.</p>
<p>Please note that not all settings and security features are available when using the stream module. You will find more info about that in the <a href="#security-tuning">security tuning</a> and <a href="#settings">settings</a> sections of the documentation.</p>
<p>Configuration for a basic reverse proxy is very similar to the HTTP one because it uses the same <code>USE_REVERSE_PROXY=yes</code> and <code>REVERSE_PROXY_HOST=myapp:4242</code> settings. Even the settings used when BunkerWeb is <a href="#quickstart-guide-behind-load-balancer-or-reverse-proxy">behind a Load Balancer</a> are the same (but for obvious reasons, only <strong>PROXY protocol</strong> is supported).</p>
<p>On top of that, the following specific settings are used :</p>
<ul>
<li><code>SERVER_TYPE=stream</code> : activate <code>stream</code> mode (generic UDP/TCP) instead of <code>http</code> one (which is the default)</li>
<li><code>LISTEN_STREAM_PORT=4242</code> : the listening "plain" (without SSL/TLS) port that BunkerWeb will listen on</li>
<li><code>LISTEN_STREAM_PORT_SSL=4343</code> : the listening "ssl/tls" port that BunkerWeb will listen on</li>
<li><code>USE_UDP=no</code> : listen for and forward UDP packets instead of TCP</li>
</ul>
<p>For complete list of settings regarding <code>stream</code> mode, please refer to the <a href="#settings">settings</a> section of the documentation.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:7"><input checked="checked" id="quickstart-guide-__tabbed_5_1" name="quickstart-guide-__tabbed_5" type="radio" /><input id="quickstart-guide-__tabbed_5_2" name="quickstart-guide-__tabbed_5" type="radio" /><input id="quickstart-guide-__tabbed_5_3" name="quickstart-guide-__tabbed_5" type="radio" /><input id="quickstart-guide-__tabbed_5_4" name="quickstart-guide-__tabbed_5" type="radio" /><input id="quickstart-guide-__tabbed_5_5" name="quickstart-guide-__tabbed_5" type="radio" /><input id="quickstart-guide-__tabbed_5_6" name="quickstart-guide-__tabbed_5" type="radio" /><input id="quickstart-guide-__tabbed_5_7" name="quickstart-guide-__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="quickstart-guide-__tabbed_5_1">Docker</label><label for="quickstart-guide-__tabbed_5_2">Docker autoconf</label><label for="quickstart-guide-__tabbed_5_3">Swarm</label><label for="quickstart-guide-__tabbed_5_4">Kubernetes</label><label for="quickstart-guide-__tabbed_5_5">Linux</label><label for="quickstart-guide-__tabbed_5_6">Ansible</label><label for="quickstart-guide-__tabbed_5_7">Vagrant</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>When using Docker integration, the easiest way of protecting existing network applications is to add the services in the <code>bw-services</code> network :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span>

<span class="nt">services</span><span class="p">:</span>

<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.2</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app1&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.2</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app2&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80:8080</span><span class="w"> </span><span class="c1"># Keep it if you want to use Let&#39;s Encrypt automation</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000:10000</span><span class="w"> </span><span class="c1"># app1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20000:20000</span><span class="w"> </span><span class="c1"># app2</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME=app1.example.com app2.example.com</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP=127.0.0.0/8 10.20.30.0/24</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REVERSE_PROXY=yes</span><span class="w"> </span><span class="c1"># Will be applied to all services</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_TYPE=stream</span><span class="w"> </span><span class="c1"># Will be applied to all services</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1.example.com_REVERSE_PROXY_HOST=myapp1:9000</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1.example.com_LISTEN_STREAM_PORT=10000</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2.example.com_REVERSE_PROXY_HOST=myapp2:9000</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2.example.com_LISTEN_STREAM_PORT=20000</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/data</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINERS=1</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Before running the <a href="#integrations-docker-autoconf">Docker autoconf integration</a> stack on your machine, you will need to edit the ports :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span>

<span class="nt">services</span><span class="p">:</span>

<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80:8080</span><span class="w"> </span><span class="c1"># Keep it if you want to use Let&#39;s Encrypt automation</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000:10000</span><span class="w"> </span><span class="c1"># app1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20000:20000</span><span class="w"> </span><span class="c1"># app2</span>

<span class="nn">...</span>
</code></pre></div>
<p>Once the stack is running, you can connect your existing applications to the <code>bw-services</code> network and configure BunkerWeb with labels :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.2</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app1&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">        </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp1</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_KIND=stream&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=myapp1:9000&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.LISTEN_STREAM_PORT=10000&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.2</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app2&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">        </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp2</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_KIND=stream&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=myapp2:9000&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.LISTEN_STREAM_PORT=20000&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">external</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Before running the <a href="#integrations-swarm">Swarm integration</a> stack on your machine, you will need to edit the ports :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Keep it if you want to use Let&#39;s Encrypt automation</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="c1"># app1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="c1"># app2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="nn">...</span>
</code></pre></div>
<p>Once the stack is running, you can connect your existing applications to the <code>bw-services</code> network and configure BunkerWeb with labels :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span>

<span class="nt">services</span><span class="p">:</span>

<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.2</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app1&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_KIND=stream&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=myapp1:9000&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.LISTEN_STREAM_PORT=10000&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.2</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app2&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_KIND=stream&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=myapp2:9000&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.LISTEN_STREAM_PORT=20000&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">external</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Protection TCP/UDP applications using the <code>stream</code> feature is not yet supported when using the <a href="#integrations-kubernetes">Kubernetes integration</a>.</p>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>...
SERVER_NAME=app1.example.com app2.example.com
MULTISITE=yes
USE_REVERSE_PROXY=yes
SERVER_TYPE=stream
app1.example.com_REVERSE_PROXY_HOST=myapp1.domain.or.ip:9000
app1.example.com_LISTEN_STREAM_PORT=10000
app2.example.com_REVERSE_PROXY_HOST=myapp2.domain.or.ip:9000
app2.example.com_LISTEN_STREAM_PORT=20000
...
</code></pre></div>
<p>Don't forget to restart the BunkerWeb service once it's done.</p>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to your <code>my_variables.env</code> configuration file :</p>
<div class="highlight"><pre><span></span><code>...
SERVER_NAME=app1.example.com app2.example.com
MULTISITE=yes
USE_REVERSE_PROXY=yes
SERVER_TYPE=stream
app1.example.com_REVERSE_PROXY_HOST=myapp1.domain.or.ip:9000
app1.example.com_LISTEN_STREAM_PORT=10000
app2.example.com_REVERSE_PROXY_HOST=myapp2.domain.or.ip:9000
app2.example.com_LISTEN_STREAM_PORT=20000
...
</code></pre></div>
<p>In your Ansible inventory, you can use the <code>variables_env</code> variable to set the path of configuration file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">[</span><span class="nv">mybunkers</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.0.42 variables_env=&quot;{{ playbook_dir }}/my_variables.env&quot;</span>
</code></pre></div>
<p>Or alternatively, in your playbook file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">become</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">variables_env</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/my_variables.env&quot;</span>
<span class="w">  </span><span class="w w-Error">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity.bunkerweb</span>
</code></pre></div>
<p>Run the playbook :</p>
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>playbook.yml
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>...
SERVER_NAME=app1.example.com app2.example.com
MULTISITE=yes
USE_REVERSE_PROXY=yes
SERVER_TYPE=stream
app1.example.com_REVERSE_PROXY_HOST=myapp1.domain.or.ip:9000
app1.example.com_LISTEN_STREAM_PORT=10000
app2.example.com_REVERSE_PROXY_HOST=myapp2.domain.or.ip:9000
app2.example.com_LISTEN_STREAM_PORT=20000
...
</code></pre></div>
<p>Don't forget to restart the BunkerWeb service once it's done.</p>
</div>
</div>
</div>
<h2 id="quickstart-guide-custom-configurations">Custom configurations</h2>
<p>Because BunkerWeb is based on the NGINX web server, you can add custom NGINX configurations in different NGINX contexts. You can also apply custom configurations for the ModSecurity WAF which is a core component of BunkerWeb (more info <a href="#security-tuning-modsecurity">here</a>). Here is the list of custom configurations types :</p>
<ul>
<li><strong>http</strong> : http level of NGINX</li>
<li><strong>server-http</strong> : http/server level of NGINX</li>
<li><strong>default-server-http</strong> : server level of NGINX (only apply to the "default server" when the name supplied by the client doesn't match any server name in <code>SERVER_NAME</code>)</li>
<li><strong>modsec-crs</strong> : before the OWASP Core Rule Set is loaded</li>
<li><strong>modsec</strong> : after the OWASP Core Rule Set is loaded (also used if CRS is not loaded)</li>
<li><strong>stream</strong> : stream level of NGINX</li>
<li><strong>server-stream</strong> : stream/server level of NGINX</li>
</ul>
<p>Custom configurations can be applied globally or only for a specific server when applicable and if the multisite mode is enabled.</p>
<p>The howto depends on the integration used but under the hood, applying custom configurations is done by adding files ending with the .conf suffix in their name to specific folders. To apply a custom configuration for a specific server, the file is written to a subfolder which is named as the primary server name.</p>
<p>Some integrations offer a more convenient way of applying configurations such as using <a href="https://docs.docker.com/engine/swarm/configs/">Configs</a> with Swarm or <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMap</a> with Kubernetes.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:7"><input checked="checked" id="quickstart-guide-__tabbed_6_1" name="quickstart-guide-__tabbed_6" type="radio" /><input id="quickstart-guide-__tabbed_6_2" name="quickstart-guide-__tabbed_6" type="radio" /><input id="quickstart-guide-__tabbed_6_3" name="quickstart-guide-__tabbed_6" type="radio" /><input id="quickstart-guide-__tabbed_6_4" name="quickstart-guide-__tabbed_6" type="radio" /><input id="quickstart-guide-__tabbed_6_5" name="quickstart-guide-__tabbed_6" type="radio" /><input id="quickstart-guide-__tabbed_6_6" name="quickstart-guide-__tabbed_6" type="radio" /><input id="quickstart-guide-__tabbed_6_7" name="quickstart-guide-__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="quickstart-guide-__tabbed_6_1">Docker</label><label for="quickstart-guide-__tabbed_6_2">Docker autoconf</label><label for="quickstart-guide-__tabbed_6_3">Swarm</label><label for="quickstart-guide-__tabbed_6_4">Kubernetes</label><label for="quickstart-guide-__tabbed_6_5">Linux</label><label for="quickstart-guide-__tabbed_6_6">Ansible</label><label for="quickstart-guide-__tabbed_6_7">Vagrant</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>When using the <a href="#integrations-docker">Docker integration</a>, you have two choices for the addition of custom configurations :</p>
<ul>
<li>Using specific settings <code>*_CUSTOM_CONF_*</code> as environment variables (recommended)</li>
<li>Writing .conf files to the volume mounted on /data of the scheduler</li>
</ul>
<p><strong>Using settings</strong></p>
<p>The settings to use must follow the pattern <code>&lt;SITE&gt;_CUSTOM_CONF_&lt;TYPE&gt;_&lt;NAME&gt;</code> :</p>
<ul>
<li><code>&lt;SITE&gt;</code> : optional primary server name if multisite mode is enabled and the config must be applied to a specific service</li>
<li><code>&lt;TYPE&gt;</code> : the type of config, accepted values are <code>HTTP</code>, <code>DEFAULT_SERVER_HTTP</code>, <code>SERVER_HTTP</code>, <code>MODSEC</code>, <code>MODSEC_CRS</code>, <code>STREAM</code> and <code>SERVER_STREAM</code></li>
<li><code>&lt;NAME&gt;</code> : the name of config without the .conf suffix</li>
</ul>
<p>Here is a dummy example using a docker-compose file :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">mybunker</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">CUSTOM_CONF_SERVER_HTTP_hello-world=</span>
<span class="w">      </span><span class="no">location /hello {</span>
<span class="w">        </span><span class="no">default_type &#39;text/plain&#39;;</span>
<span class="w">        </span><span class="no">content_by_lua_block {</span>
<span class="w">          </span><span class="no">ngx.say(&#39;world&#39;)</span>
<span class="w">        </span><span class="no">}</span>
<span class="w">      </span><span class="no">}</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p><strong>Using files</strong></p>
<p>The first thing to do is to create the folders :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>./bw-data/configs/server-http
</code></pre></div>
<p>You can now write your configurations :</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;location /hello {</span>
<span class="s2">    default_type &#39;text/plain&#39;;</span>
<span class="s2">    content_by_lua_block {</span>
<span class="s2">        ngx.say(&#39;world&#39;)</span>
<span class="s2">    }</span>
<span class="s2">}&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>./bw-data/configs/server-http/hello-world.conf
</code></pre></div>
<p>Because the scheduler runs as an unprivileged user with UID and GID 101, you will need to edit the permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>When starting the scheduler container, you will need to mount the folder on /data :</p>
<div class="highlight"><pre><span></span><code><span class="nt">mybunker</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./bw-data:/data</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#integrations-docker-autoconf">Docker autoconf integration</a>, you have two choices for adding custom configurations :</p>
<ul>
<li>Using specific settings <code>*_CUSTOM_CONF_*</code> as labels (easiest)</li>
<li>Writing .conf files to the volume mounted on /data of the scheduler</li>
</ul>
<p><strong>Using labels</strong></p>
<div class="admonition warning">
<p class="admonition-title">Limitations using labels</p>
<p>When using labels with the Docker autoconf integration, you can only apply custom configurations for the corresponding web service. Applying <strong>http</strong>, <strong>default-server-http</strong>, <strong>stream</strong> or any global configurations (like <strong>server-http</strong> or <strong>server-stream</strong> for all services) is not possible : you will need to mount files for that purpose.</p>
</div>
<p>The labels to use must follow the pattern <code>bunkerweb.CUSTOM_CONF_&lt;TYPE&gt;_&lt;NAME&gt;</code> :</p>
<ul>
<li><code>&lt;TYPE&gt;</code> : the type of config, accepted values are <code>SERVER_HTTP</code>, <code>MODSEC</code>, <code>MODSEC_CRS</code> and <code>SERVER_STREAM</code></li>
<li><code>&lt;NAME&gt;</code> : the name of config without the .conf suffix </li>
</ul>
<p>Here is a dummy example using a docker-compose file :</p>
<div class="highlight"><pre><span></span><code><span class="nt">myapp</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tutum/hello-world</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">bunkerweb.CUSTOM_CONF_SERVER_HTTP_hello-world=</span>
<span class="w">      </span><span class="no">location /hello {</span>
<span class="w">        </span><span class="no">default_type &#39;text/plain&#39;;</span>
<span class="w">        </span><span class="no">content_by_lua_block {</span>
<span class="w">            </span><span class="no">ngx.say(&#39;world&#39;)</span>
<span class="w">      </span><span class="no">}</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p><strong>Using files</strong></p>
<p>The first thing to do is to create the folders :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>./bw-data/configs/server-http
</code></pre></div>
<p>You can now write your configurations :</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;location /hello {</span>
<span class="s2">    default_type &#39;text/plain&#39;;</span>
<span class="s2">    content_by_lua_block {</span>
<span class="s2">        ngx.say(&#39;world&#39;)</span>
<span class="s2">    }</span>
<span class="s2">}&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>./bw-data/configs/server-http/hello-world.conf
</code></pre></div>
<p>Because the scheduler runs as an unprivileged user with UID and GID 101, you will need to edit the permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>When starting the scheduler container, you will need to mount the folder on /data :</p>
<div class="highlight"><pre><span></span><code><span class="nt">myautoconf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./bw-data:/data</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#integrations-swarm">Swarm integration</a>, custom configurations are managed using <a href="https://docs.docker.com/engine/swarm/configs/">Docker Configs</a>.</p>
<p>To keep it simple, you don't even need to attach the Config to a service : the autoconf service is listening for Config events and will update the custom configurations when needed.</p>
<p>When creating a Config, you will need to add special labels :</p>
<ul>
<li><strong>bunkerweb.CONFIG_TYPE</strong> : must be set to a valid custom configuration type (http, server-http, default-server-http, modsec, modsec-crs, stream or server-stream)</li>
<li><strong>bunkerweb.CONFIG_SITE</strong> : set to a server name to apply configuration to that specific server (optional, will be applied globally if unset)</li>
</ul>
<p>Here is the example :</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;location /hello {</span>
<span class="s2">    default_type &#39;text/plain&#39;;</span>
<span class="s2">    content_by_lua_block {</span>
<span class="s2">        ngx.say(&#39;world&#39;)</span>
<span class="s2">    }</span>
<span class="s2">}&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span>config<span class="w"> </span>create<span class="w"> </span>-l<span class="w"> </span>bunkerweb.CONFIG_TYPE<span class="o">=</span>server-http<span class="w"> </span>my-config<span class="w"> </span>-
</code></pre></div>
<p>There is no update mechanism : the alternative is to remove an existing config using <code>docker config rm</code> and then recreate it.</p>
</div>
<div class="tabbed-block">
<p>When using the <a href="#integrations-kubernetes">Kubernetes integration</a>, custom configurations are managed using <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMap</a>.</p>
<p>To keep it simple, you don't even need to use the ConfigMap with a Pod (e.g. as environment variable or volume) : the autoconf Pod is listening for ConfigMap events and will update the custom configurations when needed.</p>
<p>When creating a ConfigMap, you will need to add special labels :</p>
<ul>
<li><strong>bunkerweb.io/CONFIG_TYPE</strong> : must be set to a valid custom configuration type (http, server-http, default-server-http, modsec, modsec-crs, stream or server-stream)</li>
<li><strong>bunkerweb.io/CONFIG_SITE</strong> : set to a server name to apply configuration to that specific server (optional, will be applied globally if unset)</li>
</ul>
<p>Here is the example :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cfg-bunkerweb-all-server-http</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/CONFIG_TYPE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;server-http&quot;</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myconf</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">location /hello {</span>
<span class="w">        </span><span class="no">default_type &#39;text/plain&#39;;</span>
<span class="w">        </span><span class="no">content_by_lua_block {</span>
<span class="w">            </span><span class="no">ngx.say(&#39;world&#39;)</span>
<span class="w">        </span><span class="no">}</span>
<span class="w">    </span><span class="no">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#integrations-linux">Linux integration</a>, custom configurations must be written to the /etc/bunkerweb/configs folder.</p>
<p>Here is an example for server-http/hello-world.conf :</p>
<div class="highlight"><pre><span></span><code>location /hello {
  default_type &#39;text/plain&#39;;
  content_by_lua_block {
    ngx.say(&#39;world&#39;)
  }
}
</code></pre></div>
<p>Because BunkerWeb runs as an unprivileged user (nginx:nginx), you will need to edit the permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:nginx<span class="w"> </span>/etc/bunkerweb/configs<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>/etc/bunkerweb/configs
</code></pre></div>
<p>Don't forget to restart the BunkerWeb service once it's done.</p>
</div>
<div class="tabbed-block">
<p>The <code>custom_configs_path[]</code> variable is a dictionary with configuration types (<code>http</code>, <code>server-http</code>, <code>modsec</code>, <code>modsec-crs</code>, <code>stream</code> and <code>server-stream</code>) as keys and the corresponding values are path containing the configuration files.</p>
<p>Here is an example for server-http/hello-world.conf :</p>
<div class="highlight"><pre><span></span><code>location /hello {
  default_type &#39;text/plain&#39;;
  content_by_lua_block {
    ngx.say(&#39;world&#39;)
  }
}
</code></pre></div>
<p>And the corresponding <code>custom_configs_path[server-http]</code> variable used in your inventory :</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p p-Indicator">[</span><span class="nv">mybunkers</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.42 custom_configs_path={&quot;server-http&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/server-http&quot;</span><span class="err">}</span>
</code></pre></div>
<p>Or alternatively, in your playbook file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">custom_configs_path</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="nt">        server-http</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/server-http&quot;</span>
<span class="w">      </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity.bunkerweb</span>
</code></pre></div>
<p>Run the playbook :</p>
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>playbook.yml
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#integrations-vagrant">Vagrant integration</a>, custom configurations must be written to the <code>/etc/bunkerweb/configs</code> folder.</p>
<p>Here is an example for server-http/hello-world.conf :</p>
<div class="highlight"><pre><span></span><code>location /hello {
  default_type &#39;text/plain&#39;;
  content_by_lua_block {
    ngx.say(&#39;world&#39;)
  }
}
</code></pre></div>
<p>Because BunkerWeb runs as an unprivileged user (nginx:nginx), you will need to edit the permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:nginx<span class="w"> </span>/etc/bunkerweb/configs<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>/etc/bunkerweb/configs
</code></pre></div>
<p>Don't forget to restart the BunkerWeb service once it's done.</p>
</div>
</div>
</div>
<h2 id="quickstart-guide-php">PHP</h2>
<div class="admonition warning">
<p class="admonition-title">Support is in beta</p>
<p>At the moment, PHP support with BunkerWeb is still in beta and we recommend you use a reverse-proxy architecture if you can. By the way, PHP is not supported at all for some integrations like Kubernetes.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Testing</p>
<p>To perform quick tests when multisite mode is enabled (and if you don't have the proper DNS entries set up for the domains) you can use curl with the HTTP Host header of your choice :
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Host: app1.example.com&quot;</span><span class="w"> </span>http://ip-or-fqdn-of-server
</code></pre></div></p>
<p>If you are using HTTPS, you will need to play with SNI :
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Host: app1.example.com&quot;</span><span class="w"> </span>--resolve<span class="w"> </span>example.com:443:ip-of-server<span class="w"> </span>https://example.com
</code></pre></div></p>
</div>
<p>BunkerWeb supports PHP using external or remote <a href="https://www.php.net/manual/en/install.fpm.php">PHP-FPM</a> instances. We will assume that you are already familiar with managing that kind of services.</p>
<p>The following settings can be used :</p>
<ul>
<li><code>REMOTE_PHP</code> : Hostname of the remote PHP-FPM instance.</li>
<li><code>REMOTE_PHP_PATH</code> : Root folder containing files in the remote PHP-FPM instance.</li>
<li><code>LOCAL_PHP</code> : Path to the local socket file of PHP-FPM instance.</li>
<li><code>LOCAL_PHP_PATH</code> : Root folder containing files in the local PHP-FPM instance.</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="7:7"><input checked="checked" id="quickstart-guide-__tabbed_7_1" name="quickstart-guide-__tabbed_7" type="radio" /><input id="quickstart-guide-__tabbed_7_2" name="quickstart-guide-__tabbed_7" type="radio" /><input id="quickstart-guide-__tabbed_7_3" name="quickstart-guide-__tabbed_7" type="radio" /><input id="quickstart-guide-__tabbed_7_4" name="quickstart-guide-__tabbed_7" type="radio" /><input id="quickstart-guide-__tabbed_7_5" name="quickstart-guide-__tabbed_7" type="radio" /><input id="quickstart-guide-__tabbed_7_6" name="quickstart-guide-__tabbed_7" type="radio" /><input id="quickstart-guide-__tabbed_7_7" name="quickstart-guide-__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="quickstart-guide-__tabbed_7_1">Docker</label><label for="quickstart-guide-__tabbed_7_2">Docker autoconf</label><label for="quickstart-guide-__tabbed_7_3">Swarm</label><label for="quickstart-guide-__tabbed_7_4">Kubernetes</label><label for="quickstart-guide-__tabbed_7_5">Linux</label><label for="quickstart-guide-__tabbed_7_6">Ansible</label><label for="quickstart-guide-__tabbed_7_7">Vagrant</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>When using the <a href="#integrations-docker">Docker integration</a>, to support PHP applications, you will need to :</p>
<ul>
<li>Mount your PHP files into the <code>/var/www/html</code> folder of BunkerWeb</li>
<li>Set up a PHP-FPM container for your application and mount the folder containing PHP files</li>
<li>Use the specific settings <code>REMOTE_PHP</code> and <code>REMOTE_PHP_PATH</code> as environment variables when starting BunkerWeb</li>
</ul>
<p>If you enable the <a href="#concepts-integration">multisite mode</a>, you will need to create separate directories for each of your applications. Each subdirectory should be named using the first value of <code>SERVER_NAME</code>. Here is a dummy example :</p>
<div class="highlight"><pre><span></span><code>www
├── app1.example.com
│   └── index.php
├── app2.example.com
│   └── index.php
└── app3.example.com
    └── index.php

3 directories, 3 files
</code></pre></div>
<p>We will assume that your PHP apps are located into a folder named <code>www</code>. Please note that you will need to fix the permissions so BunkerWeb (UID/GID 101) can at least read files and list folders and PHP-FPM (UID/GID 33 if you use the <code>php:fpm</code> image) is the owner of the files and folders :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">33</span>:101<span class="w"> </span>./www<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>You can now run BunkerWeb, configure it for your PHP application and also run the PHP apps :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span>

<span class="nt">services</span><span class="p">:</span>

<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app1.example.com:/app</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app2.example.com:/app</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">myapp3</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app3.example.com:/app</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www:/var/www/html</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80:8080</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443:8443</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME=app1.example.com app2.example.com</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP=127.0.0.0/8 10.20.30.0/24</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1.example.com_REMOTE_PHP=myapp1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1.example.com_REMOTE_PHP_PATH=/app</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2.example.com_REMOTE_PHP=myapp2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2.example.com_REMOTE_PHP_PATH=/app</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app3.example.com_REMOTE_PHP=myapp3</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app3.example.com_REMOTE_PHP_PATH=/app</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/data</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINERS=1</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition info">
<p class="admonition-title">Multisite mode enabled</p>
<p>The <a href="#integrations-docker-autoconf">Docker autoconf integration</a> integration implies the use of multisite mode : protecting one PHP application is the same as protecting multiple ones.</p>
</div>
<p>When using the <a href="#integrations-docker-autoconf">Docker autoconf integration</a>, to support PHP applications, you will need to :</p>
<ul>
<li>Mount your PHP files into the <code>/var/www/html</code> folder of BunkerWeb</li>
<li>Set up a PHP-FPM containers for your applications and mount the folder containing PHP apps</li>
<li>Use the specific settings <code>REMOTE_PHP</code> and <code>REMOTE_PHP_PATH</code> as labels for your PHP-FPM container</li>
</ul>
<p>Since the Docker autoconf implies using the <a href="#concepts-integration">multisite mode</a>, you will need to create separate directories for each of your applications. Each subdirectory should be named using the first value of <code>SERVER_NAME</code>. Here is a dummy example :</p>
<div class="highlight"><pre><span></span><code>www
├── app1.example.com
│   └── index.php
├── app2.example.com
│   └── index.php
└── app3.example.com
    └── index.php

3 directories, 3 files
</code></pre></div>
<p>Once the folders are created, copy your files and fix the permissions so BunkerWeb (UID/GID 101) can at least read files and list folders and PHP-FPM (UID/GID 33 if you use the <code>php:fpm</code> image) is the owner of the files and folders :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">33</span>:101<span class="w"> </span>./www<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>When you start the BunkerWeb autoconf stack, mount the <code>www</code> folder into <code>/var/www/html</code> for the BunkerWeb container :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www:/var/www/html</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP=127.0.0.0/8 10.20.30.0/24</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINERS=1</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:10.10</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_RANDOM_ROOT_PASSWORD=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE=db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_USER=bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD=changeme</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
</code></pre></div>
<p>You can now create your PHP-FPM containers, mount the correct subfolders and use labels to configure BunkerWeb :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app1.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp1</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp1&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app2.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp2</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp2&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">  </span><span class="nt">myapp3</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app3.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp3</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app3.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp3&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition info">
<p class="admonition-title">Multisite mode enabled</p>
<p>The <a href="#integrations-docker-autoconf">Swarm integration</a> integration implies the use of multisite mode : protecting one PHP application is the same as protecting multiple ones.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Shared volume</p>
<p>Using PHP with the Docker Swarm integration needs a shared volume between all BunkerWeb and PHP-FPM instances which is not covered in this documentation.</p>
</div>
<p>When using the <a href="#integrations-docker-autoconf">Docker autoconf integration</a>, to support PHP applications, you will need to :</p>
<ul>
<li>Mount your PHP files into the <code>/var/www/html</code> folder of BunkerWeb</li>
<li>Set up a PHP-FPM containers for your applications and mount the folder containing PHP apps</li>
<li>Use the specific settings <code>REMOTE_PHP</code> and <code>REMOTE_PHP_PATH</code> as labels for your PHP-FPM container</li>
</ul>
<p>Since the Swarm integration implies using the <a href="#concepts-integration">multisite mode</a>, you will need to create separate directories for each of your applications. Each subdirectory should be named using the first value of <code>SERVER_NAME</code>. Here is a dummy example :</p>
<div class="highlight"><pre><span></span><code>www
├── app1.example.com
│   └── index.php
├── app2.example.com
│   └── index.php
└── app3.example.com
    └── index.php

3 directories, 3 files
</code></pre></div>
<p>As an example, we will consider that you have a shared folder mounted on your worker nodes on the <code>/shared</code> endpoint.</p>
<p>Once the folders are created, copy your files and fix the permissions so BunkerWeb (UID/GID 101) can at least read files and list folders and PHP-FPM (UID/GID 33 if you use the <code>php:fpm</code> image) is the owner of the files and folders :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">33</span>:101<span class="w"> </span>/shared/www<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/shared/www<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/shared/www<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>When you start the BunkerWeb stack, mount the <code>/shared/www</code> folder into <code>/var/www/html</code> for the BunkerWeb container :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/shared/www:/var/www/html</span>
<span class="nn">...</span>
</code></pre></div>
<p>You can now create your PHP-FPM services, mount the correct subfolders and use labels to configure BunkerWeb :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span>
<span class="w">  </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app1.example.com:/app</span>
<span class="w">        </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">          </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">              </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp1</span>
<span class="w">        </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">          </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">            </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">          </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp1&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">    </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app2.example.com:/app</span>
<span class="w">        </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">          </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">              </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp2</span>
<span class="w">        </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">          </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">            </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">          </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp2&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">    </span><span class="nt">myapp3</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app3.example.com:/app</span>
<span class="w">        </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">          </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">              </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp3</span>
<span class="w">        </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">          </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">            </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">          </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app3.example.com&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp3&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">  </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">      </span><span class="nt">external</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">PHP is not supported for Kubernetes</p>
<p>Kubernetes integration allows configuration through <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a> and the BunkerWeb controller only supports HTTP applications at the moment.</p>
</div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have the <a href="#integrations-linux">Linux integration</a> stack running on your machine.</p>
<p>By default, BunkerWeb will search for web files inside the <code>/var/www/html</code> folder. You can use it to store your PHP applications. Please note that you will need to configure your PHP-FPM service to get or set the user/group of the running processes and the UNIX socket file used to communicate with BunkerWeb.</p>
<p>First of all, you will need to make sure that your PHP-FPM instance can access the files inside the <code>/var/www/html</code> folder and also that BunkerWeb can access the UNIX socket file in order to communicate with PHP-FPM. We recommend to set a different user like <code>www-data</code> for the PHP-FPM service and to give the nginx group access to the UNIX socket file. Here is corresponding PHP-FPM configuration :</p>
<div class="highlight"><pre><span></span><code><span class="na">...</span>
<span class="k">[www]</span>
<span class="na">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">www-data</span>
<span class="na">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">www-data</span>
<span class="na">listen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/run/php/php-fpm.sock</span>
<span class="na">listen.owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">www-data</span>
<span class="na">listen.group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">nginx</span>
<span class="na">listen.mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0660</span>
<span class="na">...</span>
</code></pre></div>
<p>Don't forget to restart your PHP-FPM service :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>php-fpm
</code></pre></div>
<p>If you enable the <a href="#concepts-integration">multisite mode</a>, you will need to create separate directories for each of your applications. Each subdirectory should be named using the first value of <code>SERVER_NAME</code>. Here is a dummy example :</p>
<div class="highlight"><pre><span></span><code>/var/www/html
├── app1.example.com
│   └── index.php
├── app2.example.com
│   └── index.php
└── app3.example.com
    └── index.php

3 directories, 3 files
</code></pre></div>
<p>Please note that you will need to fix the permissions so BunkerWeb (group <code>nginx</code>) can at least read files and list folders and PHP-FPM (user <code>www-data</code> but it might be different depending on your system) is the owner of the files and folders :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>www-data:nginx<span class="w"> </span>/var/www/html<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/var/www/html<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/var/www/html<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>You can now edit the <code>/etc/bunkerweb/variable.env</code> file :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=8.8.8.8 8.8.4.4
MULTISITE=yes
SERVER_NAME=app1.example.com app2.example.com app3.example.com
app1.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app1.example.com_LOCAL_PHP_PATH=/var/www/html/app1.example.com
app2.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app2.example.com_LOCAL_PHP_PATH=/var/www/html/app2.example.com
app3.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app3.example.com_LOCAL_PHP_PATH=/var/www/html/app3.example.com
</code></pre></div>
<p>Let's check the status of BunkerWeb :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb
</code></pre></div>
<p>If it's already running we can restart it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb
</code></pre></div>
<p>Otherwise, we will need to start it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition info">
<p class="admonition-title">Linux</p>
<p>Please follow the instruction for Linux integration to create a local <code>www</code> folder (permissions are not needed, Ansible will do it for you).</p>
</div>
<p>We will assume that you already have the <a href="#integrations-ansible">Ansible integration</a> setup on your machine.</p>
<p>Content of the <code>my_variables.env</code> configuration file :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=8.8.8.8 8.8.4.4
MULTISITE=yes
SERVER_NAME=app1.example.com app2.example.com app3.example.com
app1.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app1.example.com_LOCAL_PHP_PATH=/var/www/html/app1.example.com
app2.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app2.example.com_LOCAL_PHP_PATH=/var/www/html/app2.example.com
app3.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app3.example.com_LOCAL_PHP_PATH=/var/www/html/app3.example.com
</code></pre></div>
<p>The <code>custom_site</code> variable can be used to specify a directory containing your application files (e.g : <code>www</code>) that will be copied to <code>/var/www/html</code> and the <code>custom_www_owner</code> variable contains the owner that should be set for the files and folders. Here is an example using the Ansible inventory (replace <code>www-data</code> with the user running the PHP-FPM service):</p>
<div class="highlight"><pre><span></span><code><span class="k">[mybunkers]</span>
<span class="na">192.168.0.42 variables_env</span><span class="o">=</span><span class="s">&quot;{{ playbook_dir }}/my_variables.env&quot; custom_www=&quot;{{ playbook_dir }}/my_app&quot; custom_www_owner=&quot;www-data&quot;</span>
</code></pre></div>
<p>Or alternatively, in your playbook file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">variables_env</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/my_variables.env&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">custom_www</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/www&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">custom_www_owner</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;www-data&quot;</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity.bunkerweb</span>
</code></pre></div>
<p>You can now run the playbook :</p>
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>playbook.yml
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition info">
<p class="admonition-title">Linux</p>
<p>Please follow the instruction for Linux integration to create the <code>/var/www/html</code> folder.</p>
</div>
<p>We will assume that you already have the <a href="#integrations-vagrant">Vagrant integration</a> stack running on your machine.</p>
<p>Once PHP files are copied into the <code>/var/www/html</code>folder, you can now edit the <code>/etc/bunkerweb/variable.env</code> file :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=8.8.8.8 8.8.4.4
MULTISITE=yes
SERVER_NAME=app1.example.com app2.example.com app3.example.com
app1.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app1.example.com_LOCAL_PHP_PATH=/var/www/html/app1.example.com
app2.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app2.example.com_LOCAL_PHP_PATH=/var/www/html/app2.example.com
app3.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app3.example.com_LOCAL_PHP_PATH=/var/www/html/app3.example.com
</code></pre></div>
<p>Let's check the status of BunkerWeb :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb
</code></pre></div>
<p>If it's already running we can restart it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb
</code></pre></div>
<p>Otherwise, we will need to start it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
</div>
</div></section><section class="print-page" id="security-tuning"><h1 id="security-tuning-security-tuning">Security tuning</h1>
<p>BunkerWeb offers many security features that you can configure with <a href="#settings">settings</a>. Even if the default values of settings ensure a minimal "security by default", we strongly recommend you tune them. By doing so you will be able to ensure the security level of your choice but also manage false positives.</p>
<div class="admonition tip">
<p class="admonition-title">Other settings</p>
<p>This section only focuses on security tuning, see the <a href="#settings">settings section</a> of the documentation for other settings.</p>
</div>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/core-order.svg" />
  </p>
<figcaption>Overview and order of the core security plugins</figcaption>
</figure>
<h2 id="security-tuning-http-protocol">HTTP protocol</h2>
<h3 id="security-tuning-deny-status-code">Deny status code</h3>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /></p>
<p>The first thing to define is the kind of action to do when a client access is denied. You can control the action with the <code>DENY_HTTP_STATUS</code> setting which allows the following values :</p>
<ul>
<li><code>403</code> : send a "classical" Forbidden HTTP status code (a web page or custom content will be displayed)</li>
<li><code>444</code> : close the connection (no web page or custom content will be displayed)</li>
</ul>
<p>The default value is <code>403</code> and we suggest you set it to <code>444</code> only if you already fixed a lot of false positive, you are familiar with BunkerWeb and want a higher level of security.</p>
<p>When using stream mode, value is ignored and always set to <code>444</code> with effect of closing the connection.</p>
<h3 id="security-tuning-default-server">Default server</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>In the HTTP protocol, the Host header is used to determine which server the client wants to send the request to. That header is facultative and may be missing from the request or can be set as an unknown value. This is a common case, a lot of bots are scanning the Internet and are trying to exploit services or simply doing some fingerprinting.</p>
<p>You can disable any request containing undefined or unknown Host value by setting <code>DISABLE_DEFAULT_SERVER</code> to <code>yes</code> (default : <code>no</code>). Please note that clients won't even receive a response, the TCP connection will be closed (using the special 444 status code of NGINX).</p>
<h3 id="security-tuning-allowed-methods">Allowed methods</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>You can control the allowed HTTP methods by listing them (separated with "|") in the <code>ALLOWED_METHODS</code> setting (default : <code>GET|POST|HEAD</code>). Clients sending a method which is not listed will get a "405 - Method Not Allowed".</p>
<h3 id="security-tuning-max-sizes">Max sizes</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>You can control the maximum body size with the <code>MAX_CLIENT_SIZE</code> setting (default : <code>10m</code>). See <a href="https://nginx.org/en/docs/syntax.html">here</a> for accepted values. You can use the special value <code>0</code> to allow a body of infinite size (not recommended).</p>
<h3 id="security-tuning-serve-files">Serve files</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>To disable serving files from the www folder, you can set <code>SERVE_FILES</code> to <code>no</code> (default : <code>yes</code>). The value <code>no</code> is recommended if you use BunkerWeb as a reverse proxy.</p>
<h3 id="security-tuning-headers">Headers</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Headers are very important when it comes to HTTP security. While some of them might be too verbose, others' verbosity will need to be increased, especially on the client-side.</p>
<h4 id="security-tuning-remove-headers">Remove headers</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>You can automatically remove verbose headers in the HTTP responses by using the <code>REMOVE_HEADERS</code> setting (default : <code>Server X-Powered-By X-AspNet-Version X-AspNetMvc-Version</code>).</p>
<h4 id="security-tuning-cookies">Cookies</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>When it comes to cookies security, we can use the following flags :</p>
<ul>
<li>HttpOnly : disable any access to the cookie from Javascript using document.cookie</li>
<li>SameSite : policy when requests come from third-party websites</li>
<li>Secure : only send cookies on HTTPS request</li>
</ul>
<p>Cookie flags can be overridden with values of your choice by using the <code>COOKIE_FLAGS</code> setting (default : <code>* HttpOnly SameSite=Lax</code>). See <a href="https://github.com/AirisX/nginx_cookie_flag_module">here</a> for accepted values.</p>
<p>The Secure flag can be automatically added if HTTPS is used by using the <code>COOKIE_AUTO_SECURE_FLAG</code> setting (default : <code>yes</code>). The value <code>no</code> is not recommended unless you know what you're doing.</p>
<h4 id="security-tuning-security-headers">Security headers</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Various security headers are available and most of them can be set using BunkerWeb settings. Here is the list of headers, the corresponding setting and default value :</p>
<table>
<thead>
<tr>
<th align="center">Header</th>
<th align="left">Setting</th>
<th align="center">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>Content-Security-Policy</code></td>
<td align="left"><code>CONTENT_SECURITY_POLICY</code></td>
<td align="center"><code>object-src 'none'; frame-src 'self'; child-src 'self'; form-action 'self'; frame-ancestors 'self';</code></td>
</tr>
<tr>
<td align="center"><code>Strict-Transport-Security</code></td>
<td align="left"><code>STRICT_TRANSPORT_SECURITY</code></td>
<td align="center"><code>max-age=31536000</code></td>
</tr>
<tr>
<td align="center"><code>Referrer-Policy</code></td>
<td align="left"><code>REFERRER_POLICY</code></td>
<td align="center"><code>strict-origin-when-cross-origin</code></td>
</tr>
<tr>
<td align="center"><code>Permissions-Policy</code></td>
<td align="left"><code>PERMISSIONS_POLICY</code></td>
<td align="center"><code>accelerometer=(), ambient-light-sensor=(), autoplay=(), battery=(), camera=(), cross-origin-isolated=(), display-capture=(), document-domain=(), encrypted-media=(), execution-while-not-rendered=(), execution-while-out-of-viewport=(), fullscreen=(), geolocation=(), gyroscope=(), hid=(), idle-detection=(), magnetometer=(), microphone=(), midi=(), navigation-override=(), payment=(), picture-in-picture=(), publickey-credentials-get=(), screen-wake-lock=(), serial=(), usb=(), web-share=(), xr-spatial-tracking=()</code></td>
</tr>
<tr>
<td align="center"><code>Feature-Policy</code></td>
<td align="left"><code>FEATURE_POLICY</code></td>
<td align="center"><code>accelerometer 'none'; ambient-light-sensor 'none'; autoplay 'none'; battery 'none'; camera 'none'; display-capture 'none'; document-domain 'none'; encrypted-media 'none'; execution-while-not-rendered 'none'; execution-while-out-of-viewport 'none'; fullscreen 'none'; 'none'; geolocation 'none'; gyroscope 'none'; layout-animation 'none'; legacy-image-formats 'none'; magnetometer 'none'; microphone 'none'; midi 'none'; navigation-override 'none'; payment 'none'; picture-in-picture 'none'; publickey-credentials-get 'none'; speaker-selection 'none'; sync-xhr 'none'; unoptimized-images 'none'; unsized-media 'none'; usb 'none'; screen-wake-lock 'none'; web-share 'none'; xr-spatial-tracking 'none';</code></td>
</tr>
<tr>
<td align="center"><code>X-Frame-Options</code></td>
<td align="left"><code>X_FRAME_OPTIONS</code></td>
<td align="center"><code>SAMEORIGIN</code></td>
</tr>
<tr>
<td align="center"><code>X-Content-Type-Options</code></td>
<td align="left"><code>X_CONTENT_TYPE_OPTIONS</code></td>
<td align="center"><code>nosniff</code></td>
</tr>
<tr>
<td align="center"><code>X-XSS-Protection</code></td>
<td align="left"><code>X_XSS_PROTECTION</code></td>
<td align="center"><code>1; mode=block</code></td>
</tr>
</tbody>
</table>
<h4 id="security-tuning-cors">CORS</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Cross-Origin Resource Sharing</a> lets you manage how your service can be contacted from different origins. Please note that you will have to allow the <code>OPTIONS</code> HTTP method using the <code>ALLOWED_METHODS</code> if you want to enable it (more info <a href="#security-tuning-allowed-methods">here</a>). Here is the list of settings related to CORS :</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_CORS</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use CORS</td>
</tr>
<tr>
<td><code>CORS_ALLOW_ORIGIN</code></td>
<td><code>*</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Allow-Origin header.</td>
</tr>
<tr>
<td><code>CORS_EXPOSE_HEADERS</code></td>
<td><code>Content-Length,Content-Range</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Expose-Headers header.</td>
</tr>
<tr>
<td><code>CORS_MAX_AGE</code></td>
<td><code>86400</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Max-Age header.</td>
</tr>
<tr>
<td><code>CORS_ALLOW_CREDENTIALS</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Send the Access-Control-Allow-Credentials header.</td>
</tr>
<tr>
<td><code>CORS_ALLOW_METHODS</code></td>
<td><code>GET, POST, OPTIONS</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Allow-Methods header.</td>
</tr>
<tr>
<td><code>CORS_ALLOW_HEADERS</code></td>
<td><code>DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Allow-Headers header.</td>
</tr>
</tbody>
</table>
<h2 id="security-tuning-https-ssltls">HTTPS / SSL/TLS</h2>
<p>Besides the HTTPS configuration, the following settings related to HTTPS can be set :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>REDIRECT_HTTP_TO_HTTPS</code></td>
<td align="center"><code>no</code></td>
<td align="left">When set to <code>yes</code>, will redirect every HTTP request to HTTPS even if BunkerWeb is not configured with HTTPS.</td>
</tr>
<tr>
<td align="center"><code>AUTO_REDIRECT_HTTP_TO_HTTPS</code></td>
<td align="center"><code>yes</code></td>
<td align="left">When set to <code>yes</code>, will redirect every HTTP request to HTTPS only if BunkerWeb is configured with HTTPS.</td>
</tr>
<tr>
<td align="center"><code>HTTPS_PROTOCOLS</code></td>
<td align="center"><code>TLSv1.2 TLSv1.3</code></td>
<td align="left">List of supported SSL/TLS protocols when HTTPS is enabled.</td>
</tr>
<tr>
<td align="center"><code>HTTP2</code></td>
<td align="center"><code>yes</code></td>
<td align="left">When set to <code>yes</code>, will enable HTTP2 protocol support when using HTTPS.</td>
</tr>
<tr>
<td align="center"><code>LISTEN_HTTP</code></td>
<td align="center"><code>yes</code></td>
<td align="left">When set to <code>no</code>, BunkerWeb will not listen for HTTP requests. Useful if you want HTTPS only for example.</td>
</tr>
</tbody>
</table>
<p>When using stream, the <code>SSL_PROTOCOLS</code> can be used which takes the same value as the <code>HTTPS_PROTOCOLS</code> one.</p>
<h3 id="security-tuning-lets-encrypt">Let's Encrypt</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>BunkerWeb comes with automatic Let's Encrypt certificate generation and renewal. This is the easiest way of getting HTTPS working out of the box for public-facing web applications. Please note that you will need to set up proper DNS A record(s) for each of your domains pointing to your public IP(s) where BunkerWeb is accessible.</p>
<p>Here is the list of related settings :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>AUTO_LETS_ENCRYPT</code></td>
<td align="center"><code>no</code></td>
<td align="left">When set to <code>yes</code>, HTTPS will be enabled with automatic certificate generation and renewal from Let's Encrypt.</td>
</tr>
<tr>
<td align="center"><code>EMAIL_LETS_ENCRYPT</code></td>
<td align="center"><code>contact@{FIRST_SERVER}</code></td>
<td align="left">Email to use when generating certificates. Let's Encrypt will send notifications to that email like certificate expiration.</td>
</tr>
<tr>
<td align="center"><code>USE_LETS_ENCRYPT_STAGING</code></td>
<td align="center"><code>no</code></td>
<td align="left">When set to <code>yes</code>, the staging server of Let's Encrypt will be used instead of the production one. Useful when doing tests to avoid being "blocked" due to limits.</td>
</tr>
</tbody>
</table>
<p>Full Let's Encrypt automation is fully working with stream mode as long as you open the <code>80/tcp</code> port from the outside. Please note that you will need to use the <code>LISTEN_STREAM_PORT_SSL</code> setting in order to choose your listening SSL/TLS port.</p>
<h3 id="security-tuning-custom-certificate">Custom certificate</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>If you want to use your own certificates, here is the list of related settings :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>USE_CUSTOM_SSL</code></td>
<td align="center"><code>no</code></td>
<td align="left">When set to <code>yes</code>, HTTPS will be enabled with custom certificates.</td>
</tr>
<tr>
<td align="center"><code>CUSTOM_SSL_CERT</code></td>
<td align="center"></td>
<td align="left">Full path to the certificate. If you have one or more intermediate certificate(s) in your chain of trust, you will need to provide the bundle (more info <a href="https://nginx.org/en/docs/http/configuring_https_servers.html#chains">here</a>).</td>
</tr>
<tr>
<td align="center"><code>CUSTOM_SSL_KEY</code></td>
<td align="center"></td>
<td align="left">Full path to the private key.</td>
</tr>
</tbody>
</table>
<p>When <code>USE_CUSTOM_HTTPS</code> is set to <code>yes</code>, BunkerWeb will check every day if the custom certificate specified in <code>CUSTOM_HTTPS_CERT</code> is modified and will reload NGINX if that's the case.</p>
<p>When using stream mode, you will need to use the <code>LISTEN_STREAM_PORT_SSL</code> setting in order to choose your listening SSL/TLS port.</p>
<h3 id="security-tuning-self-signed">Self-signed</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>If you want to quickly test HTTPS for staging/dev environment you can configure BunkerWeb to generate self-signed certificates, here is the list of related settings :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>GENERATE_SELF_SIGNED_SSL</code></td>
<td align="center"><code>no</code></td>
<td align="left">When set to <code>yes</code>, HTTPS will be enabled with automatic self-signed certificate generation and renewal from Let's Encrypt.</td>
</tr>
<tr>
<td align="center"><code>SELF_SIGNED_SSL_EXPIRY</code></td>
<td align="center"><code>365</code></td>
<td align="left">Number of days for the certificate expiration (<strong>-days</strong> value used with <strong>openssl</strong>).</td>
</tr>
<tr>
<td align="center"><code>SELF_SIGNED_SSL_SUBJ</code></td>
<td align="center"><code>/CN=www.example.com/</code></td>
<td align="left">Certificate subject to use (<strong>-subj</strong> value used with <strong>openssl</strong>).</td>
</tr>
</tbody>
</table>
<p>When using stream mode, you will need to use the <code>LISTEN_STREAM_PORT_SSL</code> setting in order to choose your listening SSL/TLS port.</p>
<h2 id="security-tuning-modsecurity">ModSecurity</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>ModSecurity is integrated and enabled by default alongside the OWASP Core Rule Set within BunkerWeb. Here is the list of related settings :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>USE_MODSECURITY</code></td>
<td align="center"><code>yes</code></td>
<td align="left">When set to <code>yes</code>, ModSecurity will be enabled.</td>
</tr>
<tr>
<td align="center"><code>USE_MODSECURITY_CRS</code></td>
<td align="center"><code>yes</code></td>
<td align="left">When set to <code>yes</code> and <code>USE_MODSECURITY</code> is also set to <code>yes</code>, the OWASP Core Rule Set will be loaded.</td>
</tr>
</tbody>
</table>
<p>We strongly recommend keeping both ModSecurity and the OWASP Core Rule Set enabled. The only downsides are the false positives that may occur. But they can be fixed with some efforts and the CRS team maintains a list of exclusions for common applications (e.g., WordPress, Nextcloud, Drupal, Cpanel, ...).</p>
<p>Tuning ModSecurity and the CRS can be done using <a href="#quickstart-guide-custom-configurations">custom configurations</a> :</p>
<ul>
<li>modsec-crs : before the OWASP Core Rule Set is loaded</li>
<li>modsec : after the OWASP Core Rule Set is loaded (also used if CRS is not loaded)</li>
</ul>
<p>For example, you can add a custom configuration with type <code>modsec-crs</code> to add CRS exclusions :</p>
<div class="highlight"><pre><span></span><code>SecAction \
 &quot;id:900130,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.crs_exclusions_wordpress=1&quot;
</code></pre></div>
<p>You can also add a custom configuration with type <code>modsec</code> to update loaded CRS rules :</p>
<div class="highlight"><pre><span></span><code>SecRule REQUEST_FILENAME &quot;/wp-admin/admin-ajax.php&quot; &quot;id:1,ctl:ruleRemoveByTag=attack-xss,ctl:ruleRemoveByTag=attack-rce&quot;
SecRule REQUEST_FILENAME &quot;/wp-admin/options.php&quot; &quot;id:2,ctl:ruleRemoveByTag=attack-xss&quot;
SecRule REQUEST_FILENAME &quot;^/wp-json/yoast&quot; &quot;id:3,ctl:ruleRemoveById=930120&quot;
</code></pre></div>
<h2 id="security-tuning-bad-behavior">Bad behavior</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>When attackers search for and/or exploit vulnerabilities they might generate some "suspicious" HTTP status codes that a "regular" user won’t generate within a period of time. If we detect that kind of behavior we can ban the offending IP address and force the attacker to come up with a new one.</p>
<p>That kind of security measure is implemented and enabled by default in BunkerWeb and is called "Bad behavior". Here is the list of the related settings :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>USE_BAD_BEHAVIOR</code></td>
<td align="center"><code>yes</code></td>
<td align="left">When set to <code>yes</code>, the Bad behavior feature will be enabled.</td>
</tr>
<tr>
<td align="center"><code>BAD_BEHAVIOR_STATUS_CODES</code></td>
<td align="center"><code>400 401 403 404 405 429 444</code></td>
<td align="left">List of HTTP status codes considered as "suspicious".</td>
</tr>
<tr>
<td align="center"><code>BAD_BEHAVIOR_BAN_TIME</code></td>
<td align="center"><code>86400</code></td>
<td align="left">The duration time (in seconds) of a ban when a client reached the threshold.</td>
</tr>
<tr>
<td align="center"><code>BAD_BEHAVIOR_THRESHOLD</code></td>
<td align="center"><code>10</code></td>
<td align="left">Maximum number of "suspicious" HTTP status codes within the time period.</td>
</tr>
<tr>
<td align="center"><code>BAD_BEHAVIOR_COUNT_TIME</code></td>
<td align="center"><code>60</code></td>
<td align="left">Period of time during which we count "suspicious" HTTP status codes.</td>
</tr>
</tbody>
</table>
<p>In other words, with the default values, if a client generates more than <code>10</code> status codes from the list <code>400 401 403 404 405 429 444</code> within <code>60</code> seconds their IP address will be banned for <code>86400</code> seconds.</p>
<p>When using stream mode, only the <code>444</code> status code will count as "bad".</p>
<h2 id="security-tuning-antibot">Antibot</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Attackers will certainly use automated tools to exploit/find some vulnerabilities in your web applications. One countermeasure is to challenge the users to detect if they look like a bot. If the challenge is solved, we consider the client as "legitimate" and they can access the web application.</p>
<p>That kind of security is implemented but not enabled by default in BunkerWeb and is called "Antibot". Here is the list of supported challenges :</p>
<ul>
<li><strong>Cookie</strong> : send a cookie to the client, we expect to get the cookie back on other requests</li>
<li><strong>Javascript</strong> : force a client to solve a computation challenge using Javascript</li>
<li><strong>Captcha</strong> : force the client to solve a classical captcha (no external dependencies)</li>
<li><strong>hCaptcha</strong> : force the client to solve a captcha from hCaptcha</li>
<li><strong>reCAPTCHA</strong> : force the client to get a minimum score with Google reCAPTCHA</li>
</ul>
<p>Here is the list of related settings :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>USE_ANTIBOT</code></td>
<td align="center"><code>no</code></td>
<td align="left">Accepted values to enable Antibot feature : <code>cookie</code>, <code>javascript</code>, <code>captcha</code>, <code>hcaptcha</code> and <code>recaptcha</code>.</td>
</tr>
<tr>
<td align="center"><code>ANTIBOT_URI</code></td>
<td align="center"><code>/challenge</code></td>
<td align="left">URI that clients will be redirected to in order to solve the challenge. Be sure that it isn't used in your web application.</td>
</tr>
<tr>
<td align="center"><code>ANTIBOT_SESSION_SECRET</code></td>
<td align="center"><code>random</code></td>
<td align="left">The secret used to encrypt cookies when using Antibot. The special value <code>random</code> will generate one for you. Be sure to set it when you use a clustered integration (32 chars).</td>
</tr>
<tr>
<td align="center"><code>ANTIBOT_HCAPTCHA_SITEKEY</code> and <code>ANTIBOT_RECAPTCHA_SITEKEY</code></td>
<td align="center"></td>
<td align="left">The Sitekey value to use when <code>USE_ANTIBOT</code> is set to <code>hcaptcha</code> or <code>recaptcha</code>.</td>
</tr>
<tr>
<td align="center"><code>ANTIBOT_HCAPTCHA_SECRET</code> and <code>ANTIBOT_RECAPTCHA_SECRET</code></td>
<td align="center"></td>
<td align="left">The Secret value to use when <code>USE_ANTIBOT</code> is set to <code>hcaptcha</code> or <code>recaptcha</code>.</td>
</tr>
<tr>
<td align="center"><code>ANTIBOT_RECAPTCHA_SCORE</code></td>
<td align="center"><code>0.7</code></td>
<td align="left">The minimum score that clients must have when <code>USE_ANTIBOT</code> is set to <code>recaptcha</code>.</td>
</tr>
</tbody>
</table>
<h2 id="security-tuning-blacklisting-whitelisting-and-greylisting">Blacklisting, whitelisting and greylisting</h2>
<p>The blacklisting security feature is very easy to understand : if a specific criteria is met, the client will be banned. As for the whitelisting, it's the exact opposite : if a specific criteria is met, the client will be allowed and no additional security check will be done. Whereas for the greylisting :  if a specific criteria is met, the client will be allowed but additional security checks will be done.</p>
<p>You can configure blacklisting, whitelisting and greylisting at the same time. If that's the case, note that whitelisting is executed before blacklisting and greylisting : even if a criteria is true for all of them, the client will be whitelisted.</p>
<h3 id="security-tuning-blacklisting">Blacklisting</h3>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /></p>
<p>You can use the following settings to set up blacklisting :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>USE_BLACKLIST</code></td>
<td align="center"><code>yes</code></td>
<td align="left">Activate blacklist feature.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_IP</code></td>
<td align="center"></td>
<td align="left">List of IP/network, separated with spaces, to block.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_IP_URLS</code></td>
<td align="center"><code>https://www.dan.me.uk/torlist/?exit</code></td>
<td align="left">List of URLs, separated with spaces, containing bad IP/network to block.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_RDNS_GLOBAL</code></td>
<td align="center"><code>yes</code></td>
<td align="left">Only perform RDNS blacklist checks on global IP addresses.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_RDNS</code></td>
<td align="center"><code>.shodan.io .censys.io</code></td>
<td align="left">List of reverse DNS suffixes, separated with spaces, to block.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_RDNS_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs, separated with spaces, containing reverse DNS suffixes to block.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_ASN</code></td>
<td align="center"></td>
<td align="left">List of ASN numbers, separated with spaces, to block.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_ASN_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs, separated with spaces, containing ASN to block.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_USER_AGENT</code></td>
<td align="center"></td>
<td align="left">List of User-Agent, separated with spaces, to block.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_USER_AGENT_URLS</code></td>
<td align="center"><code>https://raw.githubusercontent.com/mitchellkrogza/nginx-ultimate-bad-bot-blocker/master/_generator_lists/bad-user-agents.list</code></td>
<td align="left">List of URLs, separated with spaces, containing bad User-Agent to block.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_URI</code></td>
<td align="center"></td>
<td align="left">List of URI, separated with spaces, to block.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_URI_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs, separated with spaces, containing bad URI to block.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_IGNORE_IP</code></td>
<td align="center"></td>
<td align="left">List of IP/network, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_IGNORE_IP_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs, separated with spaces, containing IP/network to ignore in the blacklist.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_IGNORE_RDNS</code></td>
<td align="center"></td>
<td align="left">List of reverse DNS suffixes, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_IGNORE_RDNS_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs, separated with spaces, containing reverse DNS suffixes to ignore in the blacklist.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_IGNORE_ASN</code></td>
<td align="center"></td>
<td align="left">List of ASN numbers, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_IGNORE_ASN_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs, separated with spaces, containing ASN to ignore in the blacklist.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_IGNORE_USER_AGENT</code></td>
<td align="center"></td>
<td align="left">List of User-Agent, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_IGNORE_USER_AGENT_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs, separated with spaces, containing User-Agent to ignore in the blacklist.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_IGNORE_URI</code></td>
<td align="center"></td>
<td align="left">List of URI, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td align="center"><code>BLACKLIST_IGNORE_URI_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs, separated with spaces, containing URI to ignore in the blacklist.</td>
</tr>
</tbody>
</table>
<p>When using stream mode, only IP, RDNS and ASN checks will be done.</p>
<h3 id="security-tuning-greylisting">Greylisting</h3>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /></p>
<p>You can use the following settings to set up greylisting :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>USE_GREYLIST</code></td>
<td align="center"><code>no</code></td>
<td align="left">When set to <code>yes</code>, will enable greylisting based on various criteria.</td>
</tr>
<tr>
<td align="center"><code>GREYLIST_IP</code></td>
<td align="center"></td>
<td align="left">List of IPs and networks to greylist.</td>
</tr>
<tr>
<td align="center"><code>GREYLIST_IP_URLS</code></td>
<td align="center"></td>
<td align="left">List of URL containing IP and network to greylist.</td>
</tr>
<tr>
<td align="center"><code>GREYLIST_RDNS</code></td>
<td align="center"></td>
<td align="left">List of reverse DNS to greylist.</td>
</tr>
<tr>
<td align="center"><code>GREYLIST_RDNS_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs containing reverse DNS to greylist.</td>
</tr>
<tr>
<td align="center"><code>GREYLIST_ASN</code></td>
<td align="center"></td>
<td align="left">List of ASN to greylist.</td>
</tr>
<tr>
<td align="center"><code>GREYLIST_ASN_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs containing ASN to greylist.</td>
</tr>
<tr>
<td align="center"><code>GREYLIST_USER_AGENT</code></td>
<td align="center"></td>
<td align="left">List of User-Agents to greylist.</td>
</tr>
<tr>
<td align="center"><code>GREYLIST_USER_AGENT_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs containing User-Agent(s) to greylist.</td>
</tr>
<tr>
<td align="center"><code>GREYLIST_URI</code></td>
<td align="center"></td>
<td align="left">List of requests URI to greylist.</td>
</tr>
<tr>
<td align="center"><code>GREYLIST_URI_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs containing request URI to greylist.</td>
</tr>
</tbody>
</table>
<p>When using stream mode, only IP, RDNS and ASN checks will be done.</p>
<h3 id="security-tuning-whitelisting">Whitelisting</h3>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /></p>
<p>You can use the following settings to set up whitelisting :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>USE_WHITELIST</code></td>
<td align="center"><code>yes</code></td>
<td align="left">When set to <code>yes</code>, will enable whitelisting based on various criteria.</td>
</tr>
<tr>
<td align="center"><code>WHITELIST_IP</code></td>
<td align="center"><code>20.191.45.212 40.88.21.235 40.76.173.151 40.76.163.7 20.185.79.47 52.142.26.175 20.185.79.15 52.142.24.149 40.76.162.208 40.76.163.23 40.76.162.191 40.76.162.247 54.208.102.37 107.21.1.8</code></td>
<td align="left">List of IP and network to whitelist. The default list contains IP from DuckDuckGo crawler.</td>
</tr>
<tr>
<td align="center"><code>WHITELIST_IP_URLS</code></td>
<td align="center">``</td>
<td align="left">List of URLs containing IP and network to whitelist.</td>
</tr>
<tr>
<td align="center"><code>WHITELIST_RDNS</code></td>
<td align="center"><code>.google.com .googlebot.com .yandex.ru .yandex.net .yandex.com .search.msn.com .baidu.com .baidu.jp .crawl.yahoo.net .fwd.linkedin.com .twitter.com .twttr.com .discord.com</code></td>
<td align="left">List of reverse DNS to whitelist. Default list contains various reverse DNS of search engines and social media crawlers.</td>
</tr>
<tr>
<td align="center"><code>WHITELIST_RDNS_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs containing reverse DNS to whitelist.</td>
</tr>
<tr>
<td align="center"><code>WHITELIST_ASN</code></td>
<td align="center"><code>32934</code></td>
<td align="left">List of ASN to whitelist. The default list contains the ASN of Facebook.</td>
</tr>
<tr>
<td align="center"><code>WHITELIST_ASN_URLS</code></td>
<td align="center"></td>
<td align="left">List of URL containing ASN to whitelist.</td>
</tr>
<tr>
<td align="center"><code>WHITELIST_USER_AGENT</code></td>
<td align="center"></td>
<td align="left">List of User-Agent to whitelist.</td>
</tr>
<tr>
<td align="center"><code>WHITELIST_USER_AGENT_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs containing User-Agent to whitelist.</td>
</tr>
<tr>
<td align="center"><code>WHITELIST_URI</code></td>
<td align="center"></td>
<td align="left">List of requests URI to whitelist.</td>
</tr>
<tr>
<td align="center"><code>WHITELIST_URI_URLS</code></td>
<td align="center"></td>
<td align="left">List of URLs containing request(s) URI to whitelist.</td>
</tr>
</tbody>
</table>
<p>When using stream mode, only IP, RDNS and ASN checks will be done.</p>
<h2 id="security-tuning-reverse-scan">Reverse scan</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Reverse scan is a feature designed to detect open ports by establishing TCP connections with clients' IP addresses.
Consider adding this feature if you want to detect possible open proxies or connections from servers.</p>
<p>We provide a list of suspicious ports by default but it can be modified to fit your needs. Be mindful, adding too many ports to the list can significantly slow down clients' connections due to the network checks. If a listed port is open, the client's access will be denied.</p>
<p>Please be aware, this feature is new and further improvements will be added soon.</p>
<p>Here is the list of settings related to reverse scan :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>USE_REVERSE_SCAN</code></td>
<td align="center"><code>no</code></td>
<td align="left">When set to <code>yes</code>, will enable ReverseScan.</td>
</tr>
<tr>
<td align="center"><code>REVERSE_SCAN_PORTS</code></td>
<td align="center"><code>22 80 443 3128 8000 8080</code></td>
<td align="left">List of suspicious ports to scan.</td>
</tr>
<tr>
<td align="center"><code>REVERSE_SCAN_TIMEOUT</code></td>
<td align="center"><code>500</code></td>
<td align="left">Specify the maximum timeout (in ms) when scanning a port.</td>
</tr>
</tbody>
</table>
<h2 id="security-tuning-bunkernet">BunkerNet</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>BunkerNet is a crowdsourced database of malicious requests shared between all BunkerWeb instances over the world.</p>
<p>If you enable BunkerNet, malicious requests will be sent to a remote server and will be analyzed by our systems. By doing so, we can extract malicious data from everyone's reports and give back the results to each BunkerWeb instances participating into BunkerNet.</p>
<p>At the moment, that feature should be considered in "beta". We only extract malicious IP and we are very strict about how we do it to avoid any "poisoning". We strongly recommend activating it (which is the default) because the more instances participate, the more data we have to improve the algorithm.</p>
<p>The setting used to enable or disable BunkerNet is <code>USE_BUNKERNET</code> (default : <code>yes</code>).</p>
<h2 id="security-tuning-dnsbl">DNSBL</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>DNSBL or "DNS BlackList" is an external list of malicious IPs that you query using the DNS protocol. Automatic querying of that kind of blacklist is supported by BunkerWeb. If a remote DNSBL server of your choice says that the IP address of the client is in the blacklist, it will be banned.</p>
<p>Here is the list of settings related to DNSBL :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>USE_DNSBL</code></td>
<td align="center"><code>yes</code></td>
<td align="left">When set to <code>yes</code>, will enable DNSBL checking.</td>
</tr>
<tr>
<td align="center"><code>DNSBL_LIST</code></td>
<td align="center"><code>bl.blocklist.de problems.dnsbl.sorbs.net sbl.spamhaus.org xbl.spamhaus.org</code></td>
<td align="left">List of DNSBL servers to ask.</td>
</tr>
</tbody>
</table>
<h2 id="security-tuning-limiting">Limiting</h2>
<p>BunkerWeb supports applying a limit policy to :</p>
<ul>
<li>Number of connections per IP</li>
<li>Number of requests per IP and URL within a time period</li>
</ul>
<p>Please note that it should not be considered as an effective solution against DoS or DDoS but rather as an anti-bruteforce measure or rate limit policy for API.</p>
<p>In both cases (connections or requests) if the limit is reached, the client will receive the HTTP status "429 - Too Many Requests".</p>
<h3 id="security-tuning-connections">Connections</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>The following settings are related to the Limiting connections feature :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>USE_LIMIT_CONN</code></td>
<td align="center"><code>yes</code></td>
<td align="left">When set to <code>yes</code>, will limit the maximum number of concurrent connections for a given IP.</td>
</tr>
<tr>
<td align="center"><code>LIMIT_CONN_MAX_HTTP1</code></td>
<td align="center"><code>10</code></td>
<td align="left">Maximum number of concurrent connections when using HTTP1 protocol.</td>
</tr>
<tr>
<td align="center"><code>LIMIT_CONN_MAX_HTTP2</code></td>
<td align="center"><code>100</code></td>
<td align="left">Maximum number of concurrent streams when using HTTP2 protocol.</td>
</tr>
<tr>
<td align="center"><code>LIMIT_CONN_MAX_STREAM</code></td>
<td align="center"><code>10</code></td>
<td align="left">Maximum number of connections per IP when using stream.</td>
</tr>
</tbody>
</table>
<h3 id="security-tuning-requests">Requests</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>The following settings are related to the Limiting requests feature :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>USE_LIMIT_REQ</code></td>
<td align="center"><code>yes</code></td>
<td align="left">When set to <code>yes</code>, will limit the number of requests for a given IP on each URL within a period of time.</td>
</tr>
<tr>
<td align="center"><code>LIMIT_REQ_URL</code></td>
<td align="center"><code>/</code></td>
<td align="left">The URL that will be limited. The special URL <code>/</code> will define a default limit for all URLs.</td>
</tr>
<tr>
<td align="center"><code>LIMIT_REQ_RATE</code></td>
<td align="center"><code>2r/s</code></td>
<td align="left">The limit to apply to the corresponding URL. Syntax is <code>Xr/Y</code> where <strong>X</strong> is the number of request(s) and <strong>Y</strong> the period of time (s for second, m for minute, h for hour and d for day).</td>
</tr>
</tbody>
</table>
<p>Please note that you can add different rates for different URLs by adding a number as a suffix to the settings for example : <code>LIMIT_REQ_URL_1=/url1</code>, <code>LIMIT_REQ_RATE_1=5r/d</code>, <code>LIMIT_REQ_URL_2=/url2</code>, <code>LIMIT_REQ_RATE_2=1r/m</code>, ...</p>
<p>Another important thing to note is that <code>LIMIT_REQ_URL</code> accepts LUA patterns.</p>
<h2 id="security-tuning-country">Country</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>The country security feature allows you to apply policy based on the country of the IP address of clients :</p>
<ul>
<li>Deny any access if the country is in a blacklist</li>
<li>Only allow access if the country is in a whitelist (other security checks will still be executed)</li>
</ul>
<p>Here is the list of related settings :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>BLACKLIST_COUNTRY</code></td>
<td align="center"></td>
<td align="left">List of 2 letters country code to blacklist.</td>
</tr>
<tr>
<td align="center"><code>WHITELIST_COUNTRY</code></td>
<td align="center"></td>
<td align="left">List of 2 letters country code to whitelist.</td>
</tr>
</tbody>
</table>
<p>Using both country blacklist and whitelist at the same time makes no sense. If you do, please note that only the whitelist will be executed.</p>
<h2 id="security-tuning-authentication">Authentication</h2>
<h3 id="security-tuning-auth-basic">Auth basic</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>You can quickly protect sensitive resources like the admin area for example, by requiring HTTP basic authentication. Here is the list of related settings :</p>
<table>
<thead>
<tr>
<th align="center">Setting</th>
<th align="center">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>USE_AUTH_BASIC</code></td>
<td align="center"><code>no</code></td>
<td align="left">When set to <code>yes</code> HTTP auth basic will be enabled.</td>
</tr>
<tr>
<td align="center"><code>AUTH_BASIC_LOCATION</code></td>
<td align="center"><code>sitewide</code></td>
<td align="left">Location (URL) of the sensitive resource. Use special value <code>sitewide</code> to enable everywhere.</td>
</tr>
<tr>
<td align="center"><code>AUTH_BASIC_USER</code></td>
<td align="center"><code>changeme</code></td>
<td align="left">The username required.</td>
</tr>
<tr>
<td align="center"><code>AUTH_BASIC_PASSWORD</code></td>
<td align="center"><code>changeme</code></td>
<td align="left">The password required.</td>
</tr>
<tr>
<td align="center"><code>AUTH_BASIC_TEXT</code></td>
<td align="center"><code>Restricted area</code></td>
<td align="left">Text to display in the auth prompt.</td>
</tr>
</tbody>
</table>
<h3 id="security-tuning-auth-request">Auth request</h3>
<p>You can deploy complex authentication (e.g. SSO), by using the auth request settings (see <a href="https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-subrequest-authentication/">here</a> for more information on the feature). Please note that you will find <a href="https://www.authelia.com/">Authelia</a> and <a href="https://goauthentik.io/">Authentik</a> examples in the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/examples">repository</a>.</p>
<p><strong>Auth request settings are related to reverse proxy rules.</strong></p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>REVERSE_PROXY_AUTH_REQUEST</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Enable authentication using an external provider (value of auth_request directive).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_AUTH_REQUEST_SIGNIN_URL</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Redirect clients to sign-in URL when using REVERSE_PROXY_AUTH_REQUEST (used when auth_request call returned 401).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_AUTH_REQUEST_SET</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>List of variables to set from the authentication provider, separated with ; (values of auth_request_set directives).</td>
</tr>
</tbody>
</table></section><section class="print-page" id="settings"><h1 id="settings-settings">Settings</h1>
<div class="admonition info">
<p class="admonition-title">Settings generator tool</p>
<p>To help you tune BunkerWeb, we have made an easy-to-use settings generator tool available at <a href="https://config.bunkerweb.io">config.bunkerweb.io</a>.</p>
</div>
<p>This section contains the full list of settings supported by BunkerWeb. If you are not yet familiar with BunkerWeb, you should first read the <a href="#concepts">concepts</a> section of the documentation. Please follow the instructions for your own <a href="#integrations">integration</a> on how to apply the settings.</p>
<p>As a general rule when multisite mode is enabled, if you want to apply settings with multisite context to a specific server, you will need to add the primary (first) server name as a prefix like <code>www.example.com_USE_ANTIBOT=captcha</code> or <code>myapp.example.com_USE_GZIP=yes</code> for example.</p>
<p>When settings are considered as "multiple", it means that you can have multiple groups of settings for the same feature by adding numbers as suffix like <code>REVERSE_PROXY_URL_1=/subdir</code>, <code>REVERSE_PROXY_HOST_1=http://myhost1</code>, <code>REVERSE_PROXY_URL_2=/anotherdir</code>, <code>REVERSE_PROXY_HOST_2=http://myhost2</code>, ... for example.</p>
<h2 id="settings-global-settings">Global settings</h2>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /></p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>IS_LOADING</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Internal use : set to yes when BW is loading.</td>
</tr>
<tr>
<td><code>NGINX_PREFIX</code></td>
<td><code>/etc/nginx/</code></td>
<td>global</td>
<td>no</td>
<td>Where nginx will search for configurations.</td>
</tr>
<tr>
<td><code>HTTP_PORT</code></td>
<td><code>8080</code></td>
<td>global</td>
<td>no</td>
<td>HTTP port number which bunkerweb binds to.</td>
</tr>
<tr>
<td><code>HTTPS_PORT</code></td>
<td><code>8443</code></td>
<td>global</td>
<td>no</td>
<td>HTTPS port number which bunkerweb binds to.</td>
</tr>
<tr>
<td><code>MULTISITE</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Multi site activation.</td>
</tr>
<tr>
<td><code>SERVER_NAME</code></td>
<td><code>www.example.com</code></td>
<td>multisite</td>
<td>no</td>
<td>List of the virtual hosts served by bunkerweb.</td>
</tr>
<tr>
<td><code>WORKER_PROCESSES</code></td>
<td><code>auto</code></td>
<td>global</td>
<td>no</td>
<td>Number of worker processes.</td>
</tr>
<tr>
<td><code>WORKER_RLIMIT_NOFILE</code></td>
<td><code>2048</code></td>
<td>global</td>
<td>no</td>
<td>Maximum number of open files for worker processes.</td>
</tr>
<tr>
<td><code>WORKER_CONNECTIONS</code></td>
<td><code>1024</code></td>
<td>global</td>
<td>no</td>
<td>Maximum number of connections per worker.</td>
</tr>
<tr>
<td><code>LOG_FORMAT</code></td>
<td><code>$host $remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent"</code></td>
<td>global</td>
<td>no</td>
<td>The format to use for access logs.</td>
</tr>
<tr>
<td><code>LOG_LEVEL</code></td>
<td><code>notice</code></td>
<td>global</td>
<td>no</td>
<td>The level to use for error logs.</td>
</tr>
<tr>
<td><code>DNS_RESOLVERS</code></td>
<td><code>127.0.0.11</code></td>
<td>global</td>
<td>no</td>
<td>DNS addresses of resolvers to use.</td>
</tr>
<tr>
<td><code>DATASTORE_MEMORY_SIZE</code></td>
<td><code>64m</code></td>
<td>global</td>
<td>no</td>
<td>Size of the internal datastore.</td>
</tr>
<tr>
<td><code>CACHESTORE_MEMORY_SIZE</code></td>
<td><code>64m</code></td>
<td>global</td>
<td>no</td>
<td>Size of the internal cachestore.</td>
</tr>
<tr>
<td><code>CACHESTORE_IPC_MEMORY_SIZE</code></td>
<td><code>16m</code></td>
<td>global</td>
<td>no</td>
<td>Size of the internal cachestore (ipc).</td>
</tr>
<tr>
<td><code>CACHESTORE_MISS_MEMORY_SIZE</code></td>
<td><code>16m</code></td>
<td>global</td>
<td>no</td>
<td>Size of the internal cachestore (miss).</td>
</tr>
<tr>
<td><code>CACHESTORE_LOCKS_MEMORY_SIZE</code></td>
<td><code>16m</code></td>
<td>global</td>
<td>no</td>
<td>Size of the internal cachestore (locks).</td>
</tr>
<tr>
<td><code>USE_API</code></td>
<td><code>yes</code></td>
<td>global</td>
<td>no</td>
<td>Activate the API to control BunkerWeb.</td>
</tr>
<tr>
<td><code>API_HTTP_PORT</code></td>
<td><code>5000</code></td>
<td>global</td>
<td>no</td>
<td>Listen port number for the API.</td>
</tr>
<tr>
<td><code>API_LISTEN_IP</code></td>
<td><code>0.0.0.0</code></td>
<td>global</td>
<td>no</td>
<td>Listen IP address for the API.</td>
</tr>
<tr>
<td><code>API_SERVER_NAME</code></td>
<td><code>bwapi</code></td>
<td>global</td>
<td>no</td>
<td>Server name (virtual host) for the API.</td>
</tr>
<tr>
<td><code>API_WHITELIST_IP</code></td>
<td><code>127.0.0.0/8</code></td>
<td>global</td>
<td>no</td>
<td>List of IP/network allowed to contact the API.</td>
</tr>
<tr>
<td><code>AUTOCONF_MODE</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable Autoconf Docker integration.</td>
</tr>
<tr>
<td><code>SWARM_MODE</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable Docker Swarm integration.</td>
</tr>
<tr>
<td><code>KUBERNETES_MODE</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable Kubernetes integration.</td>
</tr>
<tr>
<td><code>SERVER_TYPE</code></td>
<td><code>http</code></td>
<td>multisite</td>
<td>no</td>
<td>Server type : http or stream.</td>
</tr>
<tr>
<td><code>LISTEN_STREAM</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable listening for non-ssl (passthrough).</td>
</tr>
<tr>
<td><code>LISTEN_STREAM_PORT</code></td>
<td><code>1337</code></td>
<td>multisite</td>
<td>no</td>
<td>Listening port for non-ssl (passthrough).</td>
</tr>
<tr>
<td><code>LISTEN_STREAM_PORT_SSL</code></td>
<td><code>4242</code></td>
<td>multisite</td>
<td>no</td>
<td>Listening port for ssl (passthrough).</td>
</tr>
<tr>
<td><code>USE_UDP</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>UDP listen instead of TCP (stream).</td>
</tr>
</tbody>
</table>
<h2 id="settings-core-settings">Core settings</h2>
<h3 id="settings-antibot">Antibot</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Bot detection by using a challenge.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_ANTIBOT</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate antibot feature.</td>
</tr>
<tr>
<td><code>ANTIBOT_URI</code></td>
<td><code>/challenge</code></td>
<td>multisite</td>
<td>no</td>
<td>Unused URI that clients will be redirected to to solve the challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_RECAPTCHA_SCORE</code></td>
<td><code>0.7</code></td>
<td>multisite</td>
<td>no</td>
<td>Minimum score required for reCAPTCHA challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_RECAPTCHA_SITEKEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Sitekey for reCAPTCHA challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_RECAPTCHA_SECRET</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Secret for reCAPTCHA challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_HCAPTCHA_SITEKEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Sitekey for hCaptcha challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_HCAPTCHA_SECRET</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Secret for hCaptcha challenge.</td>
</tr>
</tbody>
</table>
<h3 id="settings-auth-basic">Auth basic</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Enforce login before accessing a resource or the whole site using HTTP basic auth method.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_AUTH_BASIC</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use HTTP basic auth</td>
</tr>
<tr>
<td><code>AUTH_BASIC_LOCATION</code></td>
<td><code>sitewide</code></td>
<td>multisite</td>
<td>no</td>
<td>URL of the protected resource or sitewide value.</td>
</tr>
<tr>
<td><code>AUTH_BASIC_USER</code></td>
<td><code>changeme</code></td>
<td>multisite</td>
<td>no</td>
<td>Username</td>
</tr>
<tr>
<td><code>AUTH_BASIC_PASSWORD</code></td>
<td><code>changeme</code></td>
<td>multisite</td>
<td>no</td>
<td>Password</td>
</tr>
<tr>
<td><code>AUTH_BASIC_TEXT</code></td>
<td><code>Restricted area</code></td>
<td>multisite</td>
<td>no</td>
<td>Text to display</td>
</tr>
</tbody>
</table>
<h3 id="settings-bad-behavior">Bad behavior</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Ban IP generating too much 'bad' HTTP status code in a period of time.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BAD_BEHAVIOR</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate Bad behavior feature.</td>
</tr>
<tr>
<td><code>BAD_BEHAVIOR_STATUS_CODES</code></td>
<td><code>400 401 403 404 405 429 444</code></td>
<td>multisite</td>
<td>no</td>
<td>List of HTTP status codes considered as 'bad'.</td>
</tr>
<tr>
<td><code>BAD_BEHAVIOR_BAN_TIME</code></td>
<td><code>86400</code></td>
<td>multisite</td>
<td>no</td>
<td>The duration time (in seconds) of a ban when the corresponding IP has reached the threshold.</td>
</tr>
<tr>
<td><code>BAD_BEHAVIOR_THRESHOLD</code></td>
<td><code>10</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum number of 'bad' HTTP status codes within the period of time before IP is banned.</td>
</tr>
<tr>
<td><code>BAD_BEHAVIOR_COUNT_TIME</code></td>
<td><code>60</code></td>
<td>multisite</td>
<td>no</td>
<td>Period of time (in seconds) during which we count 'bad' HTTP status codes.</td>
</tr>
</tbody>
</table>
<h3 id="settings-blacklist">Blacklist</h3>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Deny access based on internal and external IP/network/rDNS/ASN blacklists.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BLACKLIST</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate blacklist feature.</td>
</tr>
<tr>
<td><code>BLACKLIST_IP</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of IP/network, separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_IP_URLS</code></td>
<td><code>https://www.dan.me.uk/torlist/?exit</code></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing bad IP/network to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_RDNS_GLOBAL</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Only perform RDNS blacklist checks on global IP addresses.</td>
</tr>
<tr>
<td><code>BLACKLIST_RDNS</code></td>
<td><code>.shodan.io .censys.io</code></td>
<td>multisite</td>
<td>no</td>
<td>List of reverse DNS suffixes, separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_RDNS_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing reverse DNS suffixes to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_ASN</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of ASN numbers, separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_ASN_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing ASN to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_USER_AGENT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of User-Agent, separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_USER_AGENT_URLS</code></td>
<td><code>https://raw.githubusercontent.com/mitchellkrogza/nginx-ultimate-bad-bot-blocker/master/_generator_lists/bad-user-agents.list</code></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing bad User-Agent to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_URI</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URI, separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_URI_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing bad URI to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_IP</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of IP/network, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_IP_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing IP/network to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_RDNS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of reverse DNS suffixes, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_RDNS_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing reverse DNS suffixes to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_ASN</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of ASN numbers, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_ASN_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing ASN to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_USER_AGENT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of User-Agent, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_USER_AGENT_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing User-Agent to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_URI</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URI, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_URI_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing URI to ignore in the blacklist.</td>
</tr>
</tbody>
</table>
<h3 id="settings-brotli">Brotli</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Compress HTTP requests with the brotli algorithm.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BROTLI</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use brotli</td>
</tr>
<tr>
<td><code>BROTLI_TYPES</code></td>
<td><code>application/atom+xml application/javascript application/json application/rss+xml application/vnd.ms-fontobject application/x-font-opentype application/x-font-truetype application/x-font-ttf application/x-javascript application/xhtml+xml application/xml font/eot font/opentype font/otf font/truetype image/svg+xml image/vnd.microsoft.icon image/x-icon image/x-win-bitmap text/css text/javascript text/plain text/xml</code></td>
<td>multisite</td>
<td>no</td>
<td>List of MIME types that will be compressed with brotli.</td>
</tr>
<tr>
<td><code>BROTLI_MIN_LENGTH</code></td>
<td><code>1000</code></td>
<td>multisite</td>
<td>no</td>
<td>Minimum length for brotli compression.</td>
</tr>
<tr>
<td><code>BROTLI_COMP_LEVEL</code></td>
<td><code>6</code></td>
<td>multisite</td>
<td>no</td>
<td>The compression level of the brotli algorithm.</td>
</tr>
</tbody>
</table>
<h3 id="settings-bunkernet">BunkerNet</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Share threat data with other BunkerWeb instances via BunkerNet.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BUNKERNET</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate BunkerNet feature.</td>
</tr>
<tr>
<td><code>BUNKERNET_SERVER</code></td>
<td><code>https://api.bunkerweb.io</code></td>
<td>global</td>
<td>no</td>
<td>Address of the BunkerNet API.</td>
</tr>
</tbody>
</table>
<h3 id="settings-cors">CORS</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Cross-Origin Resource Sharing.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_CORS</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use CORS</td>
</tr>
<tr>
<td><code>CORS_ALLOW_ORIGIN</code></td>
<td><code>*</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Allow-Origin header.</td>
</tr>
<tr>
<td><code>CORS_EXPOSE_HEADERS</code></td>
<td><code>Content-Length,Content-Range</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Expose-Headers header.</td>
</tr>
<tr>
<td><code>CORS_MAX_AGE</code></td>
<td><code>86400</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Max-Age header.</td>
</tr>
<tr>
<td><code>CORS_ALLOW_CREDENTIALS</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Send the Access-Control-Allow-Credentials header.</td>
</tr>
<tr>
<td><code>CORS_ALLOW_METHODS</code></td>
<td><code>GET, POST, OPTIONS</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Allow-Methods header.</td>
</tr>
<tr>
<td><code>CORS_ALLOW_HEADERS</code></td>
<td><code>DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Allow-Headers header.</td>
</tr>
</tbody>
</table>
<h3 id="settings-client-cache">Client cache</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Manage caching for clients.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_CLIENT_CACHE</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Tell client to store locally static files.</td>
</tr>
<tr>
<td><code>CLIENT_CACHE_EXTENSIONS</code></td>
<td><code>jpg|jpeg|png|bmp|ico|svg|tif|css|js|otf|ttf|eot|woff|woff2</code></td>
<td>global</td>
<td>no</td>
<td>List of file extensions, separated with pipes that should be cached.</td>
</tr>
<tr>
<td><code>CLIENT_CACHE_ETAG</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Send the HTTP ETag header for static resources.</td>
</tr>
<tr>
<td><code>CLIENT_CACHE_CONTROL</code></td>
<td><code>public, max-age=15552000</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Cache-Control HTTP header.</td>
</tr>
</tbody>
</table>
<h3 id="settings-country">Country</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Deny access based on the country of the client IP.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BLACKLIST_COUNTRY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Deny access if the country of the client is in the list (2 letters code).</td>
</tr>
<tr>
<td><code>WHITELIST_COUNTRY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Deny access if the country of the client is not in the list (2 letters code).</td>
</tr>
</tbody>
</table>
<h3 id="settings-custom-https-certificate">Custom HTTPS certificate</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Choose custom certificate for HTTPS.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_CUSTOM_SSL</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use custom HTTPS certificate.</td>
</tr>
<tr>
<td><code>CUSTOM_SSL_CERT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Full path of the certificate or bundle file.</td>
</tr>
<tr>
<td><code>CUSTOM_SSL_KEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Full path of the key file.</td>
</tr>
</tbody>
</table>
<h3 id="settings-db">DB</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Integrate easily the Database.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DATABASE_URI</code></td>
<td><code>sqlite:////var/lib/bunkerweb/db.sqlite3</code></td>
<td>global</td>
<td>no</td>
<td>The database URI, following the sqlalchemy format.</td>
</tr>
</tbody>
</table>
<h3 id="settings-dnsbl">DNSBL</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Deny access based on external DNSBL servers.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_DNSBL</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate DNSBL feature.</td>
</tr>
<tr>
<td><code>DNSBL_LIST</code></td>
<td><code>bl.blocklist.de problems.dnsbl.sorbs.net sbl.spamhaus.org xbl.spamhaus.org</code></td>
<td>global</td>
<td>no</td>
<td>List of DNSBL servers.</td>
</tr>
</tbody>
</table>
<h3 id="settings-errors">Errors</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Manage default error pages</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ERRORS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of HTTP error code and corresponding error pages, separated with spaces (404=/my404.html 403=/errors/403.html ...).</td>
</tr>
<tr>
<td><code>INTERCEPTED_ERROR_CODES</code></td>
<td><code>400 401 403 404 405 413 429 500 501 502 503 504</code></td>
<td>multisite</td>
<td>no</td>
<td>List of HTTP error code intercepted by Bunkerweb</td>
</tr>
</tbody>
</table>
<h3 id="settings-greylist">Greylist</h3>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Allow access while keeping security features based on internal and external IP/network/rDNS/ASN greylists.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_GREYLIST</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate greylist feature.</td>
</tr>
<tr>
<td><code>GREYLIST_IP</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of IP/network, separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_IP_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing good IP/network to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_RDNS_GLOBAL</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Only perform RDNS greylist checks on global IP addresses.</td>
</tr>
<tr>
<td><code>GREYLIST_RDNS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of reverse DNS suffixes, separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_RDNS_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing reverse DNS suffixes to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_ASN</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of ASN numbers, separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_ASN_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing ASN to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_USER_AGENT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of User-Agent, separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_USER_AGENT_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing good User-Agent to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_URI</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URI, separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_URI_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing bad URI to put into the greylist.</td>
</tr>
</tbody>
</table>
<h3 id="settings-gzip">Gzip</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Compress HTTP requests with the gzip algorithm.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_GZIP</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use gzip</td>
</tr>
<tr>
<td><code>GZIP_TYPES</code></td>
<td><code>application/atom+xml application/javascript application/json application/rss+xml application/vnd.ms-fontobject application/x-font-opentype application/x-font-truetype application/x-font-ttf application/x-javascript application/xhtml+xml application/xml font/eot font/opentype font/otf font/truetype image/svg+xml image/vnd.microsoft.icon image/x-icon image/x-win-bitmap text/css text/javascript text/plain text/xml</code></td>
<td>multisite</td>
<td>no</td>
<td>List of MIME types that will be compressed with gzip.</td>
</tr>
<tr>
<td><code>GZIP_MIN_LENGTH</code></td>
<td><code>1000</code></td>
<td>multisite</td>
<td>no</td>
<td>Minimum length for gzip compression.</td>
</tr>
<tr>
<td><code>GZIP_COMP_LEVEL</code></td>
<td><code>5</code></td>
<td>multisite</td>
<td>no</td>
<td>The compression level of the gzip algorithm.</td>
</tr>
</tbody>
</table>
<h3 id="settings-html-injection">HTML injection</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Inject custom HTML code before the </body> tag.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>INJECT_BODY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>The HTML code to inject.</td>
</tr>
</tbody>
</table>
<h3 id="settings-headers">Headers</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Manage HTTP headers sent to clients.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CUSTOM_HEADER</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Custom header to add (HeaderName: HeaderValue).</td>
</tr>
<tr>
<td><code>REMOVE_HEADERS</code></td>
<td><code>Server X-Powered-By X-AspNet-Version X-AspNetMvc-Version</code></td>
<td>multisite</td>
<td>no</td>
<td>Headers to remove (Header1 Header2 Header3 ...)</td>
</tr>
<tr>
<td><code>STRICT_TRANSPORT_SECURITY</code></td>
<td><code>max-age=31536000</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Strict-Transport-Security header.</td>
</tr>
<tr>
<td><code>COOKIE_FLAGS</code></td>
<td><code>* HttpOnly SameSite=Lax</code></td>
<td>multisite</td>
<td>yes</td>
<td>Cookie flags automatically added to all cookies (value accepted for nginx_cookie_flag_module).</td>
</tr>
<tr>
<td><code>COOKIE_AUTO_SECURE_FLAG</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Automatically add the Secure flag to all cookies.</td>
</tr>
<tr>
<td><code>CONTENT_SECURITY_POLICY</code></td>
<td><code>object-src 'none'; form-action 'self'; frame-ancestors 'self';</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Content-Security-Policy header.</td>
</tr>
<tr>
<td><code>REFERRER_POLICY</code></td>
<td><code>strict-origin-when-cross-origin</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Referrer-Policy header.</td>
</tr>
<tr>
<td><code>PERMISSIONS_POLICY</code></td>
<td><code>accelerometer=(), ambient-light-sensor=(), autoplay=(), battery=(), camera=(), cross-origin-isolated=(), display-capture=(), document-domain=(), encrypted-media=(), execution-while-not-rendered=(), execution-while-out-of-viewport=(), fullscreen=(), geolocation=(), gyroscope=(), hid=(), idle-detection=(), magnetometer=(), microphone=(), midi=(), navigation-override=(), payment=(), picture-in-picture=(), publickey-credentials-get=(), screen-wake-lock=(), serial=(), usb=(), web-share=(), xr-spatial-tracking=()</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Permissions-Policy header.</td>
</tr>
<tr>
<td><code>FEATURE_POLICY</code></td>
<td><code>accelerometer 'none'; ambient-light-sensor 'none'; autoplay 'none'; battery 'none'; camera 'none'; display-capture 'none'; document-domain 'none'; encrypted-media 'none'; execution-while-not-rendered 'none'; execution-while-out-of-viewport 'none'; fullscreen 'none'; geolocation 'none'; gyroscope 'none'; layout-animation 'none'; legacy-image-formats 'none'; magnetometer 'none'; microphone 'none'; midi 'none'; navigation-override 'none'; payment 'none'; picture-in-picture 'none'; publickey-credentials-get 'none'; speaker-selection 'none'; sync-xhr 'none'; unoptimized-images 'none'; unsized-media 'none'; usb 'none'; screen-wake-lock 'none'; web-share 'none'; xr-spatial-tracking 'none';</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Feature-Policy header.</td>
</tr>
<tr>
<td><code>X_FRAME_OPTIONS</code></td>
<td><code>SAMEORIGIN</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the X-Frame-Options header.</td>
</tr>
<tr>
<td><code>X_CONTENT_TYPE_OPTIONS</code></td>
<td><code>nosniff</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the X-Content-Type-Options header.</td>
</tr>
<tr>
<td><code>X_XSS_PROTECTION</code></td>
<td><code>1; mode=block</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the X-XSS-Protection header.</td>
</tr>
</tbody>
</table>
<h3 id="settings-lets-encrypt">Let's Encrypt</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Automatic creation, renewal and configuration of Let's Encrypt certificates.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AUTO_LETS_ENCRYPT</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate automatic Let's Encrypt mode.</td>
</tr>
<tr>
<td><code>EMAIL_LETS_ENCRYPT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Email used for Let's Encrypt notification and in certificate.</td>
</tr>
<tr>
<td><code>USE_LETS_ENCRYPT_STAGING</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use the staging environment for Let’s Encrypt certificate generation. Useful when you are testing your deployments to avoid being rate limited in the production environment.</td>
</tr>
</tbody>
</table>
<h3 id="settings-limit">Limit</h3>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Limit maximum number of requests and connections.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_LIMIT_REQ</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate limit requests feature.</td>
</tr>
<tr>
<td><code>LIMIT_REQ_URL</code></td>
<td><code>/</code></td>
<td>multisite</td>
<td>yes</td>
<td>URL where the limit request will be applied.</td>
</tr>
<tr>
<td><code>LIMIT_REQ_RATE</code></td>
<td><code>2r/s</code></td>
<td>multisite</td>
<td>yes</td>
<td>Rate to apply to the URL (s for second, m for minute, h for hour and d for day).</td>
</tr>
<tr>
<td><code>USE_LIMIT_CONN</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate limit connections feature.</td>
</tr>
<tr>
<td><code>LIMIT_CONN_MAX_HTTP1</code></td>
<td><code>10</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum number of connections per IP when using HTTP/1.X protocol.</td>
</tr>
<tr>
<td><code>LIMIT_CONN_MAX_HTTP2</code></td>
<td><code>100</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum number of streams per IP when using HTTP/2 protocol.</td>
</tr>
<tr>
<td><code>LIMIT_CONN_MAX_STREAM</code></td>
<td><code>10</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum number of connections per IP when using stream.</td>
</tr>
</tbody>
</table>
<h3 id="settings-miscellaneous">Miscellaneous</h3>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Miscellaneous settings.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DISABLE_DEFAULT_SERVER</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Close connection if the request vhost is unknown.</td>
</tr>
<tr>
<td><code>REDIRECT_HTTP_TO_HTTPS</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Redirect all HTTP request to HTTPS.</td>
</tr>
<tr>
<td><code>AUTO_REDIRECT_HTTP_TO_HTTPS</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Try to detect if HTTPS is used and activate HTTP to HTTPS redirection if that's the case.</td>
</tr>
<tr>
<td><code>ALLOWED_METHODS</code></td>
<td><code>GET|POST|HEAD</code></td>
<td>multisite</td>
<td>no</td>
<td>Allowed HTTP and WebDAV methods, separated with pipes to be sent by clients.</td>
</tr>
<tr>
<td><code>MAX_CLIENT_SIZE</code></td>
<td><code>10m</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum body size (0 for infinite).</td>
</tr>
<tr>
<td><code>SERVE_FILES</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Serve files from the local folder.</td>
</tr>
<tr>
<td><code>ROOT_FOLDER</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Root folder containing files to serve (/var/www/html/{server_name} if unset).</td>
</tr>
<tr>
<td><code>SSL_PROTOCOLS</code></td>
<td><code>TLSv1.2 TLSv1.3</code></td>
<td>multisite</td>
<td>no</td>
<td>The supported version of TLS. We recommend the default value TLSv1.2 TLSv1.3 for compatibility reasons.</td>
</tr>
<tr>
<td><code>HTTP2</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Support HTTP2 protocol when HTTPS is enabled.</td>
</tr>
<tr>
<td><code>LISTEN_HTTP</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Respond to (insecure) HTTP requests.</td>
</tr>
<tr>
<td><code>USE_OPEN_FILE_CACHE</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable open file cache feature</td>
</tr>
<tr>
<td><code>OPEN_FILE_CACHE</code></td>
<td><code>max=1000 inactive=20s</code></td>
<td>multisite</td>
<td>no</td>
<td>Open file cache directive</td>
</tr>
<tr>
<td><code>OPEN_FILE_CACHE_ERRORS</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable open file cache for errors</td>
</tr>
<tr>
<td><code>OPEN_FILE_CACHE_MIN_USES</code></td>
<td><code>2</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable open file cache minimum uses</td>
</tr>
<tr>
<td><code>OPEN_FILE_CACHE_VALID</code></td>
<td><code>30s</code></td>
<td>multisite</td>
<td>no</td>
<td>Open file cache valid time</td>
</tr>
<tr>
<td><code>EXTERNAL_PLUGIN_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of external plugins URLs (direct download to .zip file) to download and install (URLs are separated with space).</td>
</tr>
<tr>
<td><code>DENY_HTTP_STATUS</code></td>
<td><code>403</code></td>
<td>global</td>
<td>no</td>
<td>HTTP status code to send when the request is denied (403 or 444). When using 444, BunkerWeb will close the connection.</td>
</tr>
</tbody>
</table>
<h3 id="settings-modsecurity">ModSecurity</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Management of the ModSecurity WAF.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_MODSECURITY</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable ModSecurity WAF.</td>
</tr>
<tr>
<td><code>USE_MODSECURITY_CRS</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable OWASP Core Rule Set.</td>
</tr>
<tr>
<td><code>MODSECURITY_SEC_AUDIT_ENGINE</code></td>
<td><code>RelevantOnly</code></td>
<td>multisite</td>
<td>no</td>
<td>SecAuditEngine directive of ModSecurity.</td>
</tr>
<tr>
<td><code>MODSECURITY_SEC_RULE_ENGINE</code></td>
<td><code>On</code></td>
<td>multisite</td>
<td>no</td>
<td>SecRuleEngine directive of ModSecurity.</td>
</tr>
<tr>
<td><code>MODSECURITY_SEC_AUDIT_LOG_PARTS</code></td>
<td><code>ABCFHZ</code></td>
<td>multisite</td>
<td>no</td>
<td>SecAuditLogParts directive of ModSecurity.</td>
</tr>
</tbody>
</table>
<h3 id="settings-php">PHP</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Manage local or remote PHP-FPM.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>REMOTE_PHP</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Hostname of the remote PHP-FPM instance.</td>
</tr>
<tr>
<td><code>REMOTE_PHP_PATH</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Root folder containing files in the remote PHP-FPM instance.</td>
</tr>
<tr>
<td><code>LOCAL_PHP</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Path to the PHP-FPM socket file.</td>
</tr>
<tr>
<td><code>LOCAL_PHP_PATH</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Root folder containing files in the local PHP-FPM instance.</td>
</tr>
</tbody>
</table>
<h3 id="settings-real-ip">Real IP</h3>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Get real IP of clients when BunkerWeb is behind a reverse proxy / load balancer.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_REAL_IP</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Retrieve the real IP of client.</td>
</tr>
<tr>
<td><code>USE_PROXY_PROTOCOL</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable PROXY protocol communication.</td>
</tr>
<tr>
<td><code>REAL_IP_FROM</code></td>
<td><code>192.168.0.0/16 172.16.0.0/12 10.0.0.0/8</code></td>
<td>multisite</td>
<td>no</td>
<td>List of trusted IPs / networks, separated with spaces, where proxied requests come from.</td>
</tr>
<tr>
<td><code>REAL_IP_FROM_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs containing trusted IPs / networks, separated with spaces, where proxied requests come from.</td>
</tr>
<tr>
<td><code>REAL_IP_HEADER</code></td>
<td><code>X-Forwarded-For</code></td>
<td>multisite</td>
<td>no</td>
<td>HTTP header containing the real IP or special value proxy_protocol for PROXY protocol.</td>
</tr>
<tr>
<td><code>REAL_IP_RECURSIVE</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Perform a recursive search in the header container IP address.</td>
</tr>
</tbody>
</table>
<h3 id="settings-redirect">Redirect</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Manage HTTP redirects.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>REDIRECT_TO</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Redirect a whole site to another one.</td>
</tr>
<tr>
<td><code>REDIRECT_TO_REQUEST_URI</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Append the requested URI to the redirect address.</td>
</tr>
</tbody>
</table>
<h3 id="settings-redis">Redis</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Redis server configuration when using BunkerWeb in cluster mode.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_REDIS</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Activate Redis.</td>
</tr>
<tr>
<td><code>REDIS_HOST</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>Redis server IP or hostname.</td>
</tr>
<tr>
<td><code>REDIS_PORT</code></td>
<td><code>6379</code></td>
<td>global</td>
<td>no</td>
<td>Redis server port.</td>
</tr>
<tr>
<td><code>REDIS_DATABASE</code></td>
<td><code>0</code></td>
<td>global</td>
<td>no</td>
<td>Redis database number.</td>
</tr>
<tr>
<td><code>REDIS_SSL</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Use SSL/TLS connection with Redis server.</td>
</tr>
<tr>
<td><code>REDIS_TIMEOUT</code></td>
<td><code>1000</code></td>
<td>global</td>
<td>no</td>
<td>Redis server timeout (in ms) for connect, read and write.</td>
</tr>
<tr>
<td><code>REDIS_KEEPALIVE_IDLE</code></td>
<td><code>30000</code></td>
<td>global</td>
<td>no</td>
<td>Max idle time (in ms) before closing redis connection in the pool.</td>
</tr>
<tr>
<td><code>REDIS_KEEPALIVE_POOL</code></td>
<td><code>10</code></td>
<td>global</td>
<td>no</td>
<td>Max number of redis connection(s) kept in the pool.</td>
</tr>
</tbody>
</table>
<h3 id="settings-reverse-proxy">Reverse proxy</h3>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Manage reverse proxy configurations.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_REVERSE_PROXY</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate reverse proxy mode.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_INTERCEPT_ERRORS</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Intercept and rewrite errors.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_HOST</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Full URL of the proxied resource (proxy_pass).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_URL</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Location URL that will be proxied.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_WS</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>yes</td>
<td>Enable websocket on the proxied resource.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_HEADERS</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>List of HTTP headers to send to proxied resource separated with semicolons (values for proxy_set_header directive).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_HEADERS_CLIENT</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>List of HTTP headers to send to client separated with semicolons (values for add_header directive).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_BUFFERING</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>yes</td>
<td>Enable or disable buffering of responses from proxied resource.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_KEEPALIVE</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>yes</td>
<td>Enable or disable keepalive connections with the proxied resource.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_AUTH_REQUEST</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Enable authentication using an external provider (value of auth_request directive).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_AUTH_REQUEST_SIGNIN_URL</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Redirect clients to sign-in URL when using REVERSE_PROXY_AUTH_REQUEST (used when auth_request call returned 401).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_AUTH_REQUEST_SET</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>List of variables to set from the authentication provider, separated with semicolons (values of auth_request_set directives).</td>
</tr>
<tr>
<td><code>USE_PROXY_CACHE</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable or disable caching of the proxied resources.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_PATH_LEVELS</code></td>
<td><code>1:2</code></td>
<td>global</td>
<td>no</td>
<td>Hierarchy levels of the cache.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_PATH_ZONE_SIZE</code></td>
<td><code>10m</code></td>
<td>global</td>
<td>no</td>
<td>Maximum size of cached metadata when caching proxied resources.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_PATH_PARAMS</code></td>
<td><code>max_size=100m</code></td>
<td>global</td>
<td>no</td>
<td>Additional parameters to add to the proxy_cache directive.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_METHODS</code></td>
<td><code>GET HEAD</code></td>
<td>multisite</td>
<td>no</td>
<td>HTTP methods that should trigger a cache operation.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_MIN_USES</code></td>
<td><code>2</code></td>
<td>multisite</td>
<td>no</td>
<td>The minimum number of requests before a response is cached.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_KEY</code></td>
<td><code>$scheme$host$request_uri</code></td>
<td>multisite</td>
<td>no</td>
<td>The key used to uniquely identify a cached response.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_VALID</code></td>
<td><code>200=24h 301=1h 302=24h</code></td>
<td>multisite</td>
<td>no</td>
<td>Define the caching time depending on the HTTP status code (list of status=time), separated with spaces.</td>
</tr>
<tr>
<td><code>PROXY_NO_CACHE</code></td>
<td><code>$http_pragma $http_authorization</code></td>
<td>multisite</td>
<td>no</td>
<td>Conditions to disable caching of responses.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_BYPASS</code></td>
<td><code>0</code></td>
<td>multisite</td>
<td>no</td>
<td>Conditions to bypass caching of responses.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_CONNECT_TIMEOUT</code></td>
<td><code>60s</code></td>
<td>multisite</td>
<td>yes</td>
<td>Timeout when connecting to the proxied resource.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_READ_TIMEOUT</code></td>
<td><code>60s</code></td>
<td>multisite</td>
<td>yes</td>
<td>Timeout when reading from the proxied resource.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_SEND_TIMEOUT</code></td>
<td><code>60s</code></td>
<td>multisite</td>
<td>yes</td>
<td>Timeout when sending to the proxied resource.</td>
</tr>
</tbody>
</table>
<h3 id="settings-reverse-scan">Reverse scan</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Scan clients ports to detect proxies or servers.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_REVERSE_SCAN</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable scanning of clients ports and deny access if one is opened.</td>
</tr>
<tr>
<td><code>REVERSE_SCAN_PORTS</code></td>
<td><code>22 80 443 3128 8000 8080</code></td>
<td>multisite</td>
<td>no</td>
<td>List of port to scan when using reverse scan feature.</td>
</tr>
<tr>
<td><code>REVERSE_SCAN_TIMEOUT</code></td>
<td><code>500</code></td>
<td>multisite</td>
<td>no</td>
<td>Specify the maximum timeout (in ms) when scanning a port.</td>
</tr>
</tbody>
</table>
<h3 id="settings-self-signed-certificate">Self-signed certificate</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Generate self-signed certificate.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GENERATE_SELF_SIGNED_SSL</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Generate and use self-signed certificate.</td>
</tr>
<tr>
<td><code>SELF_SIGNED_SSL_EXPIRY</code></td>
<td><code>365</code></td>
<td>multisite</td>
<td>no</td>
<td>Self-signed certificate expiry in days.</td>
</tr>
<tr>
<td><code>SELF_SIGNED_SSL_SUBJ</code></td>
<td><code>/CN=www.example.com/</code></td>
<td>multisite</td>
<td>no</td>
<td>Self-signed certificate subject.</td>
</tr>
</tbody>
</table>
<h3 id="settings-sessions">Sessions</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Management of session used by other plugins.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SESSIONS_SECRET</code></td>
<td><code>random</code></td>
<td>global</td>
<td>no</td>
<td>Secret used to encrypt sessions variables for storing data related to challenges.</td>
</tr>
<tr>
<td><code>SESSIONS_NAME</code></td>
<td><code>random</code></td>
<td>global</td>
<td>no</td>
<td>Name of the cookie given to clients.</td>
</tr>
<tr>
<td><code>SESSIONS_IDLING_TIMEOUT</code></td>
<td><code>1800</code></td>
<td>global</td>
<td>no</td>
<td>Maximum time (in seconds) of inactivity before the session is invalidated.</td>
</tr>
<tr>
<td><code>SESSIONS_ROLLING_TIMEOUT</code></td>
<td><code>3600</code></td>
<td>global</td>
<td>no</td>
<td>Maximum time (in seconds) before a session must be renewed.</td>
</tr>
<tr>
<td><code>SESSIONS_ABSOLUTE_TIMEOUT</code></td>
<td><code>86400</code></td>
<td>global</td>
<td>no</td>
<td>Maximum time (in seconds) before a session is destroyed.</td>
</tr>
</tbody>
</table>
<h3 id="settings-ui">UI</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/274c.svg" title=":x:" /></p>
<p>Integrate easily the BunkerWeb UI.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_UI</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use UI</td>
</tr>
</tbody>
</table>
<h3 id="settings-whitelist">Whitelist</h3>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Allow access based on internal and external IP/network/rDNS/ASN whitelists.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_WHITELIST</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate whitelist feature.</td>
</tr>
<tr>
<td><code>WHITELIST_IP</code></td>
<td><code>20.191.45.212 40.88.21.235 40.76.173.151 40.76.163.7 20.185.79.47 52.142.26.175 20.185.79.15 52.142.24.149 40.76.162.208 40.76.163.23 40.76.162.191 40.76.162.247 54.208.102.37 107.21.1.8</code></td>
<td>multisite</td>
<td>no</td>
<td>List of IP/network, separated with spaces, to put into the whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_IP_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing good IP/network to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_RDNS_GLOBAL</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Only perform RDNS whitelist checks on global IP addresses.</td>
</tr>
<tr>
<td><code>WHITELIST_RDNS</code></td>
<td><code>.google.com .googlebot.com .yandex.ru .yandex.net .yandex.com .search.msn.com .baidu.com .baidu.jp .crawl.yahoo.net .fwd.linkedin.com .twitter.com .twttr.com .discord.com</code></td>
<td>multisite</td>
<td>no</td>
<td>List of reverse DNS suffixes, separated with spaces, to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_RDNS_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing reverse DNS suffixes to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_ASN</code></td>
<td><code>32934</code></td>
<td>multisite</td>
<td>no</td>
<td>List of ASN numbers, separated with spaces, to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_ASN_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing ASN to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_USER_AGENT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of User-Agent, separated with spaces, to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_USER_AGENT_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing good User-Agent to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_URI</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URI, separated with spaces, to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_URI_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing bad URI to whitelist.</td>
</tr>
</tbody>
</table></section><section class="print-page" id="web-ui"><h1 id="web-ui-web-ui">Web UI</h1>
<h2 id="web-ui-overview">Overview</h2>
<p align="center">
    <iframe style="display: block;" width="560" height="315" src="https://www.youtube-nocookie.com/embed/Ao20SfvQyr4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</p>

<p>The "Web UI" is a web application that helps you manage your BunkerWeb instance using a user-friendly interface instead of the command-line one.</p>
<h2 id="web-ui-features">Features</h2>
<ul>
<li>Start, stop, restart and reload your BunkerWeb instance</li>
<li>Add, edit and delete settings for your web applications</li>
<li>Add, edit and delete custom configurations for NGINX and ModSecurity</li>
<li>Install and uninstall external plugins</li>
<li>Explore the cached files</li>
<li>Monitor jobs execution</li>
<li>View the logs and search pattern</li>
</ul>
<h2 id="web-ui-installation">Installation</h2>
<p>Because the web UI is a web application, the recommended installation procedure is to use BunkerWeb in front of it as a reverse proxy.</p>
<div class="admonition warning">
<p class="admonition-title">Security considerations</p>
<p>The security of the web UI is really important. If someone manages to gain access to the application, not only he will be able to edit your configurations but he could execute some code in the context of BunkerWeb (with a custom configuration containing LUA code for example). We highly recommend you to follow minimal security best practices like :</p>
<ul>
<li>Choose a strong password for the login</li>
<li>Put the web UI under a "hard to guess" URI</li>
<li>Do not open the web UI on the Internet without any further restrictions</li>
<li>Apply settings listed in the <a href="#security-tuning">security tuning section</a> of the documentation</li>
</ul>
</div>
<div class="admonition info">
<p class="admonition-title">Multisite mode</p>
<p>The usage of the web UI implies enabling the <a href="#concepts-multisite-mode">multisite mode</a>.</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="1:7"><input checked="checked" id="web-ui-__tabbed_1_1" name="web-ui-__tabbed_1" type="radio" /><input id="web-ui-__tabbed_1_2" name="web-ui-__tabbed_1" type="radio" /><input id="web-ui-__tabbed_1_3" name="web-ui-__tabbed_1" type="radio" /><input id="web-ui-__tabbed_1_4" name="web-ui-__tabbed_1" type="radio" /><input id="web-ui-__tabbed_1_5" name="web-ui-__tabbed_1" type="radio" /><input id="web-ui-__tabbed_1_6" name="web-ui-__tabbed_1" type="radio" /><input id="web-ui-__tabbed_1_7" name="web-ui-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="web-ui-__tabbed_1_1">Docker</label><label for="web-ui-__tabbed_1_2">Docker autoconf</label><label for="web-ui-__tabbed_1_3">Swarm</label><label for="web-ui-__tabbed_1_4">Kubernetes</label><label for="web-ui-__tabbed_1_5">Linux</label><label for="web-ui-__tabbed_1_6">Ansible</label><label for="web-ui-__tabbed_1_7">Vagrant</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>The web UI can be deployed using a dedicated container which is available on <a href="https://hub.docker.com/r/bunkerity/bunkerweb-ui">Docker Hub</a> :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>bunkerity/bunkerweb-ui
</code></pre></div>
<p>Alternatively, you can also build it yourself :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb.git<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">cd</span><span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-bunkerweb-ui<span class="w"> </span>-f<span class="w"> </span>src/ui/Dockerfile<span class="w"> </span>.
</code></pre></div>
<p>The following environment variables are used to configure the web UI container :</p>
<ul>
<li><code>ADMIN_USERNAME</code> : username to access the web UI</li>
<li><code>ADMIN_PASSWORD</code> : password to access the web UI</li>
<li><code>ABSOLUTE_URI</code> : full URI of your web UI instance (like <code>http://www.example.com/foo/</code>)</li>
</ul>
<p>Accessing the web UI through BunkerWeb is a classical <a href="#quickstart-guide-protect-http-applications">reverse proxy setup</a>. We recommend you to connect BunkerWeb and web UI using a dedicated network (like <code>bw-universe</code> also used by the scheduler) so it won't be on the same network of your web services for obvious security reasons. Please note that the web UI container is listening on the <code>7000</code> port.</p>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>If you want another Database backend than MariaDB please refer to the docker-compose files in the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/misc/integrations">misc/integrations folder</a> of the repository.</p>
</div>
<p>Here is the docker-compose boilerplate that you can use (don't forget to edit the <code>changeme</code> data) :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80:8080</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443:8443</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME=www.example.com</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP=127.0.0.0/8 10.20.30.0/24</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DISABLE_DEFAULT_SERVER=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_CLIENT_CACHE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_GZIP=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com_USE_UI=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com_USE_REVERSE_PROXY=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com_REVERSE_PROXY_URL=/changeme/</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com_REVERSE_PROXY_HOST=http://bw-ui:7000</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com_REVERSE_PROXY_HEADERS=X-Script-Name /changeme</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com_INTERCEPTED_ERROR_CODES=400 404 405 413 429 500 501 502 503 504</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINERS=1</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:1.5.0-beta</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ADMIN_USERNAME=changeme</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ADMIN_PASSWORD=changeme</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the changeme user</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ABSOLUTE_URI=http://www.example.com/changeme/</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:10.10</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_RANDOM_ROOT_PASSWORD=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE=db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_USER=bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD=changeme</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The web UI can be deployed using a dedicated container which is available on <a href="https://hub.docker.com/r/bunkerity/bunkerweb-ui">Docker Hub</a> :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>bunkerity/bunkerweb-ui
</code></pre></div>
<p>Alternatively, you can also build it yourself :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb.git<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">cd</span><span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-bunkerweb-ui<span class="w"> </span>-f<span class="w"> </span>src/ui/Dockerfile<span class="w"> </span>.
</code></pre></div>
<p>The following environment variables are used to configure the web UI container :</p>
<ul>
<li><code>ADMIN_USERNAME</code> : username to access the web UI</li>
<li><code>ADMIN_PASSWORD</code> : password to access the web UI</li>
<li><code>ABSOLUTE_URI</code> : full URI of your web UI instance (like <code>http://www.example.com/foo/</code>)</li>
</ul>
<p>Accessing the web UI through BunkerWeb is a classical <a href="#quickstart-guide-protect-http-applications">reverse proxy setup</a>. We recommend you to connect BunkerWeb and web UI using a dedicated network (like <code>bw-universe</code> also used by the scheduler and autoconf) so it won't be on the same network of your web services for obvious security reasons. Please note that the web UI container is listening on the <code>7000</code> port.</p>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>If you want another Database backend than MariaDB please refer to the docker-compose files in the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/misc/integrations">misc/integrations folder</a> of the repository.</p>
</div>
<p>Here is the docker-compose boilerplate that you can use (don't forget to edit the <code>changeme</code> data) :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80:8080</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443:8443</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME=</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AUTOCONF_MODE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP=127.0.0.0/8 10.20.30.0/24</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:1.5.0-beta</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AUTOCONF_MODE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AUTOCONF_MODE=yes</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINERS=1</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:10.10</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_RANDOM_ROOT_PASSWORD=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE=db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_USER=bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD=changeme</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:1.5.0-beta</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">        </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-ui</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AUTOCONF_MODE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ADMIN_USERNAME=admin</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ADMIN_PASSWORD=changeme</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ABSOLUTE_URI=http://www.example.com/changeme/</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=www.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_UI=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/changeme/&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://bw-ui:7000&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HEADERS=X-Script-Name</span><span class="nv"> </span><span class="s">/changeme&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INTERCEPTED_ERROR_CODES=400</span><span class="nv"> </span><span class="s">404</span><span class="nv"> </span><span class="s">405</span><span class="nv"> </span><span class="s">413</span><span class="nv"> </span><span class="s">429</span><span class="nv"> </span><span class="s">500</span><span class="nv"> </span><span class="s">501</span><span class="nv"> </span><span class="s">502</span><span class="nv"> </span><span class="s">503</span><span class="nv"> </span><span class="s">504&quot;</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The web UI can be deployed using a dedicated container which is available on <a href="https://hub.docker.com/r/bunkerity/bunkerweb-ui">Docker Hub</a> :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>bunkerity/bunkerweb-ui
</code></pre></div>
<p>Alternatively, you can also build it yourself :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb.git<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">cd</span><span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-bunkerweb-ui<span class="w"> </span>-f<span class="w"> </span>src/ui/Dockerfile<span class="w"> </span>.
</code></pre></div>
<p>The following environment variables are used to configure the web UI container :</p>
<ul>
<li><code>ADMIN_USERNAME</code> : username to access the web UI</li>
<li><code>ADMIN_PASSWORD</code> : password to access the web UI</li>
<li><code>ABSOLUTE_URI</code> : full URI of your web UI instance (like <code>http://www.example.com/foo/</code>)</li>
</ul>
<p>Accessing the web UI through BunkerWeb is a classical <a href="#quickstart-guide-protect-http-applications">reverse proxy setup</a>. We recommend you to connect BunkerWeb and web UI using a dedicated network (like <code>bw-universe</code> also used by the scheduler and autoconf) so it won't be on the same network of your web services for obvious security reasons. Please note that the web UI container is listening on the <code>7000</code> port.</p>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>If you want another Database backend than MariaDB please refer to the stack files in the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/misc/integrations">misc/integrations folder</a> of the repository.</p>
</div>
<p>Here is the stack boilerplate that you can use (don't forget to edit the <code>changeme</code> data) :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME=</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SWARM_MODE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REDIS=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_HOST=bw-redis</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP=127.0.0.0/8 10.20.30.0/24</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">global</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE&quot;</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:1.5.0-beta</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SWARM_MODE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONFIGS=1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINERS=1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVICES=1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SWARM=1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TASKS=1</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">manager&quot;</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SWARM_MODE=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:10.10</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_RANDOM_ROOT_PASSWORD=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE=db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_USER=bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD=changeme</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:1.5.0-beta</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI=mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_HOST=tcp://bw-docker:2375</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ADMIN_USERNAME=changeme</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ADMIN_PASSWORD=changeme</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the changeme user</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ABSOLUTE_URI=http://www.example.com/changeme/</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=www.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_UI=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/changeme/&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://bw-ui:7000&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HEADERS=X-Script-Name</span><span class="nv"> </span><span class="s">/changeme&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_INTERCEPT_ERRORS=no&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;INTERCEPTED_ERROR_CODES=400</span><span class="nv"> </span><span class="s">404</span><span class="nv"> </span><span class="s">405</span><span class="nv"> </span><span class="s">413</span><span class="nv"> </span><span class="s">429</span><span class="nv"> </span><span class="s">500</span><span class="nv"> </span><span class="s">501</span><span class="nv"> </span><span class="s">502</span><span class="nv"> </span><span class="s">503</span><span class="nv"> </span><span class="s">504&quot;</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The web UI can be deployed using a dedicated container which is available on <a href="https://hub.docker.com/r/bunkerity/bunkerweb-ui">Docker Hub</a> as a standard <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a>.</p>
<p>The following environment variables are used to configure the web UI container :</p>
<ul>
<li><code>ADMIN_USERNAME</code> : username to access the web UI</li>
<li><code>ADMIN_PASSWORD</code> : password to access the web UI</li>
<li><code>ABSOLUTE_URI</code> : full URI of your web UI instance (like <code>http://www.example.com/foo/</code>)</li>
</ul>
<p>Accessing the web UI through BunkerWeb is a classical <a href="#quickstart-guide-protect-http-applications">reverse proxy setup</a>. Network segmentation between web UI and web services is not covered in this documentation. Please note that the web UI container is listening on the <code>7000</code> port.</p>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>If you want another Database backend than MariaDB please refer to the yaml files in the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/misc/integrations">misc/integrations folder</a> of the repository.</p>
</div>
<p>Here is the yaml boilerplate that you can use (don't forget to edit the <code>changeme</code> data) :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cr-bunkerweb</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;services&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pods&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;configmaps&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;networking.k8s.io&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;ingresses&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crb-bunkerweb</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">    </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cr-bunkerweb</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="c1"># mandatory annotation</span>
<span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bunkerweb.io/INSTANCE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.5.0-beta</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">            </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">101</span>
<span class="w">            </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">101</span>
<span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span>
<span class="w">              </span><span class="nt">drop</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">              </span><span class="nt">hostPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">              </span><span class="nt">hostPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="c1"># replace with your DNS resolvers</span>
<span class="w">            </span><span class="c1"># e.g. : kube-dns.kube-system.svc.cluster.local</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS_RESOLVERS</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;coredns.kube-system.svc.cluster.local&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_API</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="c1"># 10.0.0.0/8 is the cluster internal subnet</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.0.0.0/8&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REDIS</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_HOST</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;svc-bunkerweb-redis.default.svc.cluster.local&quot;</span>
<span class="w">          </span><span class="nt">livenessProbe</span><span class="p">:</span>
<span class="w">            </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">              </span><span class="nt">command</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/bunkerweb/helpers/healthcheck.sh</span>
<span class="w">            </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">            </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">            </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">          </span><span class="nt">readinessProbe</span><span class="p">:</span>
<span class="w">            </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">              </span><span class="nt">command</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/bunkerweb/helpers/healthcheck.sh</span>
<span class="w">            </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">            </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:1.5.0-beta</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DATABASE_URI&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@svc-bunkerweb-db:3306/db&quot;</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DATABASE_URI&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@svc-bunkerweb-db:3306/db&quot;</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:10.10</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_RANDOM_ROOT_PASSWORD</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MYSQL_DATABASE&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MYSQL_USER&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MYSQL_PASSWORD&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/var/lib/mysql&quot;</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-db</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-db</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pvc-bunkerweb</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-ui</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-ui</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-ui</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-ui</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:1.5.0-beta</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ADMIN_USERNAME</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ADMIN_PASSWORD&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ABSOLUTE_URI&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://www.example.com/changeme/&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;YES&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DATABASE_URI&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:testor@svc-bunkerweb-db:3306/db&quot;</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb-db</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb-redis</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb-ui</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-ui</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7000</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7000</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pvc-bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5Gi</span>
<span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pv-bunkerweb</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/www.example.com_USE_UI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">bunkerweb.io/www.example.com_REVERSE_PROXY_HEADERS_1</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Script-Name</span><span class="nv"> </span><span class="s">/changeme&quot;</span>
<span class="w">    </span><span class="nt">bunkerweb.io/www.example.com_REVERSE_PROXY_INTERCEPT_ERRORS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/changeme/</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb-ui</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7000</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The installation of the web UI using the <a href="#integrations-linux">Linux integration</a> is pretty straightforward because it is installed with BunkerWeb.</p>
<p>The web UI comes as systemd service named <code>bunkerweb-ui</code> which is not enabled by default. If you want to start the web UI when on startup you can run the following command :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>bunkerweb
</code></pre></div>
<p>A dedicated environment file located at <code>/etc/bunkerweb/ui.env</code> is used to configure the web UI :</p>
<div class="highlight"><pre><span></span><code>ADMIN_USERNAME=changeme
ADMIN_PASSWORD=changeme
ABSOLUTE_URI=http://www.example.com/changeme/
</code></pre></div>
<p>Each time you edit the <code>/etc/bunkerweb/ui.env</code> file, you will need to restart the service :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb-ui
</code></pre></div>
<p>Accessing the web UI through BunkerWeb is a classical <a href="#quickstart-guide-protect-http-applications">reverse proxy setup</a>. Please note that the web UI is listening on the <code>7000</code> port and only on the loopback interface.</p>
<p>Here is the <code>/etc/bunkerweb/variables.env</code> boilerplate you can use :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=8.8.8.8 8.8.4.4
SERVER_NAME=www.example.com
MULTISITE=yes
www.example.com_USE_UI=yes
www.example.com_USE_REVERSE_PROXY=yes
www.example.com_REVERSE_PROXY_URL=/changeme/
www.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:7000
www.example.com_REVERSE_PROXY_HEADERS=X-Script-Name /changeme
www.example.com_INTERCEPTED_ERROR_CODES=400 404 405 413 429 500 501 502 503 504
</code></pre></div>
<p>Don't forget to restart the <code>bunkerweb</code> service :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The installation of the web UI using the <a href="#integrations-linux">Vagrant integration</a> is pretty straightforward because it is installed with BunkerWeb.</p>
<p>Create a <code>my_ui.env</code> filed used to configure the web UI :</p>
<div class="highlight"><pre><span></span><code>ADMIN_USERNAME=changeme
ADMIN_PASSWORD=changeme
ABSOLUTE_URI=http://www.example.com/changeme/
</code></pre></div>
<p>Here is the <code>my_variables.env</code> boilerplate you can use :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=8.8.8.8 8.8.4.4
SERVER_NAME=www.example.com
MULTISITE=yes
www.example.com_USE_UI=yes
www.example.com_USE_REVERSE_PROXY=yes
www.example.com_REVERSE_PROXY_URL=/changeme/
www.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:7000
www.example.com_REVERSE_PROXY_HEADERS=X-Script-Name /changeme
www.example.com_INTERCEPTED_ERROR_CODES=400 404 405 413 429 500 501 502 503 504
</code></pre></div>
<p>The variable <code>enable_ui</code> can be set to <code>true</code> in order to activate the web UI service and the variable <code>custom_ui</code> can be used to specify the configuration file for the web UI :</p>
<div class="highlight"><pre><span></span><code><span class="k">[mybunkers]</span>
<span class="na">192.168.0.42 variables_env</span><span class="o">=</span><span class="s">&quot;{{ playbook_dir }}/my_variables.env&quot; enable_ui=true custom_ui=&quot;{{ playbook_dir }}/my_ui.env&quot;</span>
</code></pre></div>
<p>Or alternatively, in your playbook file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">variables_env</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/my_variables.env&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">enable_ui</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">custom_ui</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/my_ui.env&quot;</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity.bunkerweb</span>
</code></pre></div>
<p>You can now run the playbook and be able to access the web UI :</p>
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>playbook.yml
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The installation of the web UI using the <a href="#integrations-vagrant">Vagrant integration</a> is pretty straightforward because it is installed with BunkerWeb.</p>
<p>First of all, you will need to get a shell on your Vagrant box :</p>
<div class="highlight"><pre><span></span><code>vagrant<span class="w"> </span>ssh
</code></pre></div>
<p>The web UI comes as systemd service named <code>bunkerweb-ui</code> which is not enabled by default. If you want to start the web UI when on startup you can run the following command :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>bunkerweb
</code></pre></div>
<p>A dedicated environment file located at <code>/etc/bunkerweb/ui.env</code> is used to configure the web UI :</p>
<div class="highlight"><pre><span></span><code>ADMIN_USERNAME=changeme
ADMIN_PASSWORD=changeme
ABSOLUTE_URI=http://www.example.com/changeme/
</code></pre></div>
<p>Each time you edit the <code>/etc/bunkerweb/ui.env</code> file, you will need to restart the service :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb-ui
</code></pre></div>
<p>Accessing the web UI through BunkerWeb is a classical <a href="#quickstart-guide-protect-http-applications">reverse proxy setup</a>. Please note that the web UI is listening on the <code>7000</code> port and only on the loopback interface.</p>
<p>Here is the <code>/etc/bunkerweb/variables.env</code> boilerplate you can use :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=8.8.8.8 8.8.4.4
SERVER_NAME=www.example.com
MULTISITE=yes
www.example.com_USE_UI=yes
www.example.com_USE_REVERSE_PROXY=yes
www.example.com_REVERSE_PROXY_URL=/changeme/
www.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:7000
www.example.com_REVERSE_PROXY_HEADERS=X-Script-Name /changeme
www.example.com_INTERCEPTED_ERROR_CODES=400 404 405 413 429 500 501 502 503 504
</code></pre></div>
<p>Don't forget to restart the <code>bunkerweb</code> service :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
</div>
</div></section><section class="print-page" id="troubleshooting"><h1 id="troubleshooting-troubleshooting">Troubleshooting</h1>
<h2 id="troubleshooting-logs">Logs</h2>
<p>When troubleshooting, logs are your best friends. We try our best to provide user-friendly logs to help you understand what's happening.</p>
<p>Please note that you can set <code>LOG_LEVEL</code> setting to <code>info</code> (default : <code>notice</code>) to increase the verbosity of BunkerWeb.</p>
<p>Here is how you can access the logs, depending on your integration :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:7"><input checked="checked" id="troubleshooting-__tabbed_1_1" name="troubleshooting-__tabbed_1" type="radio" /><input id="troubleshooting-__tabbed_1_2" name="troubleshooting-__tabbed_1" type="radio" /><input id="troubleshooting-__tabbed_1_3" name="troubleshooting-__tabbed_1" type="radio" /><input id="troubleshooting-__tabbed_1_4" name="troubleshooting-__tabbed_1" type="radio" /><input id="troubleshooting-__tabbed_1_5" name="troubleshooting-__tabbed_1" type="radio" /><input id="troubleshooting-__tabbed_1_6" name="troubleshooting-__tabbed_1" type="radio" /><input id="troubleshooting-__tabbed_1_7" name="troubleshooting-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="troubleshooting-__tabbed_1_1">Docker</label><label for="troubleshooting-__tabbed_1_2">Docker autoconf</label><label for="troubleshooting-__tabbed_1_3">Swarm</label><label for="troubleshooting-__tabbed_1_4">Kubernetes</label><label for="troubleshooting-__tabbed_1_5">Linux</label><label for="troubleshooting-__tabbed_1_6">Ansible</label><label for="troubleshooting-__tabbed_1_7">Vagrant</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="admonition tip">
<p class="admonition-title">List containers</p>
<p>To list the running containers, you can use the following command :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>ps
</code></pre></div></p>
</div>
<p>You can use the <code>docker logs</code> command (replace <code>mybunker</code> with the name of your container) :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>logs<span class="w"> </span>mybunker
</code></pre></div></p>
<p>Here is the docker-compose equivalent (replace <code>mybunker</code> with the name of the services declared in the docker-compose.yml file) :
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>logs<span class="w"> </span>mybunker
</code></pre></div></p>
</div>
<div class="tabbed-block">
<div class="admonition tip">
<p class="admonition-title">List containers</p>
<p>To list the running containers, you can use the following command :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>ps
</code></pre></div></p>
</div>
<p>You can use the <code>docker logs</code> command (replace <code>mybunker</code> and <code>myautoconf</code> with the name of your containers) :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>logs<span class="w"> </span>mybunker
docker<span class="w"> </span>logs<span class="w"> </span>myautoconf
</code></pre></div></p>
<p>Here is the docker-compose equivalent (replace <code>mybunker</code> and <code>myautoconf</code> with the name of the services declared in the docker-compose.yml file) :
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>logs<span class="w"> </span>mybunker
docker-compose<span class="w"> </span>logs<span class="w"> </span>myautoconf
</code></pre></div></p>
</div>
<div class="tabbed-block">
<div class="admonition tip">
<p class="admonition-title">List services</p>
<p>To list the services, you can use the following command :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>service<span class="w"> </span>ls
</code></pre></div></p>
</div>
<p>You can use the <code>docker service logs</code> command (replace <code>mybunker</code> and <code>myautoconf</code> with the name of your services) :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>service<span class="w"> </span>logs<span class="w"> </span>mybunker
docker<span class="w"> </span>service<span class="w"> </span>logs<span class="w"> </span>myautoconf
</code></pre></div></p>
</div>
<div class="tabbed-block">
<div class="admonition tip">
<p class="admonition-title">List pods</p>
<p>To list the pods, you can use the following command :
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods
</code></pre></div></p>
</div>
<p>You can use the <code>kubectl logs</code> command (replace <code>mybunker</code> and <code>myautoconf</code> with the name of your pods) :
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>logs<span class="w"> </span>mybunker
kubectl<span class="w"> </span>logs<span class="w"> </span>myautoconf
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>For errors related to BunkerWeb services (e.g. not starting), you can use <code>journalctl</code> :
<div class="highlight"><pre><span></span><code>journalctl<span class="w"> </span>-u<span class="w"> </span>bunkerweb<span class="w"> </span>--no-pager
</code></pre></div></p>
<p>Common logs are located inside the <code>/var/log/nginx</code> directory :
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/var/log/nginx/error.log
cat<span class="w"> </span>/var/log/nginx/access.log
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>For errors related to BunkerWeb services (e.g. not starting), you can use <code>journalctl</code> :
<div class="highlight"><pre><span></span><code>ansible<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>all<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;journalctl -u bunkerweb --no-pager&quot;</span><span class="w"> </span>--become
</code></pre></div></p>
<p>Common logs are located inside the <code>/var/log/nginx</code> directory :
<div class="highlight"><pre><span></span><code>ansible<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>all<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;cat /var/log/nginx/error.log&quot;</span><span class="w"> </span>--become
ansible<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>all<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;cat /var/log/nginx/access.log&quot;</span><span class="w"> </span>--become
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>For errors related to BunkerWeb services (e.g. not starting), you can use <code>journalctl</code> :
<div class="highlight"><pre><span></span><code>journalctl<span class="w"> </span>-u<span class="w"> </span>bunkerweb<span class="w"> </span>--no-pager
</code></pre></div></p>
<p>Common logs are located inside the <code>/var/log/nginx</code> directory :
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/var/log/nginx/error.log
cat<span class="w"> </span>/var/log/nginx/access.log
</code></pre></div></p>
</div>
</div>
</div>
<h2 id="troubleshooting-permissions">Permissions</h2>
<p>Don't forget that BunkerWeb runs as an unprivileged user for obvious security reasons. Double-check the permissions of files and folders used by BunkerWeb, especially if you use custom configurations (more info <a href="#quickstart-guide-custom-configurations">here</a>). You will need to set at least <strong>RW</strong> rights on files and <strong><em>RWX</em></strong> on folders.</p>
<h2 id="troubleshooting-modsecurity">ModSecurity</h2>
<p>The default BunkerWeb configuration of ModSecurity is to load the Core Rule Set in anomaly scoring mode with a paranoia level (PL) of 1 :</p>
<ul>
<li>Each matched rule will increase an anomaly score (so many rules can match a single request)</li>
<li>PL1 includes rules with fewer chances of false positives (but less security than PL4)</li>
<li>the default threshold for anomaly score is 5 for requests and 4 for responses</li>
</ul>
<p>Let's take the following logs as an example of ModSecurity detection using default configuration (formatted for better readability) :</p>
<div class="highlight"><pre><span></span><code>2022/04/26 12:01:10 [warn] 85#85: *11 ModSecurity: Warning. Matched &quot;Operator `PmFromFile&#39; with parameter `lfi-os-files.data&#39; against variable `ARGS:id&#39; (Value: `/etc/passwd&#39; )
    [file &quot;/usr/share/bunkerweb/core/modsecurity/files/coreruleset/rules/REQUEST-930-APPLICATION-ATTACK-LFI.conf&quot;]
    [line &quot;78&quot;]
    [id &quot;930120&quot;]
    [rev &quot;&quot;]
    [msg &quot;OS File Access Attempt&quot;]
    [data &quot;Matched Data: etc/passwd found within ARGS:id: /etc/passwd&quot;]
    [severity &quot;2&quot;]
    [ver &quot;OWASP_CRS/3.3.2&quot;]
    [maturity &quot;0&quot;]
    [accuracy &quot;0&quot;]
    [tag &quot;application-multi&quot;]
    [tag &quot;language-multi&quot;]
    [tag &quot;platform-multi&quot;]
    [tag &quot;attack-lfi&quot;]
    [tag &quot;paranoia-level/1&quot;]
    [tag &quot;OWASP_CRS&quot;]
    [tag &quot;capec/1000/255/153/126&quot;]
    [tag &quot;PCI/6.5.4&quot;]
    [hostname &quot;172.17.0.2&quot;]
    [uri &quot;/&quot;]
    [unique_id &quot;165097447014.179282&quot;]
    [ref &quot;o1,10v9,11t:utf8toUnicode,t:urlDecodeUni,t:normalizePathWin,t:lowercase&quot;],
    client: 172.17.0.1, server: localhost, request: &quot;GET /?id=/etc/passwd HTTP/1.1&quot;, host: &quot;localhost&quot;
2022/04/26 12:01:10 [warn] 85#85: *11 ModSecurity: Warning. Matched &quot;Operator `PmFromFile&#39; with parameter `unix-shell.data&#39; against variable `ARGS:id&#39; (Value: `/etc/passwd&#39; )
    [file &quot;/usr/share/bunkerweb/core/modsecurity/files/coreruleset/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf&quot;]
    [line &quot;480&quot;]
    [id &quot;932160&quot;]
    [rev &quot;&quot;]
    [msg &quot;Remote Command Execution: Unix Shell Code Found&quot;]
    [data &quot;Matched Data: etc/passwd found within ARGS:id: /etc/passwd&quot;]
    [severity &quot;2&quot;]
    [ver &quot;OWASP_CRS/3.3.2&quot;]
    [maturity &quot;0&quot;]
    [accuracy &quot;0&quot;]
    [tag &quot;application-multi&quot;]
    [tag &quot;language-shell&quot;]
    [tag &quot;platform-unix&quot;]
    [tag &quot;attack-rce&quot;]
    [tag &quot;paranoia-level/1&quot;]
    [tag &quot;OWASP_CRS&quot;]
    [tag &quot;capec/1000/152/248/88&quot;]
    [tag &quot;PCI/6.5.2&quot;]
    [hostname &quot;172.17.0.2&quot;]
    [uri &quot;/&quot;]
    [unique_id &quot;165097447014.179282&quot;]
    [ref &quot;o1,10v9,11t:urlDecodeUni,t:cmdLine,t:normalizePath,t:lowercase&quot;],
    client: 172.17.0.1, server: localhost, request: &quot;GET /?id=/etc/passwd HTTP/1.1&quot;, host: &quot;localhost&quot;
2022/04/26 12:01:10 [error] 85#85: *11 [client 172.17.0.1] ModSecurity: Access denied with code 403 (phase 2). Matched &quot;Operator `Ge&#39; with parameter `5&#39; against variable `TX:ANOMALY_SCORE&#39; (Value: `10&#39; )
    [file &quot;/usr/share/bunkerweb/core/modsecurity/files/coreruleset/rules/REQUEST-949-BLOCKING-EVALUATION.conf&quot;]
    [line &quot;80&quot;]
    [id &quot;949110&quot;]
    [rev &quot;&quot;]
    [msg &quot;Inbound Anomaly Score Exceeded (Total Score: 10)&quot;]
    [data &quot;&quot;]
    [severity &quot;2&quot;]
    [ver &quot;OWASP_CRS/3.3.2&quot;]
    [maturity &quot;0&quot;]
    [accuracy &quot;0&quot;]
    [tag &quot;application-multi&quot;]
    [tag &quot;language-multi&quot;]
    [tag &quot;platform-multi&quot;]
    [tag &quot;attack-generic&quot;]
    [hostname &quot;172.17.0.2&quot;]
    [uri &quot;/&quot;]
    [unique_id &quot;165097447014.179282&quot;]
    [ref &quot;&quot;],
    client: 172.17.0.1, server: localhost, request: &quot;GET /?id=/etc/passwd HTTP/1.1&quot;, host: &quot;localhost&quot;
</code></pre></div>
<p>As we can see, there are 3 different logs :</p>
<ol>
<li>Rule <strong>930120</strong> matched</li>
<li>Rule <strong>932160</strong> matched</li>
<li>Access denied (rule <strong>949110</strong>)</li>
</ol>
<p>One important thing to understand is that rule <strong>949110</strong> is not a "real" one : it's the one that will deny the request because the anomaly threshold is reached (which is <strong>10</strong> in this example). You should never remove the <strong>949110</strong> rule !</p>
<p>If it's a false-positive, you should then focus on both <strong>930120</strong> and <strong>932160</strong> rules. ModSecurity and/or CRS tuning is out of the scope of this documentation but don't forget that you can apply custom configurations before and after the CRS is loaded (more info <a href="#quickstart-guide-custom-configurations">here</a>).</p>
<h2 id="troubleshooting-bad-behavior">Bad Behavior</h2>
<p>A common false-positive case is when the client is banned because of the "bad behavior" feature which means that too many suspicious HTTP status codes were generated within a time period (more info <a href="#security-tuning-bad-behavior">here</a>). You should start by reviewing the settings and then edit them according to your web application(s) like removing a suspicious HTTP code, decreasing the count time, increasing the threshold, ...</p>
<h2 id="troubleshooting-ip-unban">IP unban</h2>
<p>You can manually unban an IP which can be useful when doing some tests but it needs the setting <code>USE_API</code> set to <code>yes</code> (which is not the default) so you can contact the internal API of BunkerWeb (replace <code>1.2.3.4</code> with the IP address to unban) :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:7"><input checked="checked" id="troubleshooting-__tabbed_2_1" name="troubleshooting-__tabbed_2" type="radio" /><input id="troubleshooting-__tabbed_2_2" name="troubleshooting-__tabbed_2" type="radio" /><input id="troubleshooting-__tabbed_2_3" name="troubleshooting-__tabbed_2" type="radio" /><input id="troubleshooting-__tabbed_2_4" name="troubleshooting-__tabbed_2" type="radio" /><input id="troubleshooting-__tabbed_2_5" name="troubleshooting-__tabbed_2" type="radio" /><input id="troubleshooting-__tabbed_2_6" name="troubleshooting-__tabbed_2" type="radio" /><input id="troubleshooting-__tabbed_2_7" name="troubleshooting-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="troubleshooting-__tabbed_2_1">Docker</label><label for="troubleshooting-__tabbed_2_2">Docker autoconf</label><label for="troubleshooting-__tabbed_2_3">Swarm</label><label for="troubleshooting-__tabbed_2_4">Kubernetes</label><label for="troubleshooting-__tabbed_2_5">Linux</label><label for="troubleshooting-__tabbed_2_6">Ansible</label><label for="troubleshooting-__tabbed_2_7">Vagrant</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>You can use the <code>docker exec</code> command (replace <code>mybunker</code> with the name of your container) :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>mybunker<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
<p>Here is the docker-compose equivalent (replace <code>mybunker</code> with the name of the services declared in the docker-compose.yml file) :
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>mybunker<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>You can use the <code>docker exec</code> command (replace <code>myautoconf</code> with the name of your container) :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>myautoconf<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
<p>Here is the docker-compose equivalent (replace <code>myautoconf</code> with the name of the services declared in the docker-compose.yml file) :
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>myautoconf<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>You can use the <code>docker exec</code> command (replace <code>myautoconf</code> with the name of your service) :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span><span class="nv">name</span><span class="o">=</span>myautoconf<span class="k">)</span><span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>You can use the <code>kubectl exec</code> command (replace <code>myautoconf</code> with the name of your pod) :
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>myautoconf<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>You can use the <code>bwcli</code> command (as root) :
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>You can use the <code>bwcli</code> command :
<div class="highlight"><pre><span></span><code>ansible<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>all<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;bwcli unban 1.2.3.4&quot;</span><span class="w"> </span>--become
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>You can use the <code>bwcli</code> command (as root) :
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
</div>
</div>
</div>
<h2 id="troubleshooting-whitelisting">Whitelisting</h2>
<p>If you have bots that need to access your website, the recommended way to avoid any false positive is to whitelist them using the <a href="#security-tuning-blacklisting-and-whitelisting">whitelisting feature</a>. We don't recommend using the <code>WHITELIST_URI*</code> or <code>WHITELIST_USER_AGENT*</code> settings unless they are set to secret and unpredictable values. Common use cases are :</p>
<ul>
<li>Healthcheck / status bot</li>
<li>Callback like IPN or webhook</li>
<li>Social media crawler</li>
</ul></section><section class="print-page" id="plugins"><h1 id="plugins-plugins">Plugins</h1>
<p>BunkerWeb comes with a plugin system making it possible to easily add new features. Once a plugin is installed, you can manage it using additional settings defined by the plugin.</p>
<h2 id="plugins-official-plugins">Official plugins</h2>
<p>Here is the list of "official" plugins that we maintain (see the <a href="https://github.com/bunkerity/bunkerweb-plugins">bunkerweb-plugins</a> repository for more information) :</p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th align="center">Version</th>
<th align="left">Description</th>
<th align="center">Link</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>ClamAV</strong></td>
<td align="center">0.1</td>
<td align="left">Automatically scans uploaded files with the ClamAV antivirus engine and denies the request when a file is detected as malicious.</td>
<td align="center"><a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/clamav">bunkerweb-plugins/clamav</a></td>
</tr>
<tr>
<td align="center"><strong>CrowdSec</strong></td>
<td align="center">0.1</td>
<td align="left">CrowdSec bouncer for BunkerWeb.</td>
<td align="center"><a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/crowdsec">bunkerweb-plugins/crowdsec</a></td>
</tr>
<tr>
<td align="center"><strong>Discord</strong></td>
<td align="center">0.1</td>
<td align="left">Send security notifications to a Discord channel using a Webhook.</td>
<td align="center"><a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/discord">bunkerweb-plugins/discord</a></td>
</tr>
<tr>
<td align="center"><strong>Slack</strong></td>
<td align="center">0.1</td>
<td align="left">Send security notifications to a Slack channel using a Webhook.</td>
<td align="center"><a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/slack">bunkerweb-plugins/slack</a></td>
</tr>
<tr>
<td align="center"><strong>VirusTotal</strong></td>
<td align="center">0.1</td>
<td align="left">Automatically scans uploaded files with the VirusTotal API and denies the request when a file is detected as malicious.</td>
<td align="center"><a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/virustotal">bunkerweb-plugins/virustotal</a></td>
</tr>
</tbody>
</table>
<h2 id="plugins-how-to-use-a-plugin">How to use a plugin</h2>
<h3 id="plugins-automatic">Automatic</h3>
<p>If you want to quickly install external plugins, you can use the <code>EXTERNAL_PLUGIN_URLS</code> setting. It takes a list of URLs, separated with space, pointing to compressed (zip format) archive containing one or more plugin(s).</p>
<p>You can use the following value if you want to automatically install the official plugins : <code>EXTERNAL_PLUGIN_URLS=https://github.com/bunkerity/bunkerweb-plugins/archive/refs/tags/v0.2.zip</code></p>
<h3 id="plugins-manual">Manual</h3>
<p>The first step is to install the plugin by putting the plugin files inside the corresponding <code>plugins</code> data folder, the procedure depends on your integration :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:7"><input checked="checked" id="plugins-__tabbed_1_1" name="plugins-__tabbed_1" type="radio" /><input id="plugins-__tabbed_1_2" name="plugins-__tabbed_1" type="radio" /><input id="plugins-__tabbed_1_3" name="plugins-__tabbed_1" type="radio" /><input id="plugins-__tabbed_1_4" name="plugins-__tabbed_1" type="radio" /><input id="plugins-__tabbed_1_5" name="plugins-__tabbed_1" type="radio" /><input id="plugins-__tabbed_1_6" name="plugins-__tabbed_1" type="radio" /><input id="plugins-__tabbed_1_7" name="plugins-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="plugins-__tabbed_1_1">Docker</label><label for="plugins-__tabbed_1_2">Docker autoconf</label><label for="plugins-__tabbed_1_3">Swarm</label><label for="plugins-__tabbed_1_4">Kubernetes</label><label for="plugins-__tabbed_1_5">Linux</label><label for="plugins-__tabbed_1_6">Ansible</label><label for="plugins-__tabbed_1_7">Vagrant</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>When using the <a href="#plugins-1.5.0-beta-integrations-docker">Docker integration</a>, plugins must be written to the volume mounted on <code>/data/plugins</code> into the scheduler container.</p>
<p>The first thing to do is to create the plugins folder :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>./bw-data/plugins
</code></pre></div>
<p>Then, you can drop the plugins of your choice into that folder :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb-plugins<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
cp<span class="w"> </span>-rp<span class="w"> </span>./bunkerweb-plugins/*<span class="w"> </span>./bw-data/plugins
</code></pre></div>
<p>Because the scheduler runs as an unprivileged user with UID and GID 101, you will need to edit the permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">101</span>:101<span class="w"> </span>./bw-data
</code></pre></div>
<p>Then you can mount the volume when starting your Docker stack :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./bw-data:/data</span>
<span class="nn">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#plugins-1.5.0-beta-integrations-docker-autoconf">Docker autoconf integration</a>, plugins must be written to the volume mounted on <code>/data/plugins</code> into the scheduler container.</p>
<p>The first thing to do is to create the plugins folder :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>./bw-data/plugins
</code></pre></div>
<p>Then, you can drop the plugins of your choice into that folder :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb-plugins<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
cp<span class="w"> </span>-rp<span class="w"> </span>./bunkerweb-plugins/*<span class="w"> </span>./bw-data/plugins
</code></pre></div>
<p>Because the scheduler runs as an unprivileged user with UID and GID 101, you will need to edit the permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">101</span>:101<span class="w"> </span>./bw-data
</code></pre></div>
<p>Then you can mount the volume when starting your Docker stack :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./bw-data:/data</span>
<span class="nn">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#plugins-1.5.0-beta-integrations-swarm">Swarm integration</a>, plugins must be written to the volume mounted on <code>/data/plugins</code> into the scheduler container.</p>
<div class="admonition info">
<p class="admonition-title">Swarm volume</p>
<p>Configuring a Swarm volume that will persist when the scheduler service is running on different nodes is not covered is in this documentation. We will assume that you have a shared folder mounted on <code>/shared</code> accross all nodes.</p>
</div>
<p>The first thing to do is to create the plugins folder :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>/shared/bw-plugins
</code></pre></div>
<p>Then, you can drop the plugins of your choice into that folder :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb-plugins<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
cp<span class="w"> </span>-rp<span class="w"> </span>./bunkerweb-plugins/*<span class="w"> </span>/shared/bw-plugins
</code></pre></div>
<p>Because the scheduler runs as an unprivileged user with UID and GID 101, you will need to edit the permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">101</span>:101<span class="w"> </span>/shared/bw-plugins
</code></pre></div>
<p>Then you can mount the volume when starting your Swarm stack :</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/shared/bw-plugins:/data/plugins</span>
<span class="nn">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#plugins-1.5.0-beta-integrations-kubernetes">Kubernetes integration</a>, plugins must be written to the volume mounted on <code>/data/plugins</code> into the scheduler container.</p>
<p>The fist thing to do is to declare a <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">PersistentVolumeClaim</a> that will contain our plugins data :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pvc-bunkerweb-plugins</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5Gi</span>
</code></pre></div>
<p>You can now add the volume mount and an init containers to automatically provision the volume :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.5.0-beta</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DATABASE_URI&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@svc-bunkerweb-db:3306/db&quot;</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/data/plugins&quot;</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-plugins</span>
<span class="w">      </span><span class="nt">initContainers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler-init</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine/git</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/bin/sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;git</span><span class="nv"> </span><span class="s">clone</span><span class="nv"> </span><span class="s">https://github.com/bunkerity/bunkerweb-plugins</span><span class="nv"> </span><span class="s">/data/plugins</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">chown</span><span class="nv"> </span><span class="s">-R</span><span class="nv"> </span><span class="s">101:101</span><span class="nv"> </span><span class="s">/data/plugins&quot;</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/data/plugins&quot;</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-plugins</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-plugins</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pvc-bunkerweb-plugins</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#plugins-1.5.0-beta-integrations-linux">Linux integration</a>, plugins must be written to the <code>/etc/bunkerweb/plugins</code> folder :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb-plugins<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
cp<span class="w"> </span>-rp<span class="w"> </span>./bunkerweb-plugins/*<span class="w"> </span>/etc/bunkerweb/plugins<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chown<span class="w"> </span>-R<span class="w"> </span>nginx:nginx<span class="w"> </span>/etc/bunkerweb/plugins
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#plugins-1.5.0-beta-integrations-ansible">Ansible integration</a>, you can use the <code>plugins</code> variable to set a local folder containing your plugins that will be copied to your BunkerWeb instances.</p>
<p>Let's assume that you have plugins inside the <code>bunkerweb-plugins</code> folder :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb-plugins
</code></pre></div>
<p>In your Ansible inventory, you can use the <code>plugins</code> variable to set the path of plugins folder :</p>
<div class="highlight"><pre><span></span><code><span class="k">[mybunkers]</span>
<span class="na">192.168.0.42 ... custom_plugins</span><span class="o">=</span><span class="s">&quot;{{ playbook_dir }}/bunkerweb-plugins&quot;</span>
</code></pre></div>
<p>Or alternatively, in your playbook file :</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">custom_plugins</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/bunkerweb-plugins&quot;</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity.bunkerweb</span>
</code></pre></div>
<p>Run the playbook :</p>
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>playbook.yml
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#plugins-1.5.0-beta-integrations-vagrant">Vagrant integration</a>, plugins must be written to the <code>/etc/bunkerweb/plugins</code> folder (you will need to do a <code>vagrant ssh</code> first) :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb-plugins<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
cp<span class="w"> </span>-rp<span class="w"> </span>./bunkerweb-plugins/*<span class="w"> </span>/etc/bunkerweb/plugins
</code></pre></div>
</div>
</div>
</div>
<h2 id="plugins-writing-a-plugin">Writing a plugin</h2>
<div class="admonition tip">
<p class="admonition-title">Existing plugins</p>
<p>If the documentation is not enough, you can have a look at the existing source code of <a href="https://github.com/bunkerity/bunkerweb-plugins">official plugins</a> and the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/src/common/core">core plugins</a> (already included in BunkerWeb but they are plugins, technically speaking).</p>
</div>
<p>The first step is to create a folder that will contain the plugin :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>myplugin<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">cd</span><span class="w"> </span>myplugin
</code></pre></div>
<h3 id="plugins-metadata">Metadata</h3>
<p>A file named <strong>plugin.json</strong> and written at the root of the plugin folder must contain metadata about the plugin. Here is an example :</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;myplugin&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;order&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My Plugin&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Just an example plugin.&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;stream&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;partial&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;DUMMY_SETTING&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;context&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;multisite&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1234&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;help&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Here is the help of the setting.&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dummy-id&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Dummy setting&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;regex&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^.*$&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;jobs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-job&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-job.py&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;every&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hour&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>Here are the details of the fields :</p>
<table>
<thead>
<tr>
<th align="center">Field</th>
<th align="center">Mandatory</th>
<th align="center">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>id</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">Internal ID for the plugin : must be unique among other plugins (including "core" ones) and contain only lowercase chars.</td>
</tr>
<tr>
<td align="center"><code>order</code></td>
<td align="center">yes</td>
<td align="center">int</td>
<td align="left">When the plugin should be executed during the access phase : <code>1</code> for whitelisting, <code>2</code> for blacklisting, <code>3</code> for "standard security feature" or <code>999</code> if your settings don't use the access phase.</td>
</tr>
<tr>
<td align="center"><code>name</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">Name of your plugin.</td>
</tr>
<tr>
<td align="center"><code>description</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">Description of your plugin.</td>
</tr>
<tr>
<td align="center"><code>version</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">Version of your plugin.</td>
</tr>
<tr>
<td align="center"><code>stream</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">Information about stream support : <code>no</code>, <code>yes</code> or <code>partial</code>.</td>
</tr>
<tr>
<td align="center"><code>settings</code></td>
<td align="center">yes</td>
<td align="center">dict</td>
<td align="left">List of the settings of your plugin.</td>
</tr>
<tr>
<td align="center"><code>jobs</code></td>
<td align="center">no</td>
<td align="center">list</td>
<td align="left">List of the jobs of your plugin.</td>
</tr>
</tbody>
</table>
<p>Each setting has the following fields (the key is the ID of the settings used in a configuration) :</p>
<table>
<thead>
<tr>
<th align="center">Field</th>
<th align="center">Mandatory</th>
<th align="center">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>context</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">Context of the setting : <code>multisite</code> or <code>global</code>.</td>
</tr>
<tr>
<td align="center"><code>default</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">The default value of the setting.</td>
</tr>
<tr>
<td align="center"><code>help</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">Help text about the plugin (shown in web UI).</td>
</tr>
<tr>
<td align="center"><code>id</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">Internal ID used by the web UI for HTML elements.</td>
</tr>
<tr>
<td align="center"><code>label</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">Label shown by the web UI.</td>
</tr>
<tr>
<td align="center"><code>regex</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">The regex used to validate the value provided by the user.</td>
</tr>
<tr>
<td align="center"><code>type</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">The type of the field : <code>text</code>, <code>check</code>, <code>select</code> or <code>password</code>.</td>
</tr>
<tr>
<td align="center"><code>multiple</code></td>
<td align="center">no</td>
<td align="center">string</td>
<td align="left">Unique ID to group multiple settings with numbers as suffix.</td>
</tr>
<tr>
<td align="center"><code>select</code></td>
<td align="center">no</td>
<td align="center">list</td>
<td align="left">List of possible string values when <code>type</code> is <code>select</code>.</td>
</tr>
</tbody>
</table>
<p>Each job has the following fields :</p>
<table>
<thead>
<tr>
<th align="center">Field</th>
<th align="center">Mandatory</th>
<th align="center">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>name</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">Name of the job.</td>
</tr>
<tr>
<td align="center"><code>file</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">Name of the file inside the jobs folder.</td>
</tr>
<tr>
<td align="center"><code>every</code></td>
<td align="center">yes</td>
<td align="center">string</td>
<td align="left">Job scheduling frequency : <code>minute</code>, <code>hour</code>, <code>day</code>, <code>week</code> or <code>once</code> (no frequency, only once before (re)generating the configuration).</td>
</tr>
</tbody>
</table>
<h3 id="plugins-configurations">Configurations</h3>
<p>You can add custom NGINX configurations by adding a folder named <strong>confs</strong> with content similar to the <a href="#quickstart-guide-custom-configurations">custom configurations</a>. Each subfolder inside the <strong>confs</strong> will contain <a href="https://jinja.palletsprojects.com">jinja2</a> templates that will be generated and loaded at the corresponding context (<code>http</code>, <code>server-http</code>, <code>default-server-http</code>, <code>stream</code> and <code>server-stream</code>).</p>
<p>Here is an example for a configuration template file inside the <strong>confs/server-http</strong> folder named <strong>example.conf</strong> :</p>
<div class="highlight"><pre><span></span><code>location /setting {
    default_type &#39;text/plain&#39;;
    content_by_lua_block {
        ngx.say(&#39;{{ DUMMY_SETTING }}&#39;)
    }
}
</code></pre></div>
<p><code>{{ DUMMY_SETTING }}</code> will be replaced by the value of the <code>DUMMY_SETTING</code> chosen by the user of the plugin.</p>
<h3 id="plugins-lua">LUA</h3>
<h4 id="plugins-main-script">Main script</h4>
<p>Under the hood, BunkerWeb is using the <a href="https://github.com/openresty/lua-nginx-module">NGINX LUA module</a> to execute code within NGINX. Plugins that need to execute code must provide a lua file at the root directory of the plugin folder using the <code>id</code> value of <strong>plugin.json</strong> as its name. Here is an example named <strong>myplugin.lua</strong> :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">class</span>     <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;middleclass&quot;</span>
<span class="kd">local</span> <span class="n">plugin</span>    <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;bunkerweb.plugin&quot;</span>
<span class="kd">local</span> <span class="n">utils</span>     <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;bunkerweb.utils&quot;</span>


<span class="kd">local</span> <span class="n">myplugin</span> <span class="o">=</span> <span class="n">class</span><span class="p">(</span><span class="s2">&quot;myplugin&quot;</span><span class="p">,</span> <span class="n">plugin</span><span class="p">)</span>


<span class="kr">function</span> <span class="nc">myplugin</span><span class="p">:</span><span class="nf">initialize</span><span class="p">()</span>
    <span class="n">plugin</span><span class="p">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="s2">&quot;myplugin&quot;</span><span class="p">)</span>
    <span class="n">self</span><span class="p">.</span><span class="n">dummy</span> <span class="o">=</span> <span class="s2">&quot;dummy&quot;</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">myplugin</span><span class="p">:</span><span class="nf">init</span><span class="p">()</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">NOTICE</span><span class="p">,</span> <span class="s2">&quot;init called&quot;</span><span class="p">)</span>
    <span class="kr">return</span> <span class="n">self</span><span class="p">:</span><span class="n">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">myplugin</span><span class="p">:</span><span class="nf">set</span><span class="p">()</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">NOTICE</span><span class="p">,</span> <span class="s2">&quot;set called&quot;</span><span class="p">)</span>
    <span class="kr">return</span> <span class="n">self</span><span class="p">:</span><span class="n">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">myplugin</span><span class="p">:</span><span class="nf">access</span><span class="p">()</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">NOTICE</span><span class="p">,</span> <span class="s2">&quot;access called&quot;</span><span class="p">)</span>
    <span class="kr">return</span> <span class="n">self</span><span class="p">:</span><span class="n">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">myplugin</span><span class="p">:</span><span class="nf">log</span><span class="p">()</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">NOTICE</span><span class="p">,</span> <span class="s2">&quot;log called&quot;</span><span class="p">)</span>
    <span class="kr">return</span> <span class="n">self</span><span class="p">:</span><span class="n">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">myplugin</span><span class="p">:</span><span class="nf">log_default</span><span class="p">()</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">NOTICE</span><span class="p">,</span> <span class="s2">&quot;log_default called&quot;</span><span class="p">)</span>
    <span class="kr">return</span> <span class="n">self</span><span class="p">:</span><span class="n">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">myplugin</span><span class="p">:</span><span class="nf">preread</span><span class="p">()</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">NOTICE</span><span class="p">,</span> <span class="s2">&quot;preread called&quot;</span><span class="p">)</span>
    <span class="kr">return</span> <span class="n">self</span><span class="p">:</span><span class="n">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">myplugin</span><span class="p">:</span><span class="nf">log_stream</span><span class="p">()</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">NOTICE</span><span class="p">,</span> <span class="s2">&quot;log_stream called&quot;</span><span class="p">)</span>
    <span class="kr">return</span> <span class="n">self</span><span class="p">:</span><span class="n">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="n">myplugin</span>
</code></pre></div>
<p>The declared functions are automatically called during specific contexts. Here are the details of each function :</p>
<table>
<thead>
<tr>
<th align="center">Function</th>
<th align="center">Context</th>
<th align="left">Description</th>
<th align="left">Return value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>init</code></td>
<td align="center"><a href="https://github.com/openresty/lua-nginx-module#init_by_lua">init_by_lua</a></td>
<td align="left">Called when NGINX just started or received a reload order. the typical use case is to prepare any data that will be used by your plugin.</td>
<td align="left"><code>ret</code>, <code>msg</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li></ul></td>
</tr>
<tr>
<td align="center"><code>set</code></td>
<td align="center"><a href="https://github.com/openresty/lua-nginx-module#set_by_lua">set_by_lua</a></td>
<td align="left">Called before each request received by the server.The typical use case is for computing before access phase.</td>
<td align="left"><code>ret</code>, <code>msg</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li></ul></td>
</tr>
<tr>
<td align="center"><code>access</code></td>
<td align="center"><a href="https://github.com/openresty/lua-nginx-module#access_by_lua">access_by_lua</a></td>
<td align="left">Called on each request received by the server. The typical use case is to do the security checks here and deny the request if needed.</td>
<td align="left"><code>ret</code>, <code>msg</code>,<code>status</code>,<code>redirect</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li><li><code>status</code> (number) : interrupt current process and return <a href="https://github.com/openresty/lua-nginx-module#http-status-constants">HTTP status</a></li><li><code>redirect</code> (URL) : if set will redirect to given URL</li></ul></td>
</tr>
<tr>
<td align="center"><code>log</code></td>
<td align="center"><a href="https://github.com/openresty/lua-nginx-module#log_by_lua">log_by_lua</a></td>
<td align="left">Called when a request has finished (and before it gets logged to the access logs). The typical use case is to make stats or compute counters for example.</td>
<td align="left"><code>ret</code>, <code>msg</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li></ul></td>
</tr>
<tr>
<td align="center"><code>log_default</code></td>
<td align="center"><a href="https://github.com/openresty/lua-nginx-module#log_by_lua">log_by_lua</a></td>
<td align="left">Same as <code>log</code> but only called on the default server.</td>
<td align="left"><code>ret</code>, <code>msg</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li></ul></td>
</tr>
<tr>
<td align="center"><code>preread</code></td>
<td align="center"><a href="https://github.com/openresty/stream-lua-nginx-module#preread_by_lua_block">preread_by_lua</a></td>
<td align="left">Similar to the <code>access</code> function but for stream mode.</td>
<td align="left"><code>ret</code>, <code>msg</code>,<code>status</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li><li><code>status</code> (number) : interrupt current process and return <a href="https://github.com/openresty/lua-nginx-module#http-status-constants">status</a></li></ul></td>
</tr>
<tr>
<td align="center"><code>log_stream</code></td>
<td align="center"><a href="https://github.com/openresty/stream-lua-nginx-module#log_by_lua_block">log_by_lua</a></td>
<td align="left">Similar to the <code>log</code> function but for stream mode.</td>
<td align="left"><code>ret</code>, <code>msg</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li></ul></td>
</tr>
</tbody>
</table>
<h4 id="plugins-libraries">Libraries</h4>
<p>All directives from <a href="https://github.com/openresty/lua-nginx-module">NGINX LUA module</a> and are available and <a href="https://github.com/openresty/stream-lua-nginx-module">NGINX stream LUA module</a>. On top of that, you can use the LUA libraries included within BunkerWeb : see <a href="https://github.com/bunkerity/bunkerweb/blobsrc/deps/clone.sh">this script</a> for the complete list.</p>
<p>If you need additional libraries, you can put them in the root folder of the plugin and access them by prefixing them with your plugin ID. Here is an example file named <strong>mylibrary.lua</strong> :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">_M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">_M</span><span class="p">.</span><span class="n">dummy</span> <span class="o">=</span> <span class="kr">function</span> <span class="p">()</span>
    <span class="kr">return</span> <span class="s2">&quot;dummy&quot;</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="n">_M</span>
</code></pre></div>
<p>And here is how you can use it from the <strong>myplugin.lua</strong> file :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">mylibrary</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;myplugin.mylibrary&quot;</span>

<span class="p">...</span>

<span class="n">mylibrary</span><span class="p">.</span><span class="n">dummy</span><span class="p">()</span>

<span class="p">...</span>
</code></pre></div>
<h4 id="plugins-helpers">Helpers</h4>
<p>Some helpers modules provide common helpful helpers :</p>
<ul>
<li><code>self.variables</code> : allows to access and store plugins' attributes</li>
<li><code>self.logger</code> : print logs</li>
<li><code>bunkerweb.utils</code> : various useful functions</li>
<li><code>bunkerweb.datastore</code> : access the global shared data on one instance (key/value store)</li>
<li><code>bunkerweb.clusterstore</code> : access a Redis data store shared beetween BunkerWeb instances (key/value store)</li>
</ul>
<p>To access the functions, you first need to <strong>require</strong> the modules :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">utils</span>       <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;bunkerweb.utils&quot;</span>
<span class="kd">local</span> <span class="n">datastore</span>   <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;bunkerweb.datastore&quot;</span>
<span class="kd">local</span> <span class="n">clustestore</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;bunkerweb.clustertore&quot;</span>
</code></pre></div>
<p>Retrieve a setting value :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">myvar</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;DUMMY_SETTING&quot;</span><span class="p">]</span>
<span class="kr">if</span> <span class="ow">not</span> <span class="n">myvar</span> <span class="kr">then</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">ERR</span><span class="p">,</span> <span class="s2">&quot;can&#39;t retrieve setting DUMMY_SETTING&quot;</span><span class="p">)</span>
<span class="kr">else</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">NOTICE</span><span class="p">,</span> <span class="s2">&quot;DUMMY_SETTING = &quot;</span> <span class="o">..</span> <span class="n">value</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<p>Store something in the local cache :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">datastore</span><span class="p">:</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;plugin_myplugin_something&quot;</span><span class="p">,</span> <span class="s2">&quot;somevalue&quot;</span><span class="p">)</span>
<span class="kr">if</span> <span class="ow">not</span> <span class="n">ok</span> <span class="kr">then</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">ERR</span><span class="p">,</span> <span class="s2">&quot;can&#39;t save plugin_myplugin_something into datastore : &quot;</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>
<span class="kr">else</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">NOTICE</span><span class="p">,</span> <span class="s2">&quot;successfully saved plugin_myplugin_something into datastore&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<p>Check if an IP address is global :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">ret</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">utils</span><span class="p">.</span><span class="n">ip_is_global</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">ctx</span><span class="p">.</span><span class="n">bw</span><span class="p">.</span><span class="n">remote_addr</span><span class="p">)</span>
<span class="kr">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">ERR</span><span class="p">,</span> <span class="s2">&quot;error while checking if IP &quot;</span> <span class="o">..</span> <span class="n">ngx</span><span class="p">.</span><span class="n">ctx</span><span class="p">.</span><span class="n">bw</span><span class="p">.</span><span class="n">remote_addr</span> <span class="o">..</span> <span class="s2">&quot; is global or not : &quot;</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>
<span class="kr">elseif</span> <span class="ow">not</span> <span class="n">ret</span> <span class="kr">then</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">NOTICE</span><span class="p">,</span> <span class="s2">&quot;IP &quot;</span> <span class="o">..</span> <span class="n">ngx</span><span class="p">.</span><span class="n">ctx</span><span class="p">.</span><span class="n">bw</span><span class="p">.</span><span class="n">remote_addr</span> <span class="o">..</span> <span class="s2">&quot; is not global&quot;</span><span class="p">)</span>
<span class="kr">else</span>
    <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">NOTICE</span><span class="p">,</span> <span class="s2">&quot;IP &quot;</span> <span class="o">..</span> <span class="n">ngx</span><span class="p">.</span><span class="n">ctx</span><span class="p">.</span><span class="n">bw</span><span class="p">.</span><span class="n">remote_addr</span> <span class="o">..</span> <span class="s2">&quot; is global&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">More examples</p>
<p>If you want to see the full list of available functions, you can have a look at the files present in the <a href="https://github.com/bunkerity/bunkerweb/tree/v1.5.0-beta/src/bw/lua/bunkerweb">lua directory</a> of the repository.</p>
</div>
<h3 id="plugins-jobs">Jobs</h3>
<p>BunkerWeb uses an internal job scheduler for periodic tasks like renewing certificates with certbot, downloading blacklists, downloading MMDB files, ... You can add tasks of your choice by putting them inside a subfolder named <strong>jobs</strong> and listing them in the <strong>plugin.json</strong> metadata file. Don't forget to add the execution permissions for everyone to avoid any problems when a user is cloning and installing your plugin.</p>
<h3 id="plugins-plugin-page">Plugin page</h3>
<p>Plugin pages are used to display information about your plugin and interact with the user inside the plugins section of the <a href="#web-ui">web UI</a>.</p>
<p>Everything related to the web UI is located inside a subfolder named <strong>ui</strong> at the root directory of your plugin. A template file named <strong>template.html</strong> and located inside the <strong>ui</strong> subfolder contains the client code and logic to display your page. Another file named <strong>actions.py</strong> and also located inside the <strong>ui</strong> subfolder contains code that will be executed when the user is interacting with your page (filling a form for example).</p>
<div class="admonition info">
<p class="admonition-title">Jinja 2 template</p>
<p>The <strong>template.html</strong> file is a Jinja2 template, please refer to the <a href="https://jinja.palletsprojects.com">Jinja2 documentation</a> if needed.</p>
</div>
<p>A plugin page can have a form that is used to submit data to the plugin. To get the values of the form, you need to put a <strong>actions.py</strong> file in the <strong>ui</strong> folder. Inside the file, <strong>you must define a function that has the same name as the plugin</strong>. This function will be called when the form is submitted. You can then use the <strong>request</strong> object (from the <a href="https://flask.palletsprojects.com">Flask library</a>) to get the values of the form. The form's action must finish with <strong>/plugins/&lt;<em>plugin_id</em>&gt;</strong>. The helper function <code>url_for</code> will generate for you the prefix of the URL : <code>{{ url_for('plugins') }}/plugin_id</code>.</p>
<p>If you want to display variables generated from your <strong>actions.py</strong> in your template file, you can return a dictionary with variables name as keys and variables value as values. Here is dummy example where we return a single variable :</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">myplugin</span><span class="p">()</span> <span class="p">:</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">}</span>
</code></pre></div>
<p>And we display it in the <strong>template.html</strong> file :
<div class="highlight"><pre><span></span><code>{% if foo %}
Content of foo is : {{ foo }}.
{% endif %}
</code></pre></div></p>
<p>Please note that every form submission is protected via a CSRF token, you will need to include the following snippet into your forms :
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;csrf_token&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ csrf_token() }}&quot;</span> <span class="p">/&gt;</span>
</code></pre></div></p>
<p>Retrieving user submitted data is pretty simple, thanks to the request module provided by Flask :</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>

<span class="k">def</span> <span class="nf">myplugin</span><span class="p">()</span> <span class="p">:</span>
    <span class="n">my_form_value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;my_form_input&quot;</span><span class="p">]</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Python libraries</p>
<p>You can use Python libraries that are already available like :
<code>Flask</code>, <code>Flask-Login</code>, <code>Flask-WTF</code>, <code>beautifulsoup4</code>, <code>docker</code>, <code>Jinja2</code>, <code>python-magic</code> and <code>requests</code>. To see the full list, you can have a look at the Web UI <a href="https://github.com/bunkerity/bunkerweb/blobsrc/ui/requirements.txt">requirements.txt</a>. If you need external libraries, you can install them inside the <strong>ui</strong> folder of your plugin and then use the classical <strong>import</strong> directive.</p>
</div></section><section class="print-page" id="about"><h1 id="about-about">About</h1>
<h2 id="about-who-maintains-bunkerweb">Who maintains BunkerWeb ?</h2>
<p>BunkerWeb is maintained by <a href="https://www.bunkerity.com">Bunkerity</a>, a French 🇫🇷 company specialized in Cybersecurity 🛡️.</p>
<h2 id="about-do-you-offer-professional-services">Do you offer professional services ?</h2>
<p>Yes, we offer professional services related to BunkerWeb such as :</p>
<ul>
<li>Consulting</li>
<li>Support</li>
<li>Custom development</li>
<li>Partnership</li>
</ul>
<p>Please contact us at <a href="mailto:contact@bunkerity.com">contact@bunkerity.com</a> if you are interested.</p>
<h2 id="about-where-to-get-community-support">Where to get community support ?</h2>
<p>To get free community support, you can use the following medias :</p>
<ul>
<li>The #help channel of BunkerWeb in the <a href="https://discord.com/invite/fTf46FmtyD">Discord server</a></li>
<li>The help category of <a href="https://github.com/bunkerity/bunkerweb/discussions">GitHub dicussions</a></li>
<li>The <a href="https://www.reddit.com/r/BunkerWeb">/r/BunkerWeb</a> subreddit</li>
<li>The <a href="https://serverfault.com/">Server Fault</a> and <a href="https://superuser.com/">Super User</a> forums</li>
</ul>
<p>Please don't use <a href="https://github.com/bunkerity/bunkerweb/issues">GitHub issues</a> to ask for help, use it only for bug reports and feature requests.</p>
<h2 id="about-how-can-i-contribute">How can I contribute ?</h2>
<p>Here is a non-exhaustive list of what you can do :</p>
<ul>
<li>Join the <a href="https://discord.com/invite/fTf46FmtyD">Discord server</a>, <a href="https://www.reddit.com/r/BunkerWeb">/r/BunkerWeb</a> subreddit and <a href="https://github.com/bunkerity/bunkerweb/discussions">GitHub discussions</a> to talk about the project and help others</li>
<li>Follow us on <a href="https://www.linkedin.com/company/bunkerity/">LinkedIn</a>, <a href="https://twitter.com/bunkerity">Twitter</a> and <a href="https://github.com/bunkerity">GitHub</a></li>
<li>Report bugs and propose new features using <a href="https://github.com/bunkerity/bunkerweb/issues">issues</a></li>
<li>Contribute to the code using <a href="https://github.com/bunkerity/bunkerweb/pulls">pull requests</a></li>
<li>Write an awesome <a href="#plugins">plugin</a></li>
<li>Talk about BunkerWeb to your friends/colleagues, on social media, on your blog, ...</li>
</ul>
<h2 id="about-how-to-report-security-issue">How to report security issue ?</h2>
<p>Please contact us at <a href="mailto:security@bunkerity.com">security@bunkerity.com</a> using the following PGP key :</p>
<div class="highlight"><pre><span></span><code>-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBGCEMiMBEACtXJBDbF86qjC/Q1cfmJfYcYrbk6eE5czknG294XObC97wAgDf
/MbX6bnti4kDRpflGDqQtwOXudcEzledTD4bdDUKvZwqPoYQGa24uCuUxSINTLXr
RuoMaKfpvs7trsFXp5iYUqf4Org2aaJE7Tk/9sOvxgdqsT22jEgCZXTRU1qG494U
u6XRQN8hKlw6aa6njjX9vUk6Jpl46/kwwO9mpXBZX6iFKYnBlUWs2k8d6D6cO5aZ
KLoYyz5v3Gw2hHSqj4qbVQPTIT7qrrcfd8nblYK7Dh3IM+vQq7a7lB0AudIyBNPd
rsypi9ZYgwI3lv/rmQnDc32Ua5cLvTvgg/XoaNK9ogc3kei1+hXODEgRA/zvSKqq
20i/1Y0OnIGv89LOI6urWpOgDAhQUV5xvANll2lm3Bkmy29UOzNadUc/yImxrM06
HwX82ju6PFAqOaxMW6SEE71ylGOSlikAGNcmmc5Ihd1J/VRZA4PBiQ31gQxFRpUC
3NTw2QNAD1kjni5PuQD10Q1Ognvb6uJh/MtqsoX6r1t+Oly9MblFSuyqFkqNO3F0
QAJqprhJlQ3YOcJdJ1EZR7qs0xJm5h+lw0Z/UINqkwiZUW3PCO8BKxfq6sfdwM8L
5hPhyUzy2gIJ0J/4NGYEBH1ojoYODGU8OCSmyjSTY9SoVMeWDfqYP4ZTvQARAQAB
tCVidW5rZXJpdHktcGdwIDxjb250YWN0QGJ1bmtlcml0eS5jb20+iQJUBBMBCAA+
FiEEw78SjkcVxXCq7hStPYCAbxJgKnwFAmCEMiMCGwMFCQPCIP0FCwkIBwIGFQoJ
CAsCBBYCAwECHgECF4AACgkQPYCAbxJgKnzvYhAAnNqGB6ce2eZzwk1EiNlNaXaA
hFWLq/s/J1IOAP+0V5jKJxA6zTX01HyIfIIHQy6nrxxEXzYsIUHdJ+HBPCNswCqn
2d/aDkkfoEUc1bUD0c2bXfoSCsAeIoK+eOf6iSr4IENVoIUYFQTUKFNu+Y7eDL0I
J8Xadg53G+fkK9LE6TeYpBs3hDT4w7vlDfIwWa1NC9HoLzSmZ2fqZ7SnihLGsLmp
98VqDrDjhRPzrz5/tVYgvPCQQU5ED/TayCCYvrGpw9gP8qmEOabIUz0ppGwEfQVs
Wycilm1/Js/qjdbxUFMipBIzDu7bI3kMLmENhI+16Xtub9dUrvkW2SdDngYhtWj8
IzVOe6N/XDuiRGpaYFpEuXbrnDFexe1ygZwnVHt3fukPfa7W8mhMs2kY1ishIA0O
WElKO1Q6N0ZWEad0PwM8NCDjaDUNWQC36ZF/MS+ipHWx9joPUjImY2AXDjN+L+Si
ABQIe4Fo6Jx6S6Bi8YvPq8idYZvaWFJjBvmaPjxdUMPbIsMRiEjvlrhvqhLuVBpE
lGA+M4UJGw5yBl+yiiLDuws/Fppv9HwNqw6Uq1m1XaW859Om1GGBKYfphyn+fHjR
7ftOuT7Ss4zioXT4mscOZgkfzDAqgpZiHjYhe7tLUu7iD6UEsZmey/gRV0hCxng3
N7yaRrBu0+3sIQV4jYC5Ag0EYIQyIwEQALSurJGOx7At5mRFjvhXd4/JHuBZZOSI
M45LSJ+mKYnAGmwsL0AneZMIf6Yc0Vcn32oqlIXN5aB8jIt91pChLre8tl/lFZZP
xY3WIEBJhZF0FIUqSQLjg4HD0S70REii7Om1kgtZueid8V6T5F1JDcO2mDoh8oc9
h9nRQ1Ld6dblEuwBzbFkI1K6OUk1+ec7+mQc7orHdBVgelmqwG7fGZnPiN3XfklF
dnwSkFIX/qkAsKQmmx1VSzaGFoPLajf4wrkzZdA3iEafsHyvdEFlezZCZ7TsoHBh
tNg1Psg6MbBVgiMfHyRHSEBJZ7r5Awj2MpFUFMOd1IPcor1I254mx0VYfCvof4Km
Ri1F/86kHc23A77pd4HFYZWiZjaWhh12L+wz5fDL5/sSFXVGSCtSWIKx6FjysZ+v
szk3lItHoomZhA7M+FjU/cOjq9hae9uwZeU39DQk0/npln2RcHitoqgUIzII5woO
S3SlMSc910tHf40D2cBr1iFKC0jQICjkDexB9CtNx/N25SJmLfiimYtk6/NHlPq4
HXdq6ZfLZ7xQmuGcyWv4f0pwA2CK3twISpsIxIKe456WYTDtQu9d1s987dvmw6F/
qURC6m2WPGroHb8COQTKzbshjpGUmLpyR3FXki4wNXeI1KaQLL7NpZmK6yJlWviO
1sCjh4m7VS+zABEBAAGJAjwEGAEIACYWIQTDvxKORxXFcKruFK09gIBvEmAqfAUC
YIQyIwIbDAUJA8Ig/QAKCRA9gIBvEmAqfP2WEACqmXEhu4ARl2yT9bay0+W3F1q1
MrLQkcVOau2ihXx3PhYsXRUoEFj72VDAar41WIlHsPJfB14WtSlYcX2XdjHLHMpC
dL2eGhqIcHzFChR0vGjtvm2wae/rJTChWf8WXiHrRnRcfFFfhpCvkNi43fQeH4yp
cel2a35WV+IRbnkCkaly2NG3XO0t83Siok8Ku+OJGPatUMxJmaEVQeeXVPDzVRva
rtvyd9Sclkd9QDPBLZyWHC1vsPKGRJpi5uDZjGxhaFRkimw/SYtFHj7AUrMKAIHB
GfEcwC3Eq4rF0FeCOPfBd2vwGGrRflx76jK9rj288ta9Oq6u6ev8PCVzt0E7jrSf
AX88vfVRcxihNfj/9i5xmY596jpgbvNA2aJX2hAO3Q8pD6AunVXPUyc3RlFHt7jC
tL+9Xv7Qwjz7OToWqj+9cM6T+6oZLxYNVPT72Z/KOFW+mzGb87qjcsDMb/hu2fNq
tSWyZk2AAgHQyG1y8vCQQzsDnUDM6NIPwYG5XMP+11WAsPk5fP1ksixpUqIWgjhY
M22YUsjLeaRtgSmhAGIkbBgecs1EHSZZ6sf2lB8gSom1wW0UCBPSifP0DwYFizS5
SOk62kZ0lqEctwgKDe3MNQnPxt9+tU9L1pIkyXgXihcOLiCMl434K0djJXxIbiX0
JvbFAfI3qteepvnjBQ==
=g1tf
-----END PGP PUBLIC KEY BLOCK-----
</code></pre></div></section></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; <script>document.write(new Date().getFullYear())</script> Bunkerity
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://discord.com/invite/fTf46FmtyD" target="_blank" rel="noopener" title="discord.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/bunkerity" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/bunkerity/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/bunkerity" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "/1.5.0-beta", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "toc.integrate", "content.code.copy"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike", "version": "latest"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51198bba.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
    
  </body>
</html>