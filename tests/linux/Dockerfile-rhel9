FROM redhat/ubi9-init:9.4-6.1714669926@sha256:dfae07a6c96c27ac5f33e1c3953906171eb4b65756d9e9917bd47d1b05954d90

ENV NGINX_VERSION 1.26.0

# Copy rocky repo
COPY src/linux/rocky-9.repo /etc/yum.repos.d/rocky.repo
RUN sed -i "s/%ARCH%/$(uname -m)/g" /etc/yum.repos.d/rocky.repo

# Copy RPM-GPG-KEY-Rocky-9
COPY src/linux/RPM-GPG-KEY-Rocky-9 /etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9

# Import RPM-GPG-KEY-Rocky-9
RUN rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9

COPY src/linux/nginx.repo /etc/yum.repos.d/nginx.repo

RUN rpm -ivh https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm && \
    dnf install php-fpm yum-utils -y && \
    dnf install nginx-${NGINX_VERSION} -y

COPY ./package-rhel9/*.rpm /opt
