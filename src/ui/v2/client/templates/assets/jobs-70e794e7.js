import{o as m,c as v,b as C,F as O,a,i as $,w as i,d as e,r as L,n as f,t as k,k as V,u as E,f as g,g as j,h as H,j as M}from"./_plugin-vue_export-helper-8cf34f94.js";import{u as P,_ as T,f as S,c as R}from"./api-c8d35a00.js";import{b as z,_ as x,a as D}from"./Base-7e2e8ada.js";import{_ as G}from"./List-b0b9ba9a.js";import{_ as N}from"./Select-ab98952b.js";import{_ as A}from"./Base-dee1bee9.js";import{_ as K}from"./Base-db9c2a8d.js";import{_ as F,L as J}from"./item-7a3db547.js";const Q=a("div",{class:"bg-white w-3 h-3 rounded -z-10 translate-x-1 translate-y-1.5 absolute"},null,-1),U={key:0,class:"fill-green-500 h-5 w-5 z-10",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},W=a("path",{d:"M256 512c141.4 0 256-114.6 256-256S397.4 0 256 0S0 114.6 0 256S114.6 512 256 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"},null,-1),X=[W],Y={key:1,class:"fill-red-500 h-5 w-5 z-10",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},Z=a("path",{d:"M256 512c141.4 0 256-114.6 256-256S397.4 0 256 0S0 114.6 0 256S114.6 512 256 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"},null,-1),ss=[Z],B={__name:"State",props:{success:{type:Boolean,required:!1}},setup(d){const u=d;return(s,p)=>(m(),v(O,null,[Q,u.success?(m(),v("svg",U,X)):C("",!0),u.success?C("",!0):(m(),v("svg",Y,ss))],64))}},es={class:"col-span-12 overflow-x-auto overflow-y-hidden"},ts={class:"list-content-item-wrap"},as={class:"w-full mt-2"},os={class:"mt-2 w-full justify-end flex"},ls={__name:"History",props:{history:{type:Array,required:!0},jobName:{type:String,required:!0},isOpen:{type:Boolean,required:!0}},emits:["close"],setup(d,{emit:u}){const s=d,p=["col-span-2","col-span-5","col-span-5"],_=["success","start date","end date"];return(o,n)=>s.isOpen?(m(),$(K,{key:0,title:`history ${s.jobName}`},{default:i(()=>[a("div",es,[e(F,{class:"min-w-[500px]",header:_,positions:p},{default:i(()=>[(m(!0),v(O,null,L(s.history,t=>(m(),$(J,null,{default:i(()=>[a("div",ts,[a("div",{class:f(["translate-x-3 col-span-2",[p[0]]])},[e(B,{success:t.success},null,8,["success"])],2),a("span",{class:f([p[1]])},k(t.start_date),3),a("span",{class:f([p[2]])},k(t.end_date),3)])]),_:2},1024))),256))]),_:1})]),a("div",as,[a("div",os,[e(A,{color:"close",size:"lg",onClick:n[0]||(n[0]=t=>o.$emit("close")),type:"button",class:"text-xs"},{default:i(()=>[V(" Close ")]),_:1})])])]),_:1},8,["title"])):C("",!0)}},ns={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"pointer-events-none stroke-sky-500 h-8 w-8 z-10"},cs=a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m5.231 13.481L15 17.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v16.5c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9zm3.75 11.625a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"},null,-1),rs=[cs],is={__name:"History",props:{success:{type:Boolean,required:!1}},setup(d){return(u,s)=>(m(),v("svg",ns,rs))}};function us(){return["all","once","hour","day","week"]}function ds(d){const u=[];return d.forEach(s=>{u.push(s.file_name)}),u}function ps(d,u){return d.forEach((s,p)=>{const _=Object.keys(s).join(),o=s[_];for(const[n,t]of Object.entries(u)){if(!(n in o)&&n!=="name"&&n!=="success"||n==="name"&&t===""||t==="all")continue;const h=typeof t;let y=!0;if(h==="string"&&n==="name"){const w=t.toLowerCase().trim();y=!!_.toLowerCase().trim().includes(w)}if(h==="string"&&n!=="name"){const w=t.toLowerCase().trim();y=!!o[n].toLowerCase().trim().includes(w)}h==="boolean"&&n==="success"&&(y=t===o.history[0][n]),h==="boolean"&&n!=="success"&&(y=t===o[n]),y||delete d[p]}}),d.filter(Object)}const ms={class:"list-content-item-wrap"},fs=["onClick"],_s={__name:"Items",props:{items:{type:Array,required:!0},positions:{type:Array,required:!0}},emits:["cache","run","history"],setup(d,{emit:u}){const s=d;return(p,_)=>(m(!0),v(O,null,L(s.items,(o,n)=>(m(),$(J,{class:f([n===s.items.length-1?"":"border-b"])},{default:i(()=>[(m(!0),v(O,null,L(o,(t,h)=>(m(),v("div",ms,[a("span",{class:f(["pl-4",[s.positions[0]]])},k(h),3),a("span",{class:f([s.positions[1]])},k(t.every),3),a("div",{class:f([s.positions[2],"ml-2"])},[a("button",{onClick:y=>p.$emit("history",{jobName:h})},[e(is)],8,fs)],2),a("div",{class:f(["translate-x-3",[s.positions[3]]])},[e(B,{success:t.reload},null,8,["success"])],2),a("div",{class:f(["translate-x-4",[s.positions[4]]])},[e(B,{success:t.history[0].success},null,8,["success"])],2),a("div",{class:f([s.positions[5]])},[a("span",null,k(t.history[0].end_date),1)],2),a("div",{class:f([s.positions[6]])},[t.cache.length>0?(m(),$(N,{key:0,onInp:y=>p.$emit("cache",{jobName:h,cacheName:y}),settings:{id:"cache-files",value:"select to download",values:E(ds)(t.cache)}},null,8,["onInp","settings"])):C("",!0)],2),a("div",{class:f([s.positions[7],"flex justify-center"])},[e(A,{color:"valid",size:"lg",onClick:y=>p.$emit("run",{jobName:h})},{default:i(()=>[V(" run ")]),_:2},1032,["onClick"])],2)]))),256))]),_:2},1032,["class"]))),256))}},hs={__name:"Jobs",setup(d){const u=P(),s=["col-span-2","col-span-1","col-span-1","col-span-1","col-span-1","col-span-2","col-span-3","col-span-1"],p=["Name","Every","History","Reload","Success","Last run","Cache","Action"],_=g({name:"",reload:"all",success:"all",every:"all"}),o=g({isPend:!1,isErr:!1,data:[],total:j(()=>Object.keys(o.data).length),reload:j(()=>Object.values(o.data).filter(r=>r.reload!==!1).length),success:j(()=>Object.values(o.data).filter(r=>r.history[0].success!==!1).length),setup:j(()=>{const r=JSON.parse(JSON.stringify(o.data)),l=[];for(const[I,bs]of Object.entries(r))l.push({[I]:r[I]});return ps(l,_)})});async function n(){await S("/api/jobs","GET",null,o,u.addFeedback)}const t=g({isPend:!1,isErr:!1,data:[]});async function h(r){await S(`/api/jobs/${r.jobName}/run`,"POST",null,t,u.addFeedback)}const y=g({isPend:!1,isErr:!1,data:[]});async function w(r){await S(`/api/jobs/${r.jobName}/cache/${r.cacheName}`,"GET",null,y,u.addFeedback)}const b=g({isOpen:!1,jobName:"",data:[]});function q(r){b.jobName=r.jobName,b.data=o.data[r.jobName].history,b.isOpen=!0}return H(async()=>{await n()}),(r,l)=>(m(),$(T,null,{default:i(()=>[e(z,{class:"h-fit col-span-12 md:col-span-4 2xl:col-span-3 3xl:col-span-2",label:"info"},{default:i(()=>[e(G,{items:[{label:"jobs total",value:o.total},{label:"jobs reload",value:o.reload},{label:"jobs success",value:o.success}]},null,8,["items"])]),_:1}),e(z,{class:"z-10 h-fit col-span-12 md:col-span-8 xl:col-span-8 2xl:col-span-5 3xl:col-span-4",label:"filter"},{default:i(()=>[e(x,{class:"sm:col-span-6",label:"Search",name:"keyword"},{default:i(()=>[e(D,{onInp:l[0]||(l[0]=c=>_.name=c),settings:{id:"keyword",type:"text",value:"",placeholder:"keyword"}})]),_:1}),e(x,{class:"sm:col-span-6",label:"Success state",name:"success-state"},{default:i(()=>[e(N,{onInp:l[1]||(l[1]=c=>_.success=c==="all"?"all":c==="true"),settings:{id:"success-state",value:"all",values:["all","true","false"]}})]),_:1}),e(x,{class:"sm:col-span-6",label:"Reload state",name:"reload-state"},{default:i(()=>[e(N,{onInp:l[2]||(l[2]=c=>_.reload=c==="all"?"all":c==="true"),settings:{id:"reload-state",value:"all",values:["all","true","false"]}})]),_:1}),e(x,{class:"sm:col-span-6",label:"Interval",name:"every"},{default:i(()=>[e(N,{onInp:l[3]||(l[3]=c=>_.every=c),settings:{id:"every",value:"all",values:E(us)()}},null,8,["settings"])]),_:1})]),_:1}),e(z,{class:"col-span-12 overflow-x-auto overflow-y-hidden",label:"jobs"},{default:i(()=>[e(F,{class:"min-w-[1100px] col-span-12",header:p,positions:s},{default:i(()=>[e(_s,{onCache:l[4]||(l[4]=c=>w(c)),onRun:l[5]||(l[5]=c=>h(c)),onHistory:l[6]||(l[6]=c=>q(c)),positions:s,items:o.setup},null,8,["items"])]),_:1})]),_:1}),e(ls,{history:b.data,jobName:b.jobName,isOpen:b.isOpen,onClose:l[7]||(l[7]=c=>b.isOpen=!1)},null,8,["history","jobName","isOpen"])]),_:1}))}},ys=R();M(hs).use(ys).mount("#app");
