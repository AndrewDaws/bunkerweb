{% extends "base.html" %} {% block content %}

<div class="col-span-12 grid grid-cols-12 gap-4">
  <!-- info-->
  <div
    class="h-fit transition hover:scale-102 col-span-12 md:col-span-6 2xl:col-span-4 3xl:col-span-3 p-4 relative min-w-0 break-words bg-white shadow-xl dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border"
  >
    <h5 class="mb-2 font-bold dark:text-white/90">INFO</h5>

    <div class="mx-1 flex justify-start items-center my-4">
      <p
        data-info
        class="transition duration-300 ease-in-out mb-0 font-sans text-sm leading-normal dark:text-gray-500 dark:opacity-80"
      ></p>
    </div>
  </div>
  <!-- end info -->

  <div
    class="h-fit dark:brightness-110 max-h-none sm:max-h-28 hover:scale-102 transition col-span-12 md:col-span-6 2xl:col-span-4 flex p-4 justify-between w-full shadow-md break-words bg-white dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border"
  >
    <!-- text -->
    <div>
      <p
        class="mb-2 font-sans text-sm font-semibold leading-normal uppercase dark:text-white dark:opacity-60"
      >
        Challenges
      </p>
      <h5 data-count class="mb-1 font-bold dark:text-white/90">"unknown"</h5>

      <p class="mb-0 dark:text-white dark:opacity-60">
        <span class="font-bold leading-normal text-sm text-sky-500 mx-0.5"
          >total number
        </span>
      </p>
    </div>
    <!-- end text -->
    <!-- icon -->
    <div
      role="img"
      class="dark:brightness-90 inline-block w-12 h-12 text-center rounded-circle bg-sky-700"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="scale-75 leading-none text-lg relative fill-white"
      >
        <path
          d="M11.7 2.805a.75.75 0 0 1 .6 0A60.65 60.65 0 0 1 22.83 8.72a.75.75 0 0 1-.231 1.337 49.948 49.948 0 0 0-9.902 3.912l-.003.002c-.114.06-.227.119-.34.18a.75.75 0 0 1-.707 0A50.88 50.88 0 0 0 7.5 12.173v-.224c0-.131.067-.248.172-.311a54.615 54.615 0 0 1 4.653-2.52.75.75 0 0 0-.65-1.352 56.123 56.123 0 0 0-4.78 2.589 1.858 1.858 0 0 0-.859 1.228 49.803 49.803 0 0 0-4.634-1.527.75.75 0 0 1-.231-1.337A60.653 60.653 0 0 1 11.7 2.805Z"
        />
        <path
          d="M13.06 15.473a48.45 48.45 0 0 1 7.666-3.282c.134 1.414.22 2.843.255 4.284a.75.75 0 0 1-.46.711 47.87 47.87 0 0 0-8.105 4.342.75.75 0 0 1-.832 0 47.87 47.87 0 0 0-8.104-4.342.75.75 0 0 1-.461-.71c.035-1.442.121-2.87.255-4.286.921.304 1.83.634 2.726.99v1.27a1.5 1.5 0 0 0-.14 2.508c-.09.38-.222.753-.397 1.11.452.213.901.434 1.346.66a6.727 6.727 0 0 0 .551-1.607 1.5 1.5 0 0 0 .14-2.67v-.645a48.549 48.549 0 0 1 3.44 1.667 2.25 2.25 0 0 0 2.12 0Z"
        />
        <path
          d="M4.462 19.462c.42-.419.753-.89 1-1.395.453.214.902.435 1.347.662a6.742 6.742 0 0 1-1.286 1.794.75.75 0 0 1-1.06-1.06Z"
        />
      </svg>
    </div>
    <!-- end icon -->
  </div>
</div>

<div
  role="alert"
  data-fetch
  class="bg-sky-500 p-4 mb-1 md:mb-3 md:mr-3 z-[1001] flex flex-col fixed bottom-0 right-0 w-full md:w-1/2 max-w-[300px] min-h-20 rounded-lg dark:brightness-110 hover:scale-102 transition shadow-md break-words dark:bg-slate-850 dark:shadow-dark-xl bg-clip-border"
>
  <button data-fetch-close class="absolute right-7 top-1.5">
    <svg
      class="cursor-pointer fill-white dark:fill-gray-300 dark:opacity-80 absolute h-5 w-5"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 320 512"
    >
      <path
        d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z"
      ></path>
    </svg>
  </button>
  <h5 data-fetch-status class="text-lg mb-0 text-white dark:text-gray-300">
    Fetching
  </h5>
  <p data-fetch-msg class="text-white dark:text-gray-300 mb-0 text-sm">
    Please wait...
  </p>
</div>

<script>
  class SetupPlugin {
    constructor() {
      // Alert elements
      this.alertEl = document.querySelector("[data-fetch]");
      this.alertCloseEl = document.querySelector("[data-fetch-close]");
      this.alertStatusEl = document.querySelector("[data-fetch-status]");
      this.alertMsgEl = document.querySelector("[data-fetch-msg]");
      // Set data defaults elements and variables
      // Key of this.data need to match key of fetch data json object to update values
      // type<str> : text (target el), list (el need to be first element of list)
      // listNames<arr> : list of names key on item, need to set data-name="nameKey" on el
      this.data = {
        info: {
          el: document.querySelector("[data-info]"),
          value: `Anti-bot technology is designed to detect and mitigate suspicious or
            malicious bots, preventing them from reaching an organization's websites
            or IT ecosystem.`,
          type: "text",
        },
        count: {
          el: document.querySelector("[data-count]"),
          value: "unknown",
          type: "text",
        },
      };
      // Hidden elements that will be shown on success, like ping buttons or list rendering
      this.showOnSuccess = [];

      this.init();
    }

    init() {
      window.addEventListener("DOMContentLoaded", () => {
        // Set default values and fetch
        this.updateDataDOM();
        this.updateAlert("fetch");

        fetch(location.href, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token() }}",
          },
        })
          .then((res) => res.json())
          .then((res) => {
            console.log(res);
            console.log(res.data);
            console.log(res.data.data);
            // Update data and DOM
            this.getFetchDataByKey(res.data);
            this.updateDataDOM();
            // Show hidden elements
            if (this.showOnSuccess.length > 0) {
              this.showOnSuccess.forEach((el) => {
                el.classList.remove("hidden");
              });
            }
            // Feedback
            this.updateAlert("success");
          })
          .catch((error) => {
            console.log(error);
            this.updateAlert("error");
          });
      });

      this.alertCloseEl.addEventListener("click", () => {
        this.alertEl.classList.add("hidden");
      });
    }

    // Key of fetch data need to match key of this.data
    getFetchDataByKey(fetchDataObj) {
      for (const [key, value] of Object.entries(this.data)) {
        this.data[key]["value"] =
          fetchDataObj[key] || this.data[key]["value"] || "";
      }
    }

    updateDataDOM() {
      for (const [key, value] of Object.entries(this.data)) {
        // Case text
        if (this.data[key]["type"] == "text") {
          this.data[key]["el"].textContent = this.data[key]["value"] || "";
        }
        // Case list, we will render elements after the selected elements
        if (this.data[key]["type"] == "text") {
          this.data[key]["el"].textContent = this.data[key]["value"] || "";
        }
      }
    }

    // Show fetch state alert
    // type<str> : fetch, success, error
    updateAlert(type) {
      if (!type) return;

      if (type == "fetch") {
        this.alertStatusEl.textContent = "Fetching";
        this.alertMsgEl.textContent = "Please wait...";
        this.alertEl.classList.remove("bg-green-500");
        this.alertEl.classList.remove("bg-red-500");
        this.alertEl.classList.add("bg-sky-500");
      }
      if (type == "success") {
        this.alertStatusEl.textContent = "Success";
        this.alertMsgEl.textContent = "Data fetched successfully";
        this.alertEl.classList.remove("bg-sky-500");
        this.alertEl.classList.remove("bg-red-500");
        this.alertEl.classList.add("bg-green-500");
      }
      if (type == "error") {
        this.alertStatusEl.textContent = "Error";
        this.alertMsgEl.textContent = "Something went wrong";
        this.alertEl.classList.remove("bg-sky-500");
        this.alertEl.classList.remove("bg-green-500");
        this.alertEl.classList.add("bg-red-500");
      }

      this.alertEl.classList.remove("hidden");

      if (type !== "fetch")
        setTimeout(() => this.alertEl.classList.add("hidden"), 5000);
    }
  }

  new SetupPlugin();
</script>

{% endblock %}
