{% extends "base.html" %} {% block content %}

<div class="col-span-12 grid grid-cols-12 gap-4">
  <div class="col-span-12 grid grid-cols-12 gap-4">
    <!-- info-->
    <div
      class="h-fit transition hover:scale-102 col-span-12 md:col-span-6 2xl:col-span-4 3xl:col-span-3 p-4 relative min-w-0 break-words bg-white shadow-xl dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border"
    >
      <h5 class="mb-2 font-bold dark:text-white/90">INFO</h5>

      <div class="mx-1 flex justify-start items-center my-4">
        <p
          data-info
          class="transition duration-300 ease-in-out mb-0 font-sans text-sm leading-normal dark:text-gray-500 dark:opacity-80"
        ></p>
      </div>
    </div>
    <!-- end info -->
  </div>

  <div
    class="h-fit dark:brightness-110 max-h-none sm:max-h-28 hover:scale-102 transition col-span-12 md:col-span-6 2xl:col-span-4 flex p-4 justify-between w-full shadow-md break-words bg-white dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border"
  >
    <!-- text -->
    <div>
      <p
        class="mb-2 font-sans text-sm font-semibold leading-normal uppercase dark:text-white dark:opacity-60"
      >
        URL
      </p>
      <h5 data-count-url class="mb-1 font-bold dark:text-white/90"></h5>

      <p class="mb-0 dark:text-white dark:opacity-60">
        <span class="font-bold leading-normal text-sm text-red-500 mx-0.5">
          denied
        </span>
      </p>
    </div>
    <!-- end text -->
    <!-- icon -->
    <div
      role="img"
      class="dark:brightness-90 inline-block w-12 h-12 text-center rounded-circle bg-red-600"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="scale-[0.6] leading-none text-lg relative fill-white"
      >
        <path
          fill-rule="evenodd"
          d="M19.902 4.098a3.75 3.75 0 0 0-5.304 0l-4.5 4.5a3.75 3.75 0 0 0 1.035 6.037.75.75 0 0 1-.646 1.353 5.25 5.25 0 0 1-1.449-8.45l4.5-4.5a5.25 5.25 0 1 1 7.424 7.424l-1.757 1.757a.75.75 0 1 1-1.06-1.06l1.757-1.757a3.75 3.75 0 0 0 0-5.304Zm-7.389 4.267a.75.75 0 0 1 1-.353 5.25 5.25 0 0 1 1.449 8.45l-4.5 4.5a5.25 5.25 0 1 1-7.424-7.424l1.757-1.757a.75.75 0 1 1 1.06 1.06l-1.757 1.757a3.75 3.75 0 1 0 5.304 5.304l4.5-4.5a3.75 3.75 0 0 0-1.035-6.037.75.75 0 0 1-.354-1Z"
          clip-rule="evenodd"
        />
      </svg>
    </div>
    <!-- end icon -->
  </div>

  <div
    class="h-fit dark:brightness-110 max-h-none sm:max-h-28 hover:scale-102 transition col-span-12 md:col-span-6 2xl:col-span-4 flex p-4 justify-between w-full shadow-md break-words bg-white dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border"
  >
    <!-- text -->
    <div>
      <p
        class="mb-2 font-sans text-sm font-semibold leading-normal uppercase dark:text-white dark:opacity-60"
      >
        IP
      </p>
      <h5 data-count-ip class="mb-1 font-bold dark:text-white/90"></h5>

      <p class="mb-0 dark:text-white dark:opacity-60">
        <span class="font-bold leading-normal text-sm text-red-500 mx-0.5">
          denied
        </span>
      </p>
    </div>
    <!-- end text -->
    <!-- icon -->
    <div
      role="img"
      class="dark:brightness-90 inline-block w-12 h-12 text-center rounded-circle bg-lime-600"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="scale-50 leading-none text-lg relative fill-white"
      >
        <path
          d="M3.53 2.47a.75.75 0 0 0-1.06 1.06l18 18a.75.75 0 1 0 1.06-1.06l-18-18ZM20.25 5.507v11.561L5.853 2.671c.15-.043.306-.075.467-.094a49.255 49.255 0 0 1 11.36 0c1.497.174 2.57 1.46 2.57 2.93ZM3.75 21V6.932l14.063 14.063L12 18.088l-7.165 3.583A.75.75 0 0 1 3.75 21Z"
        />
      </svg>
    </div>
    <!-- end icon -->
  </div>

  <div
    class="h-fit dark:brightness-110 max-h-none sm:max-h-28 hover:scale-102 transition col-span-12 md:col-span-6 2xl:col-span-4 flex p-4 justify-between w-full shadow-md break-words bg-white dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border"
  >
    <!-- text -->
    <div>
      <p
        class="mb-2 font-sans text-sm font-semibold leading-normal uppercase dark:text-white dark:opacity-60"
      >
        RDNS
      </p>
      <h5 data-count-rdns class="mb-1 font-bold dark:text-white/90"></h5>

      <p class="mb-0 dark:text-white dark:opacity-60">
        <span class="font-bold leading-normal text-sm text-red-500 mx-0.5">
          denied
        </span>
      </p>
    </div>
    <!-- end text -->
    <!-- icon -->
    <div
      role="img"
      class="dark:brightness-90 inline-block w-12 h-12 text-center rounded-circle bg-indigo-500"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="scale-[0.6] leading-none text-lg relative fill-white"
      >
        <path
          d="M11.625 16.5a1.875 1.875 0 1 0 0-3.75 1.875 1.875 0 0 0 0 3.75Z"
        />
        <path
          fill-rule="evenodd"
          d="M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6 16.5c.66 0 1.277-.19 1.797-.518l1.048 1.048a.75.75 0 0 0 1.06-1.06l-1.047-1.048A3.375 3.375 0 1 0 11.625 18Z"
          clip-rule="evenodd"
        />
        <path
          d="M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z"
        />
      </svg>
    </div>
    <!-- end icon -->
  </div>

  <div
    class="h-fit dark:brightness-110 max-h-none sm:max-h-28 hover:scale-102 transition col-span-12 md:col-span-6 2xl:col-span-4 flex p-4 justify-between w-full shadow-md break-words bg-white dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border"
  >
    <!-- text -->
    <div>
      <p
        class="mb-2 font-sans text-sm font-semibold leading-normal uppercase dark:text-white dark:opacity-60"
      >
        ASN
      </p>
      <h5 data-count-asn class="mb-1 font-bold dark:text-white/90"></h5>

      <p class="mb-0 dark:text-white dark:opacity-60">
        <span class="font-bold leading-normal text-sm text-red-500 mx-0.5">
          denied
        </span>
      </p>
    </div>
    <!-- end text -->
    <!-- icon -->
    <div
      role="img"
      class="dark:brightness-90 inline-block w-12 h-12 text-center rounded-circle bg-blue-700"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="scale-[0.6] leading-none text-lg relative fill-white"
      >
        <path
          d="M21.721 12.752a9.711 9.711 0 0 0-.945-5.003 12.754 12.754 0 0 1-4.339 2.708 18.991 18.991 0 0 1-.214 4.772 17.165 17.165 0 0 0 5.498-2.477ZM14.634 15.55a17.324 17.324 0 0 0 .332-4.647c-.952.227-1.945.347-2.966.347-1.021 0-2.014-.12-2.966-.347a17.515 17.515 0 0 0 .332 4.647 17.385 17.385 0 0 0 5.268 0ZM9.772 17.119a18.963 18.963 0 0 0 4.456 0A17.182 17.182 0 0 1 12 21.724a17.18 17.18 0 0 1-2.228-4.605ZM7.777 15.23a18.87 18.87 0 0 1-.214-4.774 12.753 12.753 0 0 1-4.34-2.708 9.711 9.711 0 0 0-.944 5.004 17.165 17.165 0 0 0 5.498 2.477ZM21.356 14.752a9.765 9.765 0 0 1-7.478 6.817 18.64 18.64 0 0 0 1.988-4.718 18.627 18.627 0 0 0 5.49-2.098ZM2.644 14.752c1.682.971 3.53 1.688 5.49 2.099a18.64 18.64 0 0 0 1.988 4.718 9.765 9.765 0 0 1-7.478-6.816ZM13.878 2.43a9.755 9.755 0 0 1 6.116 3.986 11.267 11.267 0 0 1-3.746 2.504 18.63 18.63 0 0 0-2.37-6.49ZM12 2.276a17.152 17.152 0 0 1 2.805 7.121c-.897.23-1.837.353-2.805.353-.968 0-1.908-.122-2.805-.353A17.151 17.151 0 0 1 12 2.276ZM10.122 2.43a18.629 18.629 0 0 0-2.37 6.49 11.266 11.266 0 0 1-3.746-2.504 9.754 9.754 0 0 1 6.116-3.985Z"
        />
      </svg>
    </div>
    <!-- end icon -->
  </div>

  <div
    class="h-fit dark:brightness-110 max-h-none sm:max-h-28 hover:scale-102 transition col-span-12 md:col-span-6 2xl:col-span-4 flex p-4 justify-between w-full shadow-md break-words bg-white dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border"
  >
    <!-- text -->
    <div>
      <p
        class="mb-2 font-sans text-sm font-semibold leading-normal uppercase dark:text-white dark:opacity-60"
      >
        User Agent
      </p>
      <h5 data-count-user-agent class="mb-1 font-bold dark:text-white/90"></h5>

      <p class="mb-0 dark:text-white dark:opacity-60">
        <span class="font-bold leading-normal text-sm text-red-500 mx-0.5">
          denied
        </span>
      </p>
    </div>
    <!-- end text -->
    <!-- icon -->
    <div
      role="img"
      class="dark:brightness-90 inline-block w-12 h-12 text-center rounded-circle bg-amber-500"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="scale-50 leading-none text-lg relative fill-white"
      >
        <path
          fill-rule="evenodd"
          d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z"
          clip-rule="evenodd"
        />
      </svg>
    </div>
    <!-- end icon -->
  </div>
  <div
    role="alert"
    data-fetch
    class="bg-sky-500 p-4 mb-1 md:mb-3 md:mr-3 z-[1001] flex flex-col fixed bottom-0 right-0 w-full md:w-1/2 max-w-[300px] min-h-20 rounded-lg dark:brightness-110 hover:scale-102 transition shadow-md break-words dark:bg-slate-850 dark:shadow-dark-xl bg-clip-border"
  >
    <button data-fetch-close class="absolute right-7 top-1.5">
      <svg
        class="cursor-pointer fill-white dark:fill-gray-300 dark:opacity-80 absolute h-5 w-5"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 320 512"
      >
        <path
          d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z"
        ></path>
      </svg>
    </button>
    <h5 data-fetch-status class="text-lg mb-0 text-white dark:text-gray-300">
      Fetching
    </h5>
    <p data-fetch-msg class="text-white dark:text-gray-300 mb-0 text-sm">
      Please wait...
    </p>
  </div>

  <script>
    class SetupPlugin {
      constructor() {
        // Alert elements
        this.alertEl = document.querySelector("[data-fetch]");
        this.alertCloseEl = document.querySelector("[data-fetch-close]");
        this.alertStatusEl = document.querySelector("[data-fetch-status]");
        this.alertMsgEl = document.querySelector("[data-fetch-msg]");
        // Set data defaults elements and variables
        // Key of this.data need to match key of fetch data json object to update values
        // type<str> : text (target el), list (el need to be first element of list)
        // listNames<arr> : list of names key on item, need to set data-name="nameKey" on el
        this.data = {
          info: {
            el: document.querySelector("[data-info]"),
            value: `Deny access based on internal and external
          IP/network/rDNS/ASN blacklists.`,
            type: "text",
          },
          count_url: {
            el: document.querySelector("[data-count-url]"),
            value: "unknown",
            type: "text",
          },
          count_ip: {
            el: document.querySelector("[data-count-ip]"),
            value: "unknown",
            type: "text",
          },
          count_rdns: {
            el: document.querySelector("[data-count-rdns]"),
            value: "unknown",
            type: "text",
          },
          count_asn: {
            el: document.querySelector("[data-count-asn]"),
            value: "unknown",
            type: "text",
          },
          count_user_agent: {
            el: document.querySelector("[data-count-user-agent]"),
            value: "unknown",
            type: "text",
          },

          /* EXAMPLE
          // value : active / inactive / unknown
          status: {
            el: document.querySelector("[data-status]"),
            value: "unknown",
            type: "status",
            textEl: document.querySelector("[data-status-text]"),
          },
          */
        };
        // Hidden elements that will be shown on success, like ping buttons or list rendering
        this.showOnSuccessEls = document.querySelectorAll(
          "[data-fetch-success-show]",
        );

        this.init();
      }

      init() {
        window.addEventListener("DOMContentLoaded", () => {
          // Set default values and fetch
          this.updateDataDOM();
          this.updateAlert("fetch");

          fetch(location.href, {
            method: "POST",
            headers: {
              "X-CSRFToken": "{{ csrf_token() }}",
            },
          })
            .then((res) => res.json())
            .then((res) => {
              // Update data and DOM
              this.getFetchDataByKey(res.data.data);
              this.updateDataDOM();
              // Show hidden elements
              this.showSuccessEls();
              // Feedback
              this.updateAlert("success");
            })
            .catch((error) => {
              this.updateAlert("error");
            });
        });

        this.alertCloseEl.addEventListener("click", () => {
          this.alertEl.classList.add("hidden");
        });
      }

      showSuccessEls() {
        this.showOnSuccessEls.forEach((el) => {
          el.classList.remove("hidden");
        });
      }

      // Key of fetch data need to match key of this.data
      getFetchDataByKey(fetchDataObj) {
        for (const [key, value] of Object.entries(this.data)) {
          value["value"] = fetchDataObj[key] || value["value"] || "";
        }
      }

      updateDataDOM() {
        for (const [key, val] of Object.entries(this.data)) {
          const el = val["el"];
          const type = val["type"];
          const value = val["value"];

          // Case text
          if (type === "text") {
            el.textContent = value || "";
            continue;
          }
          // Case status
          if (type === "status") {
            const textEl = val["textEl"] || null;

            if (value === "active")
              this.setStatus(el, textEl, "fill-green-500", "Active");
            if (value === "inactive")
              this.setStatus(el, textEl, "fill-red-500", "Inactive");
            if (value === "unknown")
              this.setStatus(el, textEl, "fill-sky-500", "Unknown");
            continue;
          }

          // Case list, we will render elements after the selected elements
          if (type === "list") {
            // Case no list to render
            if (!value || value.length <= 0) continue;

            // Clone item element
            const itemEl = el.cloneNode(true);
            itemEl.classList.remove("hidden");
            const parentEl = el.parentNode;
            // Add item element after selected element
            const items = value.forEach((item) => {
              const newItemEl = itemEl.cloneNode(true);
              // Update item element values
              for (const [nameKey, nameValue] of Object.entries(item)) {
                newItemEl.querySelector(
                  `[data-name="${nameKey}"]`,
                ).textContent = nameValue;
              }
              // Add item element after selected element
              parentEl.appendChild(newItemEl);
            });

            // Delete schema
            el.remove();
            continue;
          }
        }
      }

      setStatus(el, textEl, colorClass, text) {
        el.classList.remove("fill-green-500", "fill-red-500", "fill-sky-500");
        el ? el.classList.add(colorClass) : null;
        textEl ? (textEl.textContent = text) : null;
      }

      // Show fetch state alert
      // type<str> : fetch, success, error
      updateAlert(type) {
        if (!type) return;

        const [status, msg, color] = this.getAlertType(type);

        this.alertEl.classList.remove(
          "bg-sky-500",
          "bg-green-500",
          "bg-red-500",
        );

        this.alertStatusEl.textContent = status;
        this.alertMsgEl.textContent = msg;
        this.alertEl.classList.add(color);

        this.alertEl.classList.remove("hidden");

        if (type !== "fetch")
          setTimeout(() => this.alertEl.classList.add("hidden"), 5000);
      }

      getAlertType(type) {
        if (type === "fetch")
          return ["Fetching", "Please wait...", "bg-sky-500"];
        if (type === "error")
          return ["Error", "Something went wrong", "bg-red-500"];
        if (type === "success")
          return ["Success", "Data fetched successfully", "bg-green-500"];
      }
    }

    new SetupPlugin();
  </script>
</div>
{% endblock %}
